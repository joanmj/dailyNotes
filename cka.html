
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>k8s · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="rest.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    学习笔记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="miniui.html">
            
                <a href="miniui.html">
            
                    
                    JQuery MiniUI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="eos.html">
            
                <a href="eos.html">
            
                    
                    EOS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    自动化测试
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="Sahi.html">
            
                <a href="Sahi.html">
            
                    
                    Sahi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="Selenium.html">
            
                <a href="Selenium.html">
            
                    
                    Selenium
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    前端
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="js6.html">
            
                <a href="js6.html">
            
                    
                    EcmaScript6
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="nodejs.html">
            
                <a href="nodejs.html">
            
                    
                    Node.js
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1.1" data-path="react.html">
            
                <a href="react.html">
            
                    
                    React
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1.1.1" data-path="extension.html">
            
                <a href="extension.html">
            
                    
                    Chrome extension
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    后端
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="rest.html">
            
                <a href="rest.html">
            
                    
                    restful
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.2" data-path="cka.html">
            
                <a href="cka.html">
            
                    
                    k8s
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    数据库
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="mongodb.html">
            
                <a href="mongodb.html">
            
                    
                    MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="sql.html">
            
                <a href="sql.html">
            
                    
                    sql
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    语言
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="python.html">
            
                <a href="python.html">
            
                    
                    python
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    工具
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="securecrt.html">
            
                <a href="securecrt.html">
            
                    
                    服务器访问/下载上传
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="code.html">
            
                <a href="code.html">
            
                    
                    Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="chunked.html">
            
                <a href="chunked.html">
            
                    
                    断点续传
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="git.html">
            
                <a href="git.html">
            
                    
                    git常用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="env.html">
            
                <a href="env.html">
            
                    
                    环境相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="server.html">
            
                <a href="server.html">
            
                    
                    服务器操作
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >k8s</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="158">158</h1>
<h2 id="&#x539F;&#x6709;&#x670D;&#x52A1;&#x5230;microservice&#x67B6;&#x6784;">&#x539F;&#x6709;&#x670D;&#x52A1;&#x5230;microservice&#x67B6;&#x6784;</h2>
<ul>
<li>&#x91CD;&#x6784;&#x65B9;&#x5F0F;&#xFF1A;<ol>
<li>&#x505C;&#x6B62;&#x65B0;&#x529F;&#x80FD;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5F7B;&#x5E95;&#x91CD;&#x6784;</li>
<li>&#x65B0;&#x529F;&#x80FD;&#x7528;&#x5FAE;&#x670D;&#x52A1;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#xFF0C;&#x9010;&#x6B65;&#x91CD;&#x6784;&#xFF1B;</li>
</ol>
</li>
<li>&#x6311;&#x6218;&#xFF1A;<ul>
<li>&#x91CD;&#x6784;&#x65B9;&#x5F0F;<ul>
<li>&#x7528;&#x539F;&#x8BED;&#x8A00;&#x5B9E;&#x73B0;&#xFF08;&#x91CD;&#x7528;&#x90E8;&#x5206;&#x65E7;&#x4EE3;&#x7801;&#xFF09;&#x66F4;&#x52A0;&#x7ECF;&#x6D4E;&#xFF1B;</li>
<li>&#x8BBE;&#x8BA1;&#x4E0D;&#x597D;&#x7684;&#x5E94;&#x8BE5;&#x4EE5;&#x65B0;&#x6280;&#x672F;&#x67B6;&#x6784;&#x601D;&#x8DEF;&#x91CD;&#x65B0;&#x8BBE;&#x8BA1;&#x5B9E;&#x73B0;</li>
<li>&#x4E0E;&#x6570;&#x636E;&#x8FC7;&#x5206;&#x8026;&#x5408;&#x7684;&#x5E94;&#x7528;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x91CD;&#x6784;&#xFF1B;</li>
</ul>
</li>
<li>&#x91CD;&#x6784;&#x5B8C;&#x6210;&#x540E;&#x9009;&#x62E9;&#x673A;&#x5236;/&#x5DE5;&#x5177;&#xFF0C;&#x4FDD;&#x6301;&#x6240;&#x6709;&#x6A21;&#x5757;&#x7684;&#x5F39;&#x6027;&#xFF1B;<h2 id="container-orchestration">container Orchestration</h2>
</li>
</ul>
</li>
<li><p>Define the concept of container orchestration.
container
Microservices
Container Orchestration
 &#x5DF2;&#x77E5;&#x7684;orchestrator &#xFF0C;&#x63A8;&#x8350;&#x5B66;&#x4E60;edx151x&#x8BFE;&#x7A0B;<a href="https://www.edx.org/course/introduction-cloud-infrastructure-linuxfoundationx-lfs151-x&#xFF0C;" target="_blank">https://www.edx.org/course/introduction-cloud-infrastructure-linuxfoundationx-lfs151-x&#xFF0C;</a></p>
</li>
<li><p>Explain the reasons for doing container orchestration.</p>
</li>
<li>Discuss different container orchestration options.</li>
<li>Discuss different container orchestration deployment options.</li>
</ul>
<h2 id="chapter-4-kubernetes-architecture">Chapter 4. Kubernetes Architecture</h2>
<h3 id="42-the-kubernetes-architecture">4.2 the Kubernetes architecture.</h3>
<ul>
<li>high Level arch<ul>
<li>One or more master nodes</li>
<li>One or more worker nodes</li>
<li>Distributed key-value store, such as etcd.
<img src="assets/cka-431f4ba2.png" alt=""></li>
</ul>
</li>
<li>detail level architecture<ul>
<li>Master node
manage state of a Kubernetes cluster;has the following components:<ul>
<li>API server<ul>
<li>kube-apiserver</li>
</ul>
</li>
<li>Scheduler</li>
<li>Controller managers</li>
<li>etcd.<h4 id="423-worker-node">4.2.3 Worker Node</h4>
<!--- A worker node provides a running environment for client applications. Though containerized microservices, these applications are encapsulated in Pods, controlled by the cluster control plane agents running on the master node. Pods are scheduled on worker nodes, where they find required compute, memory and storage resources to run, and networking to talk to each other and the outside world. A Pod is the smallest scheduling unit in Kubernetes. It is a logical collection of one or more containers scheduled together. We will explore them further in later chapters.
--->
worker&#x8282;&#x70B9;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x63D0;&#x4F9B;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x3002;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x5316;&#x7684;&#x5FAE;&#x670D;&#x52A1;&#xFF0C;&#x8FD9;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x88AB;&#x5C01;&#x88C5;&#x5728;Pods&#x4E2D;&#xFF0C;&#x7531;&#x8FD0;&#x884C;&#x5728;&#x4E3B;&#x8282;&#x70B9;&#x4E0A;&#x7684;&#x96C6;&#x7FA4;&#x63A7;&#x5236;&#x5E73;&#x9762;&#x4EE3;&#x7406;&#x63A7;&#x5236;&#x3002;pod&#x88AB;&#x5B89;&#x6392;&#x5728;worker&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x5728;&#x90A3;&#x91CC;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x8FD0;&#x884C;&#x6240;&#x9700;&#x7684;&#x8BA1;&#x7B97;&#x3001;&#x5185;&#x5B58;&#x548C;&#x5B58;&#x50A8;&#x8D44;&#x6E90;&#xFF0C;&#x5E76;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x4E0E;&#x5F7C;&#x6B64;&#x548C;&#x5916;&#x90E8;&#x4E16;&#x754C;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;Pod&#x662F;Kubernetes&#x4E2D;&#x6700;&#x5C0F;&#x7684;&#x8C03;&#x5EA6;&#x5355;&#x5143;&#x3002;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x7F16;&#x6392;&#x5728;&#x4E00;&#x8D77;&#x7684;&#x5BB9;&#x5668;&#x7684;&#x903B;&#x8F91;&#x96C6;&#x5408;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x540E;&#x9762;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#x8FDB;&#x4E00;&#x6B65;&#x63A2;&#x8BA8;&#x5B83;&#x4EEC;&#x3002;
<img src="assets/cka-40a023f5.png" alt="">
Kubernetes Worker Node</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote id="fn__^">
<sup>_^</sup>. # Also, to access the applications from the external world, we connect to worker nodes and not to the master node. We will dive deeper into this in future chapters.<a href="#reffn__%5E" title="Jump back to footnote [_^] in the text."> &#x21A9;</a>
</blockquote>
<p>&#x540C;&#x65F6;&#xFF0C;&#x4ECE;&#x5916;&#x90E8;&#x4E16;&#x754C;&#x8BBF;&#x95EE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x8FDE;&#x63A5;&#x5230;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x800C;&#x4E0D;&#x662F;&#x4E3B;&#x8282;&#x70B9;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x4EE5;&#x540E;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#x6DF1;&#x5165;&#x63A2;&#x8BA8;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<h5 id="worker-node-components">Worker Node Components</h5>
<!---
    A worker node has the following components:
    * Container runtime
    * kubelet
    * kube-proxy
    * Addons for DNS, Dashboard, cluster-level monitoring and logging.

    In the next few sections, we will discuss them in more detail.
--->
<p>&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x7EC4;&#x4EF6;&#xFF1A;</p>
<ul>
<li>&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;</li>
<li>kubelet</li>
<li>kube-proxy</li>
<li>&#x7528;&#x4E8E;DNS&#x3001;Dashboard&#x3001;&#x96C6;&#x7FA4;&#x7EA7;&#x76D1;&#x63A7;&#x548C;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x7684;&#x52A0;&#x8F7D;&#x9879;&#x3002;</li>
</ul>
<p>&#x5728;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x51E0;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x66F4;&#x8BE6;&#x7EC6;&#x5730;&#x8BA8;&#x8BBA;&#x5B83;&#x4EEC;&#x3002;</p>
<h5 id="container-runtime">Container Runtime</h5>
<!---
    Although Kubernetes is described as a "container orchestration engine", it does not have the capability to directly handle containers. In order to run and manage a container's lifecycle, Kubernetes requires a container runtime on the node where a Pod and its containers are to be scheduled. Kubernetes supports many container runtimes:

    Docker - although a container platform which uses containerd as a container runtime, it is the most widely used container runtime with Kubernetes
    CRI-O - a lightweight container runtime for Kubernetes, it also supports Docker image registries
    containerd - a simple and portable container runtime providing robustness
    rkt - a pod-native container engine, it also runs Docker images
    rktlet - a Kubernetes Container Runtime Interface (CRI) implementation using rkt.
--->
<p>&#x5C3D;&#x7BA1;Kubernetes&#x88AB;&#x63CF;&#x8FF0;&#x4E3A;&#x4E00;&#x4E2A;&#x201C;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x5F15;&#x64CE;&#x201D;&#xFF0C;&#x4F46;&#x5B83;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x5904;&#x7406;&#x5BB9;&#x5668;&#x7684;&#x80FD;&#x529B;&#x3002;&#x4E3A;&#x4E86;&#x8FD0;&#x884C;&#x548C;&#x7BA1;&#x7406;&#x5BB9;&#x5668;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;Kubernetes&#x9700;&#x8981;&#x5728;Pod&#x53CA;&#x5176;&#x5BB9;&#x5668;&#x7684;&#x8C03;&#x5EA6;&#x8282;&#x70B9;&#x4E0A;&#x6709;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x3002;Kubernetes&#x652F;&#x6301;&#x8BB8;&#x591A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#xFF1A;</p>
<ul>
<li>Docker - &#x867D;&#x7136;&#x662F;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;containerd&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x7684;&#x5BB9;&#x5668;&#x5E73;&#x53F0;&#xFF0C;&#x4F46;&#x5B83;&#x662F;Kubernetes&#x6700;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;</li>
<li>CRI-O-&#x4E00;&#x4E2A;&#x7528;&#x4E8E;Kubernetes&#x7684;&#x8F7B;&#x91CF;&#x7EA7;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x5B83;&#x8FD8;&#x652F;&#x6301;Docker&#x6620;&#x50CF;&#x6CE8;&#x518C;</li>
<li>containerd &#x2014; &#x63D0;&#x4F9B;&#x5065;&#x58EE;&#x6027;&#x7684;&#x7B80;&#x5355;&#x53EF;&#x79FB;&#x690D;&#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;</li>
<li>rkt - &#x4E00;&#x4E2A;pod&#x672C;&#x5730;&#x5BB9;&#x5668;&#x5F15;&#x64CE;&#xFF0C;&#x5B83;&#x8FD8;&#x8FD0;&#x884C;Docker&#x6620;&#x50CF;</li>
<li><p>rktlet - &#x4E00;&#x4E2A;&#x4F7F;&#x7528;rkt&#x7684;Kubernetes&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x63A5;&#x53E3;&#xFF08;CRI&#xFF09;&#x5B9E;&#x73B0;&#x3002;</p>
<h5 id="kubelet">kubelet</h5>
<!---
The kubelet is an agent running on each node and communicates with the control plane components from the master node. It receives Pod definitions, primarily from the API server, and interacts with the container runtime on the node to run containers associated with the Pod. It also monitors the health of the Pod's running containers.

The kubelet connects to the container runtime using Container Runtime Interface (CRI). CRI consists of protocol buffers, gRPC API, and libraries.
--->
<p>kubelet&#x662F;&#x8FD0;&#x884C;&#x5728;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x7684;&#x4EE3;&#x7406;&#xFF0C;&#x5E76;&#x4E0E;&#x4E3B;&#x8282;&#x70B9;&#x7684;&#x63A7;&#x5236;&#x5E73;&#x9762;&#x7EC4;&#x4EF6;&#x901A;&#x4FE1;&#x3002;&#x5B83;&#x4E3B;&#x8981;&#x4ECE;API server&#x63A5;&#x6536;Pod&#x5B9A;&#x4E49;&#xFF0C;&#x5E76;&#x4E0E;&#x8282;&#x70B9;&#x4E0A;&#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x4EA4;&#x4E92;&#x4EE5;&#x8FD0;&#x884C;&#x4E0E;Pod&#x76F8;&#x5173;&#x7684;&#x5BB9;&#x5668;&#x3002;&#x5B83;&#x8FD8;&#x76D1;&#x6D4B;&#x540A;&#x8231;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x5065;&#x5EB7;&#x72B6;&#x51B5;&#x3002;
kubelet&#x4F7F;&#x7528;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x63A5;&#x53E3;&#xFF08;container runtime Interface&#xFF0C;CRI&#xFF09;&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x3002;CRI&#x7531;&#x534F;&#x8BAE;&#x7F13;&#x51B2;&#x533A;&#x3001;gRPC API&#x548C;&#x5E93;&#x7EC4;&#x6210;
<img src="assets/cka-8c8600df.png" alt="">
Container Runtime Interface
(Retrieved from blog.kubernetes.io)</p>
<!---
As shown above, the kubelet acting as grpc client connects to the CRI shim acting as grpc server to perform container and image operations. CRI implements two services: ImageService and RuntimeService. The ImageService is responsible for all the image-related operations, while the RuntimeService is responsible for all the Pod and container-related operations.
Container runtimes used to be hard-coded in Kubernetes, but with the development of CRI, Kubernetes is more flexible now and uses different container runtimes without the need to recompile. Any container runtime that implements CRI can be used by Kubernetes to manage Pods, containers, and container images.
In the next section, we will discuss some of the CRI shims.
--->
<p>&#x5982;&#x4E0A;&#x6240;&#x793A;&#xFF0C;&#x5145;&#x5F53;grpc&#x5BA2;&#x6237;&#x7AEF;&#x7684;kubelet&#x8FDE;&#x63A5;&#x5230;&#x5145;&#x5F53;grpc&#x670D;&#x52A1;&#x5668;&#x7684;CRI shim&#xFF0C;&#x4EE5;&#x6267;&#x884C;&#x5BB9;&#x5668;&#x548C;image&#x64CD;&#x4F5C;&#x3002;CRI&#x5B9E;&#x73B0;&#x4E86;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#xFF1A;ImageService&#x548C;RuntimeService&#x3002;ImageService&#x8D1F;&#x8D23;&#x6240;&#x6709;&#x4E0E;image&#x76F8;&#x5173;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;RuntimeService&#x8D1F;&#x8D23;&#x6240;&#x6709;&#x4E0E;Pod&#x548C;&#x5BB9;&#x5668;&#x76F8;&#x5173;&#x7684;&#x64CD;&#x4F5C;&#x3002;
&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x5728;Kubernetes&#x4E2D;&#x662F;&#x5199;&#x6B7B;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x968F;&#x7740;CRI&#x7684;&#x53D1;&#x5C55;&#xFF0C;Kubernetes&#x73B0;&#x5728;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x3002;Kubernetes&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x5B9E;&#x73B0;CRI&#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x6765;&#x7BA1;&#x7406;pod&#x3001;&#x5BB9;&#x5668;&#x548C;&#x5BB9;&#x5668;&#x6620;&#x50CF;&#x3002;
&#x5728;&#x4E0B;&#x4E00;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x8BA8;&#x8BBA;&#x4E00;&#x4E9B;CRI Shim&#x3002;</p>
<h5 id="kubelet---cri-shims">kubelet - CRI shims</h5>
<p>Below you will find some examples of CRI shims:</p>
</li>
<li><p>dockershim</p>
<!---
With dockershim, containers are created using Docker installed on the worker nodes. Internally, Docker uses containerd to create and manage containers.
--->
<p><img src="assets/cka-d8d9a7fd.png" alt="dockershim">
dockershim
(Retrieved from blog.kubernetes.io)
&#x4F7F;&#x7528;dockershim&#xFF0C;&#x5BB9;&#x5668;&#x662F;&#x4F7F;&#x7528;&#x5B89;&#x88C5;&#x5728;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x4E0A;&#x7684;Docker&#x521B;&#x5EFA;&#x7684;&#x3002;&#x5728;&#x5185;&#x90E8;&#xFF0C;Docker&#x4F7F;&#x7528;containerd&#x521B;&#x5EFA;&#x548C;&#x7BA1;&#x7406;&#x5BB9;&#x5668;&#x3002;</p>
</li>
<li>cri-containerd<!--- With cri-containerd, we can directly use Docker's smaller offspring containerd to create and manage containers.
--->
&#x4F7F;&#x7528;cri-containerd&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;Docker&#x66F4;&#x5C0F;&#x7684;&#x5B50;&#x7A0B;&#x5E8F;containerd&#x6765;&#x521B;&#x5EFA;&#x548C;&#x7BA1;&#x7406;&#x5BB9;&#x5668;&#x3002;
<img src="assets/cka-b0c18ed8.png" alt=""></li>
<li>CRI-O
&lt;!---
CRI-O enables using any Open Container Initiative (OCI) compatible runtimes with Kubernetes. At the time this course was created, CRI-O supported runC and Clear Containers as container runtimes. However, in principle, any OCI-compliant runtime can be plugged-in.</li>
</ul>
<p>CRI-O
 CRI-O enables using any Open Container Initiative (OCI) compatible runtimes with Kubernetes. At the time this course was created, CRI-O supported runC and Clear Containers as container runtimes. However, in principle, any OCI-compliant runtime can be plugged-in.
---&gt;</p>
<p>CRI-O&#x652F;&#x6301;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x4E0E;Kubernetes&#x517C;&#x5BB9;&#x7684;&#x5F00;&#x653E;&#x5BB9;&#x5668;&#x5021;&#x8BAE;&#xFF08;OCI&#xFF09;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x3002;&#x5728;&#x521B;&#x5EFA;&#x672C;&#x8BFE;&#x7A0B;&#x65F6;&#xFF0C;CRI-O&#x652F;&#x6301;runC&#x548C;Clear Containers&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x539F;&#x5219;&#x4E0A;&#xFF0C;&#x4EFB;&#x4F55;&#x7B26;&#x5408;OCI&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x90FD;&#x53EF;&#x4EE5;&#x63D2;&#x5165;&#x3002;
<img src="assets/cka-98c93a90.png" alt=""></p>
<h5 id="kube-proxy">kube-proxy</h5>
<!---
[^_^]: # The kube-proxy is the network agent which runs on each node responsible for dynamic updates and maintenance of all networking rules on the node. It abstracts the details of Pods networking and forwards connection requests to Pods.
[^_^]: # We will explore Pod networking in more detail in later chapters.
--->
<p>kube&#x4EE3;&#x7406;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x7684;&#x7F51;&#x7EDC;&#x4EE3;&#x7406;&#xFF0C;&#x8D1F;&#x8D23;&#x52A8;&#x6001;&#x66F4;&#x65B0;&#x548C;&#x7EF4;&#x62A4;&#x8282;&#x70B9;&#x4E0A;&#x7684;&#x6240;&#x6709;&#x7F51;&#x7EDC;&#x89C4;&#x5219;&#x3002;&#x5B83;&#x62BD;&#x8C61;&#x4E86;Pods&#x7F51;&#x7EDC;&#x7684;&#x7EC6;&#x8282;&#xFF0C;&#x5E76;&#x5C06;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x7ED9;Pods&#x3002;
&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x540E;&#x9762;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#x66F4;&#x8BE6;&#x7EC6;&#x5730;&#x63A2;&#x8BA8;Pod&#x7F51;&#x7EDC;&#x3002;</p>
<h5 id="addons">Addons</h5>
<!---
    Addons are cluster features and functionality not yet available in Kubernetes, therefore implemented through 3rd-party pods and services.

    DNS - cluster DNS is a DNS server required to assign DNS records to Kubernetes objects and resources
    Dashboard - a general purposed web-based user interface for cluster management
    Monitoring - collects cluster-level container metrics and saves them to a central data store
    Logging - collects cluster-level container logs and saves them to a central log store for analysis.
--->
<p>Addon&#x662F;Kubernetes&#x4E2D;&#x5C1A;&#x672A;&#x63D0;&#x4F9B;&#x7684;&#x96C6;&#x7FA4;&#x7279;&#x6027;&#x548C;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x901A;&#x8FC7;&#x7B2C;&#x4E09;&#x65B9;pod&#x548C;&#x670D;&#x52A1;&#x5B9E;&#x73B0;&#x3002;</p>
<ul>
<li>DNS-&#x96C6;&#x7FA4;DNS&#x662F;&#x5C06;DNS&#x8BB0;&#x5F55;&#x5206;&#x914D;&#x7ED9;Kubernetes&#x5BF9;&#x8C61;&#x548C;&#x8D44;&#x6E90;&#x6240;&#x9700;&#x7684;DNS&#x670D;&#x52A1;&#x5668;</li>
<li>Dashboard-&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x7684;&#x57FA;&#x4E8E;web&#x7684;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7528;&#x6237;&#x754C;&#x9762;</li>
<li>&#x76D1;&#x89C6;-&#x6536;&#x96C6;&#x96C6;&#x7FA4;&#x7EA7;&#x5BB9;&#x5668;&#x5EA6;&#x91CF;&#x5E76;&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x5230;&#x4E2D;&#x5FC3;&#x6570;&#x636E;&#x5B58;&#x50A8;</li>
<li><p>&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;-&#x6536;&#x96C6;&#x7FA4;&#x96C6;&#x7EA7;&#x5BB9;&#x5668;&#x65E5;&#x5FD7;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x5230;&#x4E2D;&#x5FC3;&#x65E5;&#x5FD7;&#x5B58;&#x50A8;&#x4EE5;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x3002;</p>
<h4 id="networking-challenges">Networking Challenges</h4>
<!---
  Decoupled microservices based applications rely heavily on networking in order to mimic the tight-coupling once available in the monolithic era. Networking, in general, is not the easiest to understand and implement. Kubernetes is no exception - as a containerized microservices orchestrator is needs to address 4 distinct networking challenges:

  Container-to-container communication inside Pods
  Pod-to-Pod communication on the same node and across cluster nodes
  Pod-to-Service communication within the same namespace and across cluster namespaces
  External-to-Service communication for clients to access applications in a cluster.
  All these networking challenges must be addressed before deploying a Kubernetes cluster. Next, we will see how we solve these challenges.
--->
<p>&#x57FA;&#x4E8E;&#x89E3;&#x8026;&#x7684;&#x5FAE;&#x670D;&#x52A1;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x4F9D;&#x8D56;&#x4E8E;&#x7F51;&#x7EDC;&#xFF0C;&#x4EE5;&#x6A21;&#x62DF;&#x5728;&#x5355;&#x4E00;&#x7A0B;&#x5E8F;&#x65F6;&#x4EE3;&#x66FE;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x7D27;&#x5BC6;&#x8026;&#x5408;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x7F51;&#x7EDC;&#x5E76;&#x4E0D;&#x662F;&#x6700;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x548C;&#x5B9E;&#x73B0;&#x7684;&#x3002;Kubernetes&#x4E5F;&#x4E0D;&#x4F8B;&#x5916;-&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x5316;&#x7684;&#x5FAE;&#x670D;&#x52A1;&#x7F16;&#x6392;&#x5668;&#xFF0C;&#x9700;&#x8981;&#x89E3;&#x51B3;4&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x7F51;&#x7EDC;&#x6311;&#x6218;&#xFF1A;</p>
</li>
<li>Pods&#x5185;&#x5BB9;&#x5668;&#x5BF9;&#x5BB9;&#x5668;&#x7684;&#x901A;&#x4FE1;</li>
<li>&#x540C;&#x4E00;&#x8282;&#x70B9;&#x4E0A;&#x6216;&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x4E4B;&#x95F4;&#x7684;Pod-to-Pod&#x901A;&#x4FE1;</li>
<li>Pod&#x5230;&#x670D;&#x52A1; &#x5728;&#x540C;&#x4E00;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5185;&#x548C;&#x8DE8;&#x96C6;&#x7FA4;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x901A;&#x4FE1;</li>
<li>&#x5916;&#x90E8;&#x5230;&#x670D;&#x52A1;&#x7684;&#x901A;&#x4FE1;&#xFF0C;&#x4EE5;&#x4FBF;&#x5BA2;&#x6237;&#x7AEF;&#x8BBF;&#x95EE;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;
&#x5728;&#x90E8;&#x7F72;Kubernetes&#x96C6;&#x7FA4;&#x4E4B;&#x524D;&#xFF0C;&#x5FC5;&#x987B;&#x89E3;&#x51B3;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x7F51;&#x7EDC;&#x6311;&#x6218;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x770B;&#x770B;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x8FD9;&#x4E9B;&#x6311;&#x6218;&#x3002;</li>
</ul>
<h5 id="container-to-container-communication-inside-pods">Container-to-Container Communication Inside Pods</h5>
<!---
[^_^]: # Making use of the underlying host operating system's kernel features, a container runtime creates an isolated network space for each container it starts. On Linux, that isolated network space is referred to as a network namespace. A network namespace is shared across containers, or with the host operating system.

[^_^]: # When a Pod is started, a network namespace is created inside the Pod, and all containers running inside the Pod will share that network namespace so that they can talk to each other via localhost.
利用底层主机操作系统的内核特性，容器运行时为它启动的每个容器创建一个独立的网络空间。在Linux上，隔离的网络空间称为网络命名空间。网络命名空间是跨容器或与主机操作系统共享的。
--->
<p>&#x5F53;Pod&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x5728;Pod&#x5185;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#xFF0C;&#x8FD0;&#x884C;&#x5728;Pod&#x5185;&#x7684;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x90FD;&#x5C06;&#x5171;&#x4EAB;&#x8BE5;&#x7F51;&#x7EDC;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#xFF0C;&#x4EE5;&#x4FBF;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;localhost&#x76F8;&#x4E92;&#x901A;&#x4FE1;&#x3002;</p>
<h5 id="pod-to-pod-communication-across-nodes">Pod-to-Pod Communication Across Nodes</h5>
<!---
In a Kubernetes cluster Pods are scheduled on nodes randomly. Regardless of their host node, Pods are expected to be able to communicate with all other Pods in the cluster, all this without the implementation of Network Address Translation (NAT). This is a fundamental requirement of any networking implementation in Kubernetes.

The Kubernetes network model aims to reduce complexity, and it treats Pods as VMs on a network, where each VM receives an IP address - thus each Pod receiving an IP address. This model is called "IP-per-Pod" and ensures Pod-to-Pod communication, just as VMs are able to communicate with each other.

You can try
 Let's not forget about containers though. They share the Pod's network namespace and must coordinate ports assignment inside the Pod just as applications would on a VM, all while being able to communicate with each other on localhost - inside the Pod. However, containers are integrated with the overall Kubernetes networking model through the use of the Container Network Interface (CNI) supported by CNI plugins. CNI is a set of a specification and libraries which allow plugins to configure the networking for containers. While there are a few core plugins, most CNI plugins are 3rd-party Software Defined Networking (SDN) solutions implementing the Kubernetes networking model. In addition to addressing the fundamental requirement of the networking model, some networking solutions offer support for Network Policies. Flannel, Weave, Calico are only a few of the SDN solutions available for Kubernetes clusters.

--->
<p>&#x5728;Kubernetes&#x96C6;&#x7FA4;&#x4E2D;&#xFF0C;pod&#x88AB;&#x968F;&#x673A;&#x5730;&#x5B89;&#x6392;&#x5728;&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x4E0D;&#x7BA1;&#x5B83;&#x4EEC;&#x7684;&#x4E3B;&#x673A;&#x8282;&#x70B9;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;pod&#x90FD;&#x53EF;&#x4EE5;&#x4E0E;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5176;&#x4ED6;pod&#x901A;&#x4FE1;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x5B9E;&#x73B0;&#x7F51;&#x7EDC;&#x5730;&#x5740;&#x8F6C;&#x6362;&#xFF08;Network Address Translation&#xFF0C;NAT&#xFF09;&#x3002;&#x8FD9;&#x662F;Kubernetes&#x4E2D;&#x4EFB;&#x4F55;&#x7F51;&#x7EDC;&#x5B9E;&#x73B0;&#x7684;&#x57FA;&#x672C;&#x8981;&#x6C42;&#x3002;
KubNetes&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#x65E8;&#x5728;&#x964D;&#x4F4E;&#x590D;&#x6742;&#x6027;&#xFF0C;&#x5E76;&#x5C06;POD&#x89C6;&#x4E3A;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;VMS&#xFF0C;&#x5176;&#x4E2D;&#x6BCF;&#x4E2A;VM&#x63A5;&#x6536;IP&#x5730;&#x5740;-&#x56E0;&#x6B64;&#x6BCF;&#x4E2A;POD&#x63A5;&#x6536;IP&#x5730;&#x5740;&#x3002;&#x8FD9;&#x4E2A;&#x6A21;&#x578B;&#x88AB;&#x79F0;&#x4E3A;&#x201C;IP-per-Pod&#x201D;&#xFF0C;&#x786E;&#x4FDD;&#x4E86;Pod&#x5230;Pod&#x7684;&#x901A;&#x4FE1;&#xFF0C;&#x5C31;&#x50CF;vm&#x80FD;&#x591F;&#x76F8;&#x4E92;&#x901A;&#x4FE1;&#x4E00;&#x6837;&#x3002;
&#x4E0D;&#x8FC7;&#xFF0C;&#x522B;&#x5FD8;&#x4E86;&#x5BB9;&#x5668;&#x3002;&#x5B83;&#x4EEC;&#x5171;&#x4EAB;Pod&#x7684;&#x7F51;&#x7EDC;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#xFF0C;&#x5FC5;&#x987B;&#x50CF;VM&#x4E0A;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90A3;&#x6837;&#x534F;&#x8C03;Pod&#x5185;&#x7684;&#x7AEF;&#x53E3;&#x5206;&#x914D;&#xFF0C;&#x540C;&#x65F6;&#x80FD;&#x591F;&#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;&#xFF08;Pod&#x5185;&#xFF09;&#x4E0A;&#x76F8;&#x4E92;&#x901A;&#x4FE1;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x901A;&#x8FC7;&#x4F7F;&#x7528;CNI&#x63D2;&#x4EF6;&#x652F;&#x6301;&#x7684;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#xFF08;CNI&#xFF09;&#xFF0C;&#x5BB9;&#x5668;&#x4E0E;&#x6574;&#x4E2A;Kubernetes&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#x96C6;&#x6210;&#x3002;CNI&#x662F;&#x4E00;&#x7EC4;&#x89C4;&#x8303;&#x548C;&#x5E93;&#xFF0C;&#x5141;&#x8BB8;&#x63D2;&#x4EF6;&#x4E3A;&#x5BB9;&#x5668;&#x914D;&#x7F6E;&#x7F51;&#x7EDC;&#x3002;&#x867D;&#x7136;&#x6709;&#x4E00;&#x4E9B;&#x6838;&#x5FC3;&#x63D2;&#x4EF6;&#xFF0C;&#x4F46;&#x5927;&#x591A;&#x6570;CNI&#x63D2;&#x4EF6;&#x662F;&#x5B9E;&#x73B0;Kubernetes&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x8F6F;&#x4EF6;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#xFF08;SDN&#xFF09;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;&#x9664;&#x4E86;&#x6EE1;&#x8DB3;&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#x7684;&#x57FA;&#x672C;&#x8981;&#x6C42;&#x5916;&#xFF0C;&#x4E00;&#x4E9B;&#x7F51;&#x7EDC;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x8FD8;&#x4E3A;&#x7F51;&#x7EDC;&#x7B56;&#x7565;&#x63D0;&#x4F9B;&#x652F;&#x6301;&#x3002;Flannel, Weave, Calico &#x53EA;&#x662F;Kubernetes&#x96C6;&#x7FA4;&#x53EF;&#x7528;&#x7684;SDN&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x7684;&#x5176;&#x4E2D;&#x51E0;&#x4E2A;&#x3002;
<img src="assets/cka-eab0ca88.png" alt="">
<!---
  The container runtime offloads the IP assignment to CNI, which connects to the underlying configured plugin, such as Bridge or MACvlan, to get the IP address. Once the IP address is given by the respective plugin, CNI forwards it back to the requested container runtime.
  For more details, you can explore the Kubernetes documentation.
--->
&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x5C06;IP&#x5206;&#x914D;&#x7684;&#x4EFB;&#x52A1;&#x53D1;&#x5230;CNI&#xFF0C;CNI&#x8FDE;&#x63A5;&#x5230;&#x5E95;&#x5C42;&#x914D;&#x7F6E;&#x7684;&#x63D2;&#x4EF6;&#xFF08;&#x5982;Bridge&#x6216;MACvlan&#xFF09;&#x4EE5;&#x83B7;&#x53D6;IP&#x5730;&#x5740;&#x3002;&#x4E00;&#x65E6;IP&#x5730;&#x5740;&#x7531;&#x76F8;&#x5E94;&#x7684;&#x63D2;&#x4EF6;&#x7ED9;&#x51FA;&#xFF0C;CNI&#x5C31;&#x4F1A;&#x5C06;&#x5176;&#x8F6C;&#x53D1;&#x56DE;&#x8BF7;&#x6C42;&#x7684;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x3002;</p>
<p>&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x53EF;&#x4EE5;&#x6D4F;&#x89C8;Kubernetes&#x6587;&#x6863;&#x3002;</p>
<h5 id="pod-to-external-world-communication">Pod-to-External World Communication</h5>
<!---
For a successfully deployed containerized applications running in Pods inside a Kubernetes cluster, it requires accessibility from the outside world. Kubernetes enables external accessibility through services, complex constructs which encapsulate networking rules definitions on cluster nodes. By exposing services to the external world with kube-proxy, applications become accessible from outside the cluster over a virtual IP.

We will have a complete chapter dedicated to this, so we will dive into this later.
--->
<p>&#x5BF9;&#x4E8E;&#x5728;Kubernetes&#x96C6;&#x7FA4;&#x5185;&#x7684;Pods&#x4E2D;&#x8FD0;&#x884C;&#x7684;&#x6210;&#x529F;&#x90E8;&#x7F72;&#x7684;&#x5BB9;&#x5668;&#x5316;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x6765;&#x81EA;&#x5916;&#x90E8;&#x4E16;&#x754C;&#x7684;&#x53EF;&#x8BBF;&#x95EE;&#x6027;&#x3002;Kubernetes&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x5B9E;&#x73B0;&#x5916;&#x90E8;&#x53EF;&#x8BBF;&#x95EE;&#x6027;&#xFF0C;&#x8FD9;&#x4E9B;&#x670D;&#x52A1;&#x662F;&#x5C01;&#x88C5;&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x4E0A;&#x7684;&#x7F51;&#x7EDC;&#x89C4;&#x5219;&#x5B9A;&#x4E49;&#x7684;&#x590D;&#x6742;&#x6784;&#x9020;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;kube&#x4EE3;&#x7406;&#x5C06;&#x670D;&#x52A1;&#x516C;&#x5F00;&#x7ED9;&#x5916;&#x90E8;&#x4E16;&#x754C;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x865A;&#x62DF;IP&#x4ECE;&#x96C6;&#x7FA4;&#x5916;&#x90E8;&#x8BBF;&#x95EE;&#x3002;
&#x6211;&#x4EEC;&#x5C06;&#x6709;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x7AE0;&#x8282;&#x4E13;&#x95E8;&#x8BA8;&#x8BBA;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x7A0D;&#x540E;&#x5C06;&#x6DF1;&#x5165;&#x8BA8;&#x8BBA;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<h2 id="chapter-5-installing-kubernetes">Chapter 5. Installing Kubernetes</h2>
<h3 id="introduction-and-learning-objectives">Introduction and Learning Objectives</h3>
<!--
In this chapter, we will first discuss about the different configurations in which Kubernetes can be installed. We will then discuss about the infrastructure requirements to install Kubernetes, and we will also look at some of the tools which can help us with the installation.
By the end of this chapter, you should be able to:
* Discuss about the different Kubernetes configuration options.
* Discuss infrastructure considerations before installing Kubernetes.
* Discuss infrastructure choices for a Kubernetes deployment.
* Review Kubernetes installation tools and resources.
--->
<p>&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x9996;&#x5148;&#x8BA8;&#x8BBA;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;Kubernetes&#x7684;&#x4E0D;&#x540C;&#x914D;&#x7F6E;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x8BA8;&#x8BBA;&#x5B89;&#x88C5;Kubernetes&#x6240;&#x9700;&#x7684;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x5C06;&#x4ECB;&#x7ECD;&#x4E00;&#x4E9B;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#x7684;&#x5DE5;&#x5177;&#x3002;
&#x5728;&#x672C;&#x7AE0;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x60A8;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#xFF1A;</p>
<ul>
<li>&#x8BA8;&#x8BBA;&#x4E0D;&#x540C;&#x7684;Kubernetes&#x914D;&#x7F6E;&#x9009;&#x9879;&#x3002;</li>
<li>&#x5728;&#x5B89;&#x88C5;Kubernetes&#x4E4B;&#x524D;&#x8BA8;&#x8BBA;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x8003;&#x8651;&#x4E8B;&#x9879;&#x3002;</li>
<li>&#x8BA8;&#x8BBA;Kubernetes&#x90E8;&#x7F72;&#x7684;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x9009;&#x62E9;&#x3002;</li>
<li>&#x56DE;&#x987E;Kubernetes&#x5B89;&#x88C5;&#x5DE5;&#x5177;&#x548C;&#x8D44;&#x6E90;&#x3002;</li>
</ul>
<h3 id="installing-kubernetes">Installing Kubernetes</h3>
<h4 id="kubernetes-configuration">Kubernetes Configuration</h4>
<!---
Kubernetes can be installed using different configurations. The four major installation types are briefly presented below:
* All-in-One Single-Node Installation
In this setup, all the master and worker components are installed and running on a single-node. While it is useful for learning, development, and testing, and it should not be used in production. Minikube is one such example, and we are going to explore it in future chapters.
* Single-Node etcd, Single-Master and Multi-Worker Installation
In this setup, we have a single-master node, which also runs a single-node etcd instance. Multiple worker nodes are connected to the master node.
* Single-Node etcd, Multi-Master and Multi-Worker Installation
In this setup, we have multiple-master nodes configured in HA mode, but we have a single-node etcd instance. Multiple worker nodes are connected to the master nodes.
* Multi-Node etcd, Multi-Master and Multi-Worker Installation
In this mode, etcd is configured in clustered HA mode, the master nodes are all configured in HA mode, connecting to multiple worker nodes. This is the most advanced and recommended production setup.
--->
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x914D;&#x7F6E;&#x5B89;&#x88C5;Kubernetes&#x3002;&#x4EE5;&#x4E0B;&#x7B80;&#x8981;&#x4ECB;&#x7ECD;&#x56DB;&#x79CD;&#x4E3B;&#x8981;&#x5B89;&#x88C5;&#x7C7B;&#x578B;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x4F53;&#x5F0F;&#x5355;&#x8282;&#x70B9;&#x5B89;&#x88C5;
&#x5728;&#x6B64;&#x8BBE;&#x7F6E;&#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x4E3B;&#x7EC4;&#x4EF6;&#x548C;&#x5DE5;&#x4F5C;&#x7EC4;&#x4EF6;&#x90FD;&#x5B89;&#x88C5;&#x5728;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x5E76;&#x8FD0;&#x884C;&#x3002;&#x867D;&#x7136;&#x5B83;&#x5BF9;&#x5B66;&#x4E60;&#x3001;&#x5F00;&#x53D1;&#x548C;&#x6D4B;&#x8BD5;&#x5F88;&#x6709;&#x7528;&#xFF0C;&#x4F46;&#x4E0D;&#x5E94;&#x5728;&#x751F;&#x4EA7;&#x4E2D;&#x4F7F;&#x7528;&#x3002;Minikube&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x4EE5;&#x540E;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#x5BF9;&#x6B64;&#x8FDB;&#x884C;&#x63A2;&#x8BA8;&#x3002;</li>
<li>&#x5355;&#x8282;&#x70B9;etcd&#xFF0C;&#x5355;&#x4E3B;&#x591A;&#x5DE5;&#x5B89;&#x88C5;
&#x5728;&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x4E3B;&#x8282;&#x70B9;&#xFF0C;&#x5B83;&#x4E5F;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;etcd&#x5B9E;&#x4F8B;&#x3002;&#x591A;&#x4E2A;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x8FDE;&#x63A5;&#x5230;&#x4E3B;&#x8282;&#x70B9;&#x3002;</li>
<li>&#x5355;&#x8282;&#x70B9;etcd&#xFF0C;&#x591A;&#x4E3B;&#x591A;&#x5DE5;&#x5B89;&#x88C5;
&#x5728;&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5728;HA&#x6A21;&#x5F0F;&#x4E0B;&#x914D;&#x7F6E;&#x4E86;&#x591A;&#x4E2A;&#x4E3B;&#x8282;&#x70B9;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x5355;&#x8282;&#x70B9;etcd&#x5B9E;&#x4F8B;&#x3002;&#x591A;&#x4E2A;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x8FDE;&#x63A5;&#x5230;&#x4E3B;&#x8282;&#x70B9;&#x3002;</li>
<li>&#x591A;&#x8282;&#x70B9;etcd&#x3001;&#x591A;&#x4E3B;&#x591A;&#x5DE5;&#x5B89;&#x88C5;
&#x5728;&#x6B64;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;etcd&#x914D;&#x7F6E;&#x4E3A;&#x96C6;&#x7FA4;HA&#x6A21;&#x5F0F;&#xFF0C;&#x4E3B;&#x8282;&#x70B9;&#x90FD;&#x914D;&#x7F6E;&#x4E3A;HA&#x6A21;&#x5F0F;&#xFF0C;&#x8FDE;&#x63A5;&#x5230;&#x591A;&#x4E2A;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x3002;&#x8FD9;&#x662F;&#x6700;&#x5148;&#x8FDB;&#x548C;&#x63A8;&#x8350;&#x7684;&#x751F;&#x4EA7;&#x8BBE;&#x7F6E;&#x3002;</li>
</ul>
<h4 id="infrastructure-for-kubernetes-installation">Infrastructure for Kubernetes Installation</h4>
<!---
Once we decide on the installation type, we also need to make some infrastructure-related decisions, such as:
* Should we set up Kubernetes on bare metal, public cloud, or private cloud?
* Which underlying OS should we use? Should we choose RHEL, CoreOS, CentOS, or something else?
* Which networking solution should we use?
And so on.
Explore the Kubernetes documentation for details on choosing the right solution. Next, we will take a closer look at these solutions.
--->
<p>&#x4E00;&#x65E6;&#x6211;&#x4EEC;&#x51B3;&#x5B9A;&#x4E86;&#x5B89;&#x88C5;&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x505A;&#x51FA;&#x4E00;&#x4E9B;&#x4E0E;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x76F8;&#x5173;&#x7684;&#x51B3;&#x5B9A;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<ul>
<li>&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5728;&#x88F8;&#x673A;&#x3001;&#x516C;&#x5171;&#x4E91;&#x6216;&#x79C1;&#x6709;&#x4E91;&#x4E0A;&#x8BBE;&#x7F6E;Kubernetes&#x5417;&#xFF1F;</li>
<li>&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x54EA;&#x4E9B;&#x5E95;&#x5C42;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF1F;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x83B1;&#x5C14;&#x3001;&#x79D1;&#x7F57;&#x65AF;&#x3001;&#x68EE;&#x6258;&#x65AF;&#x8FD8;&#x662F;&#x522B;&#x7684;&#x4EC0;&#x4E48;&#xFF1F;</li>
<li>&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x54EA;&#x79CD;&#x7F51;&#x7EDC;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1F;
&#x7B49;&#x7B49;&#x3002;
&#x6709;&#x5173;&#x9009;&#x62E9;&#x6B63;&#x786E;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;Kubernetes&#x6587;&#x6863;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4ED4;&#x7EC6;&#x7814;&#x7A76;&#x8FD9;&#x4E9B;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;<h4 id="localhost-installation">Localhost Installation</h4>
&lt;!---
These are only a few localhost installation options available to deploy single- or multi-node Kubernetes clusters on our workstation/laptop:</li>
<li>Minikube - single-node local Kubernetes cluster</li>
<li>Docker Desktop - single-node local Kubernetes cluster for Windows and Mac</li>
<li>CDK on LXD - multi-node local cluster with LXD containers.
Minikube is the preferred and recommended way to create an all-in-one Kubernetes setup locally. We will be using it extensively in this course.
---&gt;</li>
</ul>
<p>&#x4EE5;&#x4E0B;&#x53EA;&#x662F;&#x51E0;&#x4E2A;&#x672C;&#x5730;&#x4E3B;&#x673A;&#x5B89;&#x88C5;&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x7528;&#x4E8E;&#x5728;&#x5DE5;&#x4F5C;&#x7AD9;/&#x7B14;&#x8BB0;&#x672C;&#x7535;&#x8111;&#x4E0A;&#x90E8;&#x7F72;&#x5355;&#x8282;&#x70B9;&#x6216;&#x591A;&#x8282;&#x70B9;Kubernetes&#x7FA4;&#x96C6;&#xFF1A;</p>
<ul>
<li>Minikube-&#x5355;&#x8282;&#x70B9;&#x672C;&#x5730;Kubernetes&#x96C6;&#x7FA4;</li>
<li>Docker&#x684C;&#x9762;-&#x7528;&#x4E8E;Windows&#x548C;Mac&#x7684;&#x5355;&#x8282;&#x70B9;&#x672C;&#x5730;Kubernetes&#x7FA4;&#x96C6;</li>
<li>LXD&#x4E0A;&#x7684;CDK-&#x5177;&#x6709;LXD&#x5BB9;&#x5668;&#x7684;&#x591A;&#x8282;&#x70B9;&#x672C;&#x5730;&#x7FA4;&#x96C6;&#x3002;
Minikube&#x662F;&#x5728;&#x672C;&#x5730;&#x521B;&#x5EFA;&#x4E00;&#x4F53;&#x5F0F;Kubernetes&#x8BBE;&#x7F6E;&#x7684;&#x9996;&#x9009;&#x548C;&#x63A8;&#x8350;&#x65B9;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x672C;&#x8BFE;&#x7A0B;&#x4E2D;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x5B83;&#x3002;</li>
</ul>
<h4 id="on-premise-installation">On-Premise Installation</h4>
<!---
Kubernetes can be installed on-premise on VMs and bare metal.
* On-Premise VMs
Kubernetes can be installed on VMs created via Vagrant, VMware vSphere, KVM, or another Configuration Management (CM) tool in conjunction with a hypervisor software. There are different tools available to automate the installation, such as Ansible or kubeadm.
* On-Premise Bare Metal
Kubernetes can be installed on on-premise bare metal, on top of different operating systems, like RHEL, CoreOS, CentOS, Fedora, Ubuntu, etc. Most of the tools used to install Kubernetes on VMs can be used with bare metal installations as well.
--->
<p>Kubernetes&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x5728;&#x865A;&#x62DF;&#x673A;&#x548C;&#x88F8;&#x673A;&#x4E0A;&#x3002;</p>
<ul>
<li>&#x5185;&#x90E8;&#x865A;&#x62DF;&#x673A;
Kubernetes&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x5728;&#x901A;&#x8FC7;Vagrant&#x3001;VMware vSphere&#x3001;KVM&#x6216;&#x53E6;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#xFF08;CM&#xFF09;&#x5DE5;&#x5177;&#x548C;&#x7BA1;&#x7406;&#x7A0B;&#x5E8F;&#x8F6F;&#x4EF6;&#x521B;&#x5EFA;&#x7684;vm&#x4E0A;&#x3002;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x5DE5;&#x5177;&#x53EF;&#x7528;&#x4E8E;&#x81EA;&#x52A8;&#x5316;&#x5B89;&#x88C5;&#xFF0C;&#x5982;ansibe&#x6216;kubeadm&#x3002;</li>
<li>&#x5185;&#x90E8;&#x88F8;&#x673A;
Kubernetes&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x5728;&#x672C;&#x5730;&#x88F8;&#x673A;&#x4E0A;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E4B;&#x4E0A;&#xFF0C;&#x5982;RHEL&#x3001;CoreOS&#x3001;CentOS&#x3001;Fedora&#x3001;Ubuntu&#x7B49;&#x3002;&#x5927;&#x591A;&#x6570;&#x7528;&#x4E8E;&#x5728;vm&#x4E0A;&#x5B89;&#x88C5;Kubernetes&#x7684;&#x5DE5;&#x5177;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x88F8;&#x673A;&#x5B89;&#x88C5;&#x3002;<h4 id="cloud-installation">Cloud Installation</h4>
&lt;!---
Kubernetes can be installed and managed on almost any cloud environment:</li>
<li>Hosted Solutions
With Hosted Solutions, any given software is completely managed by the provider. The user pays hosting and management charges. Some of the vendors providing hosted solutions for Kubernetes are:
Kubernetes&#x51E0;&#x4E4E;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x4E91;&#x73AF;&#x5883;&#x4E2D;&#x5B89;&#x88C5;&#x548C;&#x7BA1;&#x7406;&#xFF1A;<ul>
<li>Amazon Elastic Container Service for Kubernetes (EKS)</li>
<li>Google Kubernetes Engine (GKE)</li>
<li>Azure Kubernetes Service (AKS)</li>
<li>DigitalOcean Kubernetes</li>
<li>OpenShift Dedicated</li>
<li>Platform9</li>
<li>IBM Cloud Kubernetes Service.</li>
</ul>
</li>
<li>Turnkey Cloud Solutions
Below are only a few of the Turnkey Cloud Solutions, to install Kubernetes with just a few commands on an underlying IaaS platform, such as:</li>
<li>Google Compute Engine (GCE)</li>
<li>Amazon AWS (AWS EC2)</li>
<li>Microsoft Azure (AKS).</li>
<li>Turnkey On-Premise Solutions
The On-Premise Solutions install Kubernetes on secure internal private clouds with just a few commands:</li>
<li>GKE On-Prem by Google Cloud</li>
<li>IBM Cloud Private</li>
<li><p>OpenShift Container Platform by Red Hat.
----&gt;</p>
</li>
<li><p>&#x6258;&#x7BA1;&#x89E3;&#x51B3;&#x65B9;&#x6848;
&#x5BF9;&#x4E8E;&#x6258;&#x7BA1;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x4EFB;&#x4F55;&#x7ED9;&#x5B9A;&#x7684;&#x8F6F;&#x4EF6;&#x90FD;&#x5B8C;&#x5168;&#x7531;&#x63D0;&#x4F9B;&#x5546;&#x7BA1;&#x7406;&#x3002;&#x7528;&#x6237;&#x652F;&#x4ED8;&#x6258;&#x7BA1;&#x548C;&#x7BA1;&#x7406;&#x8D39;&#x7528;&#x3002;&#x4E3A;Kubernetes&#x63D0;&#x4F9B;&#x6258;&#x7BA1;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x7684;&#x4E00;&#x4E9B;&#x4F9B;&#x5E94;&#x5546;&#x5305;&#x62EC;&#xFF1A;</p>
<ul>
<li>&#x8C37;&#x6B4C;Kubernetes&#x5F15;&#x64CE;&#xFF08;GKE&#xFF09;</li>
<li>Azure Kubernetes&#x670D;&#x52A1;&#xFF08;AKS&#xFF09;</li>
<li>&#x9488;&#x5BF9;Kubernetes&#x7684;Amazon&#x5F39;&#x6027;&#x5BB9;&#x5668;&#x670D;&#x52A1;&#xFF08;EKS&#xFF09;</li>
<li>DigitalOcean Kubernetes</li>
<li>OpenShift Dedicated</li>
<li>Platform9</li>
<li>IBM&#x4E91;Kubernetes&#x670D;&#x52A1;&#x3002;</li>
</ul>
</li>
<li>&#x4EA4;&#x94A5;&#x5319;&#x4E91;&#x89E3;&#x51B3;&#x65B9;&#x6848;
&#x4E0B;&#x9762;&#x53EA;&#x662F;&#x51E0;&#x4E2A;&#x4EA4;&#x94A5;&#x5319;&#x4E91;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x5728;&#x5E95;&#x5C42;IaaS&#x5E73;&#x53F0;&#x4E0A;&#x5B89;&#x88C5;Kubernetes&#x65F6;&#x53EA;&#x9700;&#x8981;&#x51E0;&#x4E2A;&#x547D;&#x4EE4;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;<ul>
<li>&#x8C37;&#x6B4C;&#x8BA1;&#x7B97;&#x5F15;&#x64CE;&#xFF08;GCE&#xFF09;</li>
<li>&#x4E9A;&#x9A6C;&#x900A;AWS&#xFF08;AWS EC2&#xFF09;</li>
<li>&#x5FAE;&#x8F6F;Azure&#xFF08;AKS&#xFF09;&#x3002;</li>
</ul>
</li>
<li>&#x4EA4;&#x94A5;&#x5319;&#x5185;&#x90E8;&#x89E3;&#x51B3;&#x65B9;&#x6848;
&#x672C;&#x5730;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x53EA;&#x9700;&#x51E0;&#x4E2A;&#x547D;&#x4EE4;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x5B89;&#x5168;&#x7684;&#x5185;&#x90E8;&#x79C1;&#x6709;&#x4E91;&#x4E0A;&#x5B89;&#x88C5;Kubernetes&#xFF1A;<ul>
<li>GKE On-Prem by Google Cloud</li>
<li>IBM Cloud Private</li>
<li>OpenShift Container Platform by Red Hat.<h4 id="kubernetes-installation-toolsresources">Kubernetes Installation Tools/Resources</h4>
&lt;!----
While discussing installation configuration and the underlying infrastructure, let&apos;s take a look at some useful tools/resources available:
&#x5728;&#x8BA8;&#x8BBA;&#x5B89;&#x88C5;&#x914D;&#x7F6E;&#x548C;&#x5E95;&#x5C42;&#x57FA;&#x7840;&#x7ED3;&#x6784;&#x65F6;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x4E00;&#x4E9B;&#x6709;&#x7528;&#x7684;&#x5DE5;&#x5177;/&#x8D44;&#x6E90;&#xFF1A;</li>
</ul>
</li>
<li>kubeadm
kubeadm is a first-class citizen on the Kubernetes ecosystem. It is a secure and recommended way to bootstrap a single- or multi-node Kubernetes cluster. It has a set of building blocks to setup the cluster, but it is easily extendable to add more features. Please note that kubeadm does not support the provisioning of hosts.
kubeadm&#x662F;Kubernetes&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x7B49;&#x516C;&#x6C11;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x5B89;&#x5168;&#x4E14;&#x63A8;&#x8350;&#x7684;&#x5F15;&#x5BFC;&#x5355;&#x8282;&#x70B9;&#x6216;&#x591A;&#x8282;&#x70B9;Kubernetes&#x96C6;&#x7FA4;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5B83;&#x6709;&#x4E00;&#x7EC4;&#x6784;&#x5EFA;&#x5757;&#x6765;&#x8BBE;&#x7F6E;&#x96C6;&#x7FA4;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x5F88;&#x5BB9;&#x6613;&#x6269;&#x5C55;&#x4EE5;&#x6DFB;&#x52A0;&#x66F4;&#x591A;&#x7279;&#x6027;&#x3002;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;kubeadm&#x4E0D;&#x652F;&#x6301;&#x63D0;&#x4F9B;&#x4E3B;&#x673A;&#x3002;</li>
<li>kubespray
With kubespray (formerly known as kargo), we can install Highly Available Kubernetes clusters on AWS, GCE, Azure, OpenStack, or bare metal. Kubespray is based on Ansible, and is available on most Linux distributions. It is a Kubernetes Incubator project.
&#x4F7F;&#x7528;kubespray&#xFF08;&#x4EE5;&#x524D;&#x79F0;&#x4E3A;kargo&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;AWS&#x3001;GCE&#x3001;Azure&#x3001;OpenStack&#x6216;&#x88F8;&#x673A;&#x4E0A;&#x5B89;&#x88C5;&#x9AD8;&#x5EA6;&#x53EF;&#x7528;&#x7684;Kubernetes&#x96C6;&#x7FA4;&#x3002;Kubespray&#x57FA;&#x4E8E;ansibe&#xFF0C;&#x5728;&#x5927;&#x591A;&#x6570;Linux&#x53D1;&#x884C;&#x7248;&#x4E0A;&#x90FD;&#x53EF;&#x7528;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5E93;&#x4F2F;&#x5185;&#x7279;&#x65AF;&#x5B75;&#x5316;&#x5668;&#x9879;&#x76EE;&#x3002;</li>
<li>kops
With kops, we can create, destroy, upgrade, and maintain production-grade, highly-available Kubernetes clusters from the command line. It can provision the machines as well. Currently, AWS is officially supported. Support for GCE is in beta, and VMware vSphere in alpha stage, and other platforms are planned for the future. Explore the kops project for more details.
&#x4F7F;&#x7528;kops&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#x521B;&#x5EFA;&#x3001;&#x9500;&#x6BC1;&#x3001;&#x5347;&#x7EA7;&#x548C;&#x7EF4;&#x62A4;&#x751F;&#x4EA7;&#x7EA7;&#x3001;&#x9AD8;&#x53EF;&#x7528;&#x7684;Kubernetes&#x96C6;&#x7FA4;&#x3002;&#x5B83;&#x4E5F;&#x80FD;&#x63D0;&#x4F9B;&#x673A;&#x5668;&#x3002;&#x76EE;&#x524D;&#xFF0C;AWS&#x5F97;&#x5230;&#x4E86;&#x5B98;&#x65B9;&#x652F;&#x6301;&#x3002;&#x5BF9;GCE&#x7684;&#x652F;&#x6301;&#x5904;&#x4E8E;beta&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#xFF0C;VMware vSphere&#x5904;&#x4E8E;alpha&#x9636;&#x6BB5;&#xFF0C;&#x5176;&#x4ED6;&#x5E73;&#x53F0;&#x8BA1;&#x5212;&#x5728;&#x672A;&#x6765;&#x63A8;&#x51FA;&#x3002;&#x63A2;&#x7D22;kops&#x9879;&#x76EE;&#x4E86;&#x89E3;&#x66F4;&#x591A;&#x7EC6;&#x8282;&#x3002;</li>
<li>kube-aws
With kube-aws we can create, upgrade and destroy Kubernetes clusters on AWS from the command line. Kube-aws is also a Kubernetes Incubator project.
&#x4F7F;&#x7528;kube aws&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#x521B;&#x5EFA;&#x3001;&#x5347;&#x7EA7;&#x548C;&#x9500;&#x6BC1;aws&#x4E0A;&#x7684;Kubernetes&#x96C6;&#x7FA4;&#x3002;Kube aws&#x4E5F;&#x662F;Kubernetes&#x5B75;&#x5316;&#x5668;&#x9879;&#x76EE;&#x3002;
If the existing solutions and tools do not fit our requirements, then we can install Kubernetes from scratch (although a dated link from Kubernetes v1.12, it is still a valid solution).
&#x5982;&#x679C;&#x73B0;&#x6709;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x548C;&#x5DE5;&#x5177;&#x4E0D;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x5934;&#x5F00;&#x59CB;&#x5B89;&#x88C5;Kubernetes&#xFF08;&#x5C3D;&#x7BA1;&#x6765;&#x81EA;KubNeNETV1.12&#x7684;&#x4E00;&#x4E2A;&#x8FC7;&#x65F6;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x5B83;&#x4ECD;&#x7136;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF09;&#x3002;
It is worth checking out the Kubernetes The Hard Way GitHub project by Kelsey Hightower, which shares the manual steps involved in bootstrapping a Kubernetes cluster.
&#x503C;&#x5F97;&#x4E00;&#x770B;&#x7684;&#x662F;Kelsey Hightower&#x7684;Kubernetes the Hard Way GitHub&#x9879;&#x76EE;&#xFF0C;&#x8BE5;&#x9879;&#x76EE;&#x5171;&#x4EAB;&#x5F15;&#x5BFC;Kubernetes&#x96C6;&#x7FA4;&#x6240;&#x6D89;&#x53CA;&#x7684;&#x624B;&#x52A8;&#x6B65;&#x9AA4;&#x3002;
----&gt;
&#x5728;&#x8BA8;&#x8BBA;&#x5B89;&#x88C5;&#x914D;&#x7F6E;&#x548C;&#x5E95;&#x5C42;&#x57FA;&#x7840;&#x7ED3;&#x6784;&#x65F6;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x4E00;&#x4E9B;&#x6709;&#x7528;&#x7684;&#x5DE5;&#x5177;/&#x8D44;&#x6E90;&#xFF1A;</li>
<li>kubeadm
kubeadm&#x662F;Kubernetes&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x7B49;&#x516C;&#x6C11;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x5B89;&#x5168;&#x4E14;&#x63A8;&#x8350;&#x7684;&#x5F15;&#x5BFC;&#x5355;&#x8282;&#x70B9;&#x6216;&#x591A;&#x8282;&#x70B9;Kubernetes&#x96C6;&#x7FA4;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5B83;&#x6709;&#x4E00;&#x7EC4;&#x6784;&#x5EFA;&#x5757;&#x6765;&#x8BBE;&#x7F6E;&#x96C6;&#x7FA4;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x5F88;&#x5BB9;&#x6613;&#x6269;&#x5C55;&#x4EE5;&#x6DFB;&#x52A0;&#x66F4;&#x591A;&#x7279;&#x6027;&#x3002;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;kubeadm&#x4E0D;&#x652F;&#x6301;&#x63D0;&#x4F9B;&#x4E3B;&#x673A;&#x3002;</li>
<li>kubespray
&#x4F7F;&#x7528;kubespray&#xFF08;&#x4EE5;&#x524D;&#x79F0;&#x4E3A;kargo&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;AWS&#x3001;GCE&#x3001;Azure&#x3001;OpenStack&#x6216;&#x88F8;&#x673A;&#x4E0A;&#x5B89;&#x88C5;&#x9AD8;&#x5EA6;&#x53EF;&#x7528;&#x7684;Kubernetes&#x96C6;&#x7FA4;&#x3002;Kubespray&#x57FA;&#x4E8E;ansibe&#xFF0C;&#x5728;&#x5927;&#x591A;&#x6570;Linux&#x53D1;&#x884C;&#x7248;&#x4E0A;&#x90FD;&#x53EF;&#x7528;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5E93;&#x4F2F;&#x5185;&#x7279;&#x65AF;&#x5B75;&#x5316;&#x5668;&#x9879;&#x76EE;&#x3002;</li>
<li>kops
&#x4F7F;&#x7528;kops&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#x521B;&#x5EFA;&#x3001;&#x9500;&#x6BC1;&#x3001;&#x5347;&#x7EA7;&#x548C;&#x7EF4;&#x62A4;&#x751F;&#x4EA7;&#x7EA7;&#x3001;&#x9AD8;&#x53EF;&#x7528;&#x7684;Kubernetes&#x96C6;&#x7FA4;&#x3002;&#x5B83;&#x4E5F;&#x80FD;&#x63D0;&#x4F9B;&#x673A;&#x5668;&#x3002;&#x76EE;&#x524D;&#xFF0C;AWS&#x5F97;&#x5230;&#x4E86;&#x5B98;&#x65B9;&#x652F;&#x6301;&#x3002;&#x5BF9;GCE&#x7684;&#x652F;&#x6301;&#x5904;&#x4E8E;beta&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#xFF0C;VMware vSphere&#x5904;&#x4E8E;alpha&#x9636;&#x6BB5;&#xFF0C;&#x5176;&#x4ED6;&#x5E73;&#x53F0;&#x8BA1;&#x5212;&#x5728;&#x672A;&#x6765;&#x63A8;&#x51FA;&#x3002;&#x63A2;&#x7D22;kops&#x9879;&#x76EE;&#x4E86;&#x89E3;&#x66F4;&#x591A;&#x7EC6;&#x8282;&#x3002;</li>
<li>kube-aws
&#x4F7F;&#x7528;kube aws&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#x521B;&#x5EFA;&#x3001;&#x5347;&#x7EA7;&#x548C;&#x9500;&#x6BC1;aws&#x4E0A;&#x7684;Kubernetes&#x96C6;&#x7FA4;&#x3002;Kube aws&#x4E5F;&#x662F;Kubernetes&#x5B75;&#x5316;&#x5668;&#x9879;&#x76EE;&#x3002;</li>
</ul>
<p>&#x5982;&#x679C;&#x73B0;&#x6709;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x548C;&#x5DE5;&#x5177;&#x4E0D;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x5934;&#x5F00;&#x59CB;&#x5B89;&#x88C5;Kubernetes&#xFF08;&#x5C3D;&#x7BA1;&#x6765;&#x81EA;KubNeNETV1.12&#x7684;&#x4E00;&#x4E2A;&#x8FC7;&#x65F6;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x5B83;&#x4ECD;&#x7136;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF09;&#x3002;
&#x503C;&#x5F97;&#x4E00;&#x770B;&#x7684;&#x662F;Kelsey Hightower&#x7684;Kubernetes the Hard Way GitHub&#x9879;&#x76EE;&#xFF0C;&#x8BE5;&#x9879;&#x76EE;&#x5171;&#x4EAB;&#x5F15;&#x5BFC;Kubernetes&#x96C6;&#x7FA4;&#x6240;&#x6D89;&#x53CA;&#x7684;&#x624B;&#x52A8;&#x6B65;&#x9AA4;&#x3002;</p>
<h2 id="chapter-6-minikube---a-local-single-node-kubernetes-cluster">Chapter 6. Minikube - A Local Single-Node Kubernetes Cluster</h2>
<h3 id="introduction-and-learning-objectives">Introduction and Learning Objectives</h3>
<p>As we mentioned in the previous chapter, Minikube is the easiest and most recommended way to run an all-in-one Kubernetes cluster locally on our workstations. In this chapter, we will explore the requirements to install Minikube locally on our workstation, together with the installation instructions to set it up on local Linux, macOS, and Windows operating systems.
&#x5982;&#x524D;&#x4E00;&#x7AE0;&#x6240;&#x8FF0;&#xFF0C;Minikube&#x662F;&#x5728;&#x5DE5;&#x4F5C;&#x7AD9;&#x4E0A;&#x672C;&#x5730;&#x8FD0;&#x884C;&#x4E00;&#x4F53;&#x5F0F;Kubernetes&#x96C6;&#x7FA4;&#x7684;&#x6700;&#x7B80;&#x5355;&#x548C;&#x6700;&#x63A8;&#x8350;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x63A2;&#x8BA8;&#x5728;&#x5DE5;&#x4F5C;&#x7AD9;&#x4E0A;&#x672C;&#x5730;&#x5B89;&#x88C5;Minikube&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x672C;&#x5730;Linux&#x3001;macOS&#x548C;Windows&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E0A;&#x8BBE;&#x7F6E;Minikube&#x7684;&#x5B89;&#x88C5;&#x8BF4;&#x660E;&#x3002;
By the end of this chapter, you should be able to:
&#x5728;&#x672C;&#x7AE0;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x60A8;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#xFF1A;</p>
<ul>
<li>Discuss Minikube.
&#x8BA8;&#x8BBA;Minikube&#x3002;</li>
<li>Install Minikube on local Linux, macOS, and Windows workstation.
&#x5728;&#x672C;&#x5730;Linux&#x3001;macOS&#x548C;Windows&#x5DE5;&#x4F5C;&#x7AD9;&#x4E0A;&#x5B89;&#x88C5;Minikube&#x3002;</li>
<li>Verify the local installation.
&#x9A8C;&#x8BC1;&#x672C;&#x5730;&#x5B89;&#x88C5;&#x3002;<h3 id="minikube---a-local-single-node-kubernetes-cluster">Minikube - A Local Single-Node Kubernetes Cluster</h3>
<sup><a href="#fn__%5E" id="reffn__^">_^</a></sup>:
  Minikube is installed and runs directly on a local Linux, macOS, or Windows workstation. However, in order to fully take advantage of all the features Minikube has to offer, a Type-2 Hypervisor should be installed on the local workstation, to run in conjunction with Minikube. This does not mean that we need to create any VMs with guest operating systems with this Hypervisor.</li>
</ul>
<p>Minikube&#x662F;&#x76F4;&#x63A5;&#x5728;&#x672C;&#x5730;Linux&#x3001;macOS&#x6216;Windows&#x5DE5;&#x4F5C;&#x7AD9;&#x4E0A;&#x5B89;&#x88C5;&#x548C;&#x8FD0;&#x884C;&#x7684;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x4E3A;&#x4E86;&#x5145;&#x5206;&#x5229;&#x7528;Minikube&#x63D0;&#x4F9B;&#x7684;&#x6240;&#x6709;&#x529F;&#x80FD;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x672C;&#x5730;&#x5DE5;&#x4F5C;&#x7AD9;&#x4E0A;&#x5B89;&#x88C5;&#x4E00;&#x4E2A;Type-2&#x7BA1;&#x7406;&#x7A0B;&#x5E8F;&#xFF0C;&#x4E0E;Minikube&#x4E00;&#x8D77;&#x8FD0;&#x884C;&#x3002;&#x8FD9;&#x5E76;&#x4E0D;&#x610F;&#x5473;&#x7740;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7528;&#x8FD9;&#x4E2A;Hypervisor&#x521B;&#x5EFA;&#x4EFB;&#x4F55;&#x5E26;&#x6709;guest&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;vm&#x3002;
<sup><a href="#fn__%5E" id="reffn__^">_^</a></sup>:
    Minikube builds all its infrastructure as long as the Type-2 Hypervisor is installed on our workstation. Minikube invokes the Hypervisor to create a single VM which then hosts a single-node Kubernetes cluster. Thus we need to make sure that we have the necessary hardware and software required by Minikube to build its environment. Below we outline the requirements to run Minikube on our local workstation:</p>
<p>Minikube&#x6784;&#x5EFA;&#x5B83;&#x7684;&#x6240;&#x6709;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#xFF0C;&#x53EA;&#x8981;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x5DE5;&#x4F5C;&#x7AD9;&#x4E0A;&#x5B89;&#x88C5;&#x4E86;Type-2 Hypervisor&#x3002;Minikube&#x8C03;&#x7528;Hypervisor&#x521B;&#x5EFA;&#x4E00;&#x4E2A;VM&#xFF0C;&#x7136;&#x540E;&#x6258;&#x7BA1;&#x4E00;&#x4E2A;&#x8282;&#x70B9;Kubernetes&#x96C6;&#x7FA4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x6211;&#x4EEC;&#x62E5;&#x6709;Minikube&#x6784;&#x5EFA;&#x5176;&#x73AF;&#x5883;&#x6240;&#x9700;&#x7684;&#x5FC5;&#x8981;&#x786C;&#x4EF6;&#x548C;&#x8F6F;&#x4EF6;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6982;&#x8FF0;&#x4E86;&#x5728;&#x672C;&#x5730;&#x5DE5;&#x4F5C;&#x7AD9;&#x4E0A;&#x8FD0;&#x884C;Minikube&#x7684;&#x8981;&#x6C42;&#xFF1A;</p>
<ul>
<li>kubectl
<sup><a href="#fn__%5E" id="reffn__^">_^</a></sup>:
  kubectl is a binary used to access and manage any Kubernetes cluster. It is installed separately from Minikube. Since we will install kubectl after the Minikube installation, we may see warnings during the Minikube initialization - safe to disregard for the time being, but do keep in mind that we will have to install kubectl to be able to manage the Kubernetes cluster. We will explore kubectl in more detail in future chapters.</li>
</ul>
<p>kubectl&#x662F;&#x7528;&#x4E8E;&#x8BBF;&#x95EE;&#x548C;&#x7BA1;&#x7406;&#x4EFB;&#x4F55;Kubernetes&#x96C6;&#x7FA4;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x3002;&#x5B83;&#x4E0E;Minikube&#x5206;&#x5F00;&#x5B89;&#x88C5;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5C06;&#x5728;Minikube&#x5B89;&#x88C5;&#x4E4B;&#x540E;&#x5B89;&#x88C5;kubectl&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x5728;Minikube&#x521D;&#x59CB;&#x5316;&#x671F;&#x95F4;&#x770B;&#x5230;&#x8B66;&#x544A;-&#x6682;&#x65F6;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#xFF0C;&#x4F46;&#x8BF7;&#x8BB0;&#x4F4F;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5B89;&#x88C5;kubectl&#x624D;&#x80FD;&#x7BA1;&#x7406;Kubernetes&#x96C6;&#x7FA4;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x4EE5;&#x540E;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#x66F4;&#x8BE6;&#x7EC6;&#x5730;&#x63A2;&#x8BA8;kubectl&#x3002;</p>
<ul>
<li><p>Type-2 Hypervisor</p>
<ul>
<li>On Linux, VirtualBox or KVM
&#x5728;Linux&#x7528; VirtualBox&#x6216;KVM&#x4E0A;</li>
<li>On macOS VirtualBox, HyperKit, or VMware Fusion
&#x5728;macOS&#x7528;VirtualBox&#x3001;HyperKit&#x6216;VMware Fusion&#x4E0A;</li>
<li>On Windows VirtualBox or Hyper-V
&#x5728;Windows VirtualBox&#x6216;Hyper-V&#x4E0A;
<sup><a href="#fn__%5E" id="reffn__^">_^</a></sup>:
NOTE: Minikube supports a --vm-driver=none option that runs the Kubernetes components directly on the host OS and not inside a VM. With this option a Docker installation is required and a Linux OS on the local workstation, but no hypervisor installation. If you use --vm-driver=none, be sure to specify a bridge network for Docker. Otherwise, it might change between network restarts, causing loss of connectivity to your cluster.</li>
</ul>
<p>&#x6CE8;&#x610F;&#xFF1A;Minikube&#x652F;&#x6301;&#x4E00;&#x4E2A;--vm driver=none&#x9009;&#x9879;&#xFF0C;&#x8BE5;&#x9009;&#x9879;&#x76F4;&#x63A5;&#x5728;&#x4E3B;&#x673A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E0A;&#x8FD0;&#x884C;Kubernetes&#x7EC4;&#x4EF6;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5728;vm&#x4E2D;&#x8FD0;&#x884C;&#x3002;&#x4F7F;&#x7528;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x9700;&#x8981;&#x5B89;&#x88C5;Docker&#x548C;&#x672C;&#x5730;&#x5DE5;&#x4F5C;&#x7AD9;&#x4E0A;&#x7684;Linux&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;&#x4F46;&#x4E0D;&#x9700;&#x8981;&#x5B89;&#x88C5;hypervisor&#x3002;&#x5982;&#x679C;&#x4F7F;&#x7528;--vm driver=none&#xFF0C;&#x8BF7;&#x786E;&#x4FDD;&#x4E3A;Docker&#x6307;&#x5B9A;a bridge network&#x3002;&#x5426;&#x5219;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x5728;&#x7F51;&#x7EDC;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x4E4B;&#x540E;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x5BFC;&#x81F4;&#x4E0E;&#x7FA4;&#x96C6;&#x7684;&#x8FDE;&#x63A5;&#x4E22;&#x5931;&#x3002;</p>
</li>
<li><p>VT-x/AMD-v virtualization must be enabled on the local workstation in BIOS
&#x5FC5;&#x987B;&#x5728;BIOS&#x4E2D;&#x7684;&#x672C;&#x5730;&#x5DE5;&#x4F5C;&#x7AD9;&#x4E0A;&#x542F;&#x7528;VT-x/AMD-v&#x865A;&#x62DF;&#x5316;
<sup><a href="#fn__%5E" id="reffn__^">_^</a></sup>:</p>
<ul>
<li>Internet connection on first Minikube run - to download packages, dependencies, updates and pull images needed to initialize the Minikube Kubernetes cluster. Subsequent runs will require an internet connection only when new Docker images need to be pulled from a container repository or when deployed containerized applications need it. Once an image has been pulled it can be reused without an internet connection.</li>
</ul>
</li>
<li><p>&#x7B2C;&#x4E00;&#x6B21;Minikube&#x8FD0;&#x884C;&#x65F6;&#x7684;Internet&#x8FDE;&#x63A5;-&#x4E0B;&#x8F7D;&#x521D;&#x59CB;&#x5316;Minikube Kubernetes&#x96C6;&#x7FA4;&#x6240;&#x9700;&#x7684;&#x5305;&#x3001;&#x4F9D;&#x8D56;&#x9879;&#x3001;&#x66F4;&#x65B0;&#x548C;&#x62C9;&#x53D6;&#x56FE;&#x50CF;&#x3002;&#x53EA;&#x6709;&#x5728;&#x9700;&#x8981;&#x4ECE;&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x63D0;&#x53D6;&#x65B0;&#x7684;Docker&#x6620;&#x50CF;&#x6216;&#x90E8;&#x7F72;&#x7684;&#x5BB9;&#x5668;&#x5316;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x65F6;&#xFF0C;&#x540E;&#x7EED;&#x8FD0;&#x884C;&#x624D;&#x9700;&#x8981;internet&#x8FDE;&#x63A5;&#x3002;&#x4E00;&#x65E6;&#x56FE;&#x50CF;&#x88AB;&#x63D0;&#x53D6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x6CA1;&#x6709;&#x4E92;&#x8054;&#x7F51;&#x8FDE;&#x63A5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#x3002;</p>
</li>
</ul>
<blockquote id="fn__^">
<sup>_^</sup>. # In this chapter, we use VirtualBox as hypervisor on all three operating systems - Linux, macOS, and Windows, to allow Minikube to provision the VM which hosts the single-node Kubernetes cluster.<a href="#reffn__%5E" title="Jump back to footnote [_^] in the text."> &#x21A9;</a>
</blockquote>
<p>&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;VirtualBox&#x4F5C;&#x4E3A;&#x6240;&#x6709;&#x4E09;&#x4E2A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF08;Linux&#x3001;macOS&#x548C;Windows&#xFF09;&#x4E0A;&#x7684;&#x7BA1;&#x7406;&#x7A0B;&#x5E8F;&#xFF0C;&#x4EE5;&#x5141;&#x8BB8;Minikube&#x63D0;&#x4F9B;&#x6258;&#x7BA1;&#x5355;&#x8282;&#x70B9;Kubernetes&#x96C6;&#x7FA4;&#x7684;VM&#x3002;
<sup><a href="#fn__%5E" id="reffn__^">_^</a></sup>: # Read more about Minikube from the official Kubernetes documentation or GitHub.
&#x4ECE;&#x5B98;&#x65B9;&#x7684;Kubernetes&#x6587;&#x6863;&#x6216;GitHub&#x4E2D;&#x9605;&#x8BFB;&#x66F4;&#x591A;&#x5173;&#x4E8E;Minikube&#x7684;&#x4FE1;&#x606F;&#x3002;</p>
<h3 id="installing-minikube-on-linux">Installing Minikube on Linux</h3>
<p>Let&apos;s learn how to install Minikube v1.0.1 on Ubuntu Linux 18.04 LTS with VirtualBox v6.0 specifically.</p>
<p>NOTE: For other versions, the installation steps may vary! Check the Minikube installation!</p>
<p>Install the VirtualBox hypervisor
Add the source repository for the bionic distribution (Ubuntu 18.04), download and register the public key, update and install:</p>
<pre><code>$ sudo bash -c &apos;echo &quot;deb https://download.virtualbox.org/virtualbox/debian bionic contrib&quot; &gt;&gt; /etc/apt/sources.list&apos;
$ wget -q https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | sudo apt-key add -
$ sudo apt-get update
$ sudo apt-get install -y virtualbox-6.0
</code></pre><p>Install Minikube
We can download the latest release from the Minikube release page. At the time the course was written, the latest Minikube release was v1.0.1. Once downloaded, we need to make it executable and add it to our PATH:</p>
<pre><code class="lang-bash">$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v1.0.1/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/<span class="hljs-built_in">local</span>/bin/
</code></pre>
<p>NOTE: Replacing /v1.0.1/ with /latest/ will always download the latest version.</p>
<p>Start Minikube
We can start Minikube with the minikube start command (disregard &quot;Unable to read.../docker/config...&quot; and &quot;No matching credentials...&quot; warnings):</p>
<pre><code>$ minikube start
minikube v1.0.1 on linux (amd64)
Downloading Minikube ISO ...
142.88 MB / 142.88 MB [============================================] 100.00% 0s
Downloading Kubernetes v1.14.1 images in the background ...
Creating virtualbox VM (CPUs=2, Memory=2048MB, Disk=20000MB) ...
&quot;minikube&quot; IP address is 192.168.99.100
Configuring Docker as the container runtime ...
Version of container runtime is 18.06.3-ce
Waiting for image downloads to complete ...
Preparing Kubernetes environment ...
Downloading kubeadm v1.14.1
Downloading kubelet v1.14.1
Pulling images required by Kubernetes v1.14.1 ...
Launching Kubernetes v1.14.1 using kubeadm ...
Waiting for pods: apiserver proxy etcd scheduler controller dns
Configuring cluster permissions ...
Verifying component health .....
kubectl is now configured to use &quot;minikube&quot;
For best results, install kubectl: https://kubernetes.io/docs/tasks/tools/install-kubectl/
Done! Thank you for using minikube!
</code></pre><p>Check the status
With the minikube status command, we display the status of Minikube:</p>
<pre><code>$ minikube status
host: Running
kubelet: Running
apiserver: Running
kubectl: Correctly Configured: pointing to minikube-vm at 192.168.99.100
</code></pre><p>Stop minikube
With the minikube stop command, we can stop Minikube:</p>
<pre><code class="lang-bash">$ minikube stop
Stopping <span class="hljs-string">&quot;minikube&quot;</span> <span class="hljs-keyword">in</span> virtualbox ...
<span class="hljs-string">&quot;minikube&quot;</span> stopped.
</code></pre>
<h3 id="installing-minikube-on-macos">Installing Minikube on macOS</h3>
<p>&#x592A;&#x7B80;&#x5355;&#x4E0D;&#x7FFB;&#x8BD1;&#x4E86;
Let&apos;s learn how to install Minikube v1.0.1 on Mac OS X with VirtualBox v6.0 specifically.</p>
<p>NOTE: For other versions, the installation steps may vary! Check the Minikube installation!</p>
<p>Although VirtualBox is the default hypervisor for Minikube, on Mac OS X we can configure Minikube at startup to use another hypervisor, with the --vm-driver=xhyve or =hyperkit start option.</p>
<p>Install the VirtualBox hypervisor for OS X hosts
Download and install the .dmg package.</p>
<p>Install Minikube
We can download the latest release from the Minikube release page. At the time the course was written, the latest Minikube release was v1.0.1. Once downloaded, we need to make it executable and add it to our PATH:</p>
<pre><code class="lang-bash">$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v1.0.1/minikube-darwin-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/<span class="hljs-built_in">local</span>/bin/

NOTE: Replacing /v1.0.1/ with /latest/ will always download the latest version.
</code></pre>
<p>Start Minikube
We can start Minikube with the minikube start command (disregard &quot;Unable to read.../docker/config...&quot; and &quot;No matching credentials...&quot; warnings):</p>
<pre><code>$ minikube start
minikube v1.0.1 on darwin (amd64)
Downloading Kubernetes v1.14.1 images in the background ...
Creating virtualbox VM (CPUs=2, Memory=2048MB, Disk=20000MB) ...
Downloading Minikube ISO ...
142.88 MB / 142.88 MB [============================================] 100.00% 0s
&quot;minikube&quot; IP address is 192.168.99.100
Configuring Docker as the container runtime ...
Version of container runtime is 18.06.3-ce
Waiting for image downloads to complete ...
Preparing Kubernetes environment ...
Downloading kubeadm v1.14.1
Downloading kubelet v1.14.1
Pulling images required by Kubernetes v1.14.1 ...
Launching Kubernetes v1.14.1 using kubeadm ...
Waiting for pods: apiserver proxy etcd scheduler controller dns
Configuring cluster permissions ...
Verifying component health .....
kubectl is now configured to use &quot;minikube&quot;
For best results, install kubectl: https://kubernetes.io/docs/tasks/tools/install-kubectl/
Done! Thank you for using minikube!
</code></pre><p>Check the status
With the minikube status command, we display the status of Minikube:</p>
<pre><code class="lang-bash">$ minikube status
host: Running
kubelet: Running
apiserver: Running
kubectl: Correctly Configured: pointing to minikube-vm at 192.168.99.100
</code></pre>
<p>Stop minikube
With the minikube stop command, we can stop Minikube:</p>
<pre><code class="lang-bash">$ minikube stop
Stopping <span class="hljs-string">&quot;minikube&quot;</span> <span class="hljs-keyword">in</span> virtualbox ...
<span class="hljs-string">&quot;minikube&quot;</span> stopped.
</code></pre>
<h3 id="installing-minikube-on-windows">Installing Minikube on Windows</h3>
<p> &#x592A;&#x7B80;&#x5355;&#x4E0D;&#x7FFB;&#x8BD1;&#x4E86;&#x5907;&#x4EFD;&#x4E0B;:
Let&apos;s learn how to install Minikube 1.0.1 on Windows 10 with VirtualBox v6.0.6 specifically.</p>
<p>NOTE: For other versions, the installation steps may vary! Check the Minikube installation!</p>
<p>NOTE: Windows support is currently in experimental phase, and you may encounter issues during installation.</p>
<p>Install the VirtualBox hypervisor for Windows hosts
Download and install the .exe package.</p>
<p>NOTE: Make sure Hyper-V is disabled (if prior installed and used) while running VirtualBox.</p>
<p>Install Minikube
We can download the latest release from the Minikube release page. At the time the course was written, the latest Minikube release was v1.0.1. Once downloaded, we need to make sure it is added to our PATH.</p>
<p>There are two .exe packages available to download for Windows found under Minikube v1.0.1:</p>
<ul>
<li><strong>minikube-windows-amd64.exe</strong> which requires to be added to the PATH: manually</li>
<li><strong>minikube-installer.exe</strong> which automatically adds the executable to the PATH.
Download and install the minikube-installer.exe package found under Minikube v1.0.1.</li>
</ul>
<p>Start Minikube
We can start Minikube using the minikube start command (disregard the &quot;Unable to read...docker\config...&quot; and &quot;No matching credentials...&quot; warnings). Open the PowerShell using the Run as Administrator option and execute the following command:</p>
<pre><code class="lang-bash">PS C:\WINDOWS\system32&gt; minikube start
minikube v1.0.1 on windows (amd64)
Downloading Kubernetes v1.14.1 images <span class="hljs-keyword">in</span> the background ...
Creating virtualbox VM (CPUs=2, Memory=2048MB, Disk=20000MB) ...
Downloading Minikube ISO ...
 0 B / 142.88 MB [-----------------------------------------------------]   0.00%
 142.88 MB / 142.88 MB [============================================] 100.00% 0s
<span class="hljs-string">&quot;minikube&quot;</span> IP address is 192.168.99.100
Configuring Docker as the container runtime ...
Version of container runtime is 18.06.3-ce
Waiting <span class="hljs-keyword">for</span> image downloads to complete ...
Preparing Kubernetes environment ...
Downloading kubeadm v1.14.1
Downloading kubelet v1.14.1
Pulling images required by Kubernetes v1.14.1 ...
Launching Kubernetes v1.14.1 using kubeadm ...
Waiting <span class="hljs-keyword">for</span> pods: apiserver proxy etcd scheduler controller dns
Configuring cluster permissions ...
Verifying component health .....
kubectl is now configured to use <span class="hljs-string">&quot;minikube&quot;</span>
For best results, install kubectl: https://kubernetes.io/docs/tasks/tools/install-kubectl/
Done! Thank you <span class="hljs-keyword">for</span> using minikube!
</code></pre>
<p>Check the status
We can see the status of Minikube using the minikube status command. Open the PowerShell using the Run as Administrator option and execute the following command:</p>
<pre><code class="lang-bash">C:\WINDOWS\system32&gt; minikube status
host: Running
kubelet: Running
apiserver: Running
kubectl: Correctly Configured: pointing to minikube-vm at 192.168.99.100
</code></pre>
<p>Stop Minikube
We can stop Minikube using the minikube stop command. Open the PowerShell using the Run as Administrator option and execute the following command:</p>
<pre><code class="lang-bash">PS C:\WINDOWS\system32&gt; minikube stop
Stopping <span class="hljs-string">&quot;minikube&quot;</span> <span class="hljs-keyword">in</span> virtualbox ...
<span class="hljs-string">&quot;minikube&quot;</span> stopped.
</code></pre>
<h3 id="minikube-cri-o">Minikube CRI-O</h3>
<p>According to the CRI-O website,
&#x6839;&#x636E;CRI-O&#x7F51;&#x7AD9;&#xFF0C;
&quot;CRI-O is an implementation of the Kubernetes CRI (Container Runtime Interface) to enable using OCI (Open Container Initiative) compatible runtimes.&quot;
&#x201C;CRI-O&#x662F;Kubernetes CRI&#xFF08;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x63A5;&#x53E3;&#xFF09;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#xFF0C;&#x7528;&#x4E8E;&#x542F;&#x7528;&#x4E0E;OCI&#xFF08;&#x5F00;&#x653E;&#x5BB9;&#x5668;&#x5021;&#x8BAE;&#xFF09;&#x517C;&#x5BB9;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x3002;&#x201D;
Start Minikube with CRI-O as container runtime, instead of Docker, with the following command:
&#x7528;CRI-O&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x800C;&#x4E0D;&#x662F;Docker&#x542F;&#x52A8;Minikube&#xFF0C;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-bash">$ minikube start --container-runtime=cri-o
minikube v1.0.1 on linux (amd64)
Downloading Kubernetes v1.14.1 images <span class="hljs-keyword">in</span> the background ...
Tip: Use <span class="hljs-string">&apos;minikube start -p &lt;name&gt;&apos;</span> to create a new cluster, or <span class="hljs-string">&apos;minikube delete&apos;</span> to delete this one.
Restarting existing virtualbox VM <span class="hljs-keyword">for</span> <span class="hljs-string">&quot;minikube&quot;</span> ...
Waiting <span class="hljs-keyword">for</span> SSH access ...
<span class="hljs-string">&quot;minikube&quot;</span> IP address is 192.168.99.100
Configuring CRI-O as the container runtime ...
Version of container runtime is 1.13.5
Waiting <span class="hljs-keyword">for</span> image downloads to complete ...
Preparing Kubernetes environment ...
Pulling images required by Kubernetes v1.14.1 ...
Relaunching Kubernetes v1.14.1 using kubeadm ...
Waiting <span class="hljs-keyword">for</span> pods: apiserver etcd scheduler controller
Updating kube-proxy configuration ...
Verifying component health ......
kubectl is now configured to use <span class="hljs-string">&quot;minikube&quot;</span>
For best results, install kubectl: https://kubernetes.io/docs/tasks/tools/install-kubectl/
Done! Thank you <span class="hljs-keyword">for</span> using minikube!
</code></pre>
<p>Let&apos;s login via ssh into the Minikube&apos;s VM:</p>
<pre><code class="lang-bash">$ minikube ssh

                         _             _
            _         _ ( )           ( )
  ___ ___  (_)  ___  (_)| |/<span class="hljs-string">&apos;)  _   _ | |_      __
/&apos;</span> _ ` _ `\| |/<span class="hljs-string">&apos; _ `\| || , &lt;  ( ) ( )| &apos;</span>_`\  /<span class="hljs-string">&apos;__`\
| ( ) ( ) || || ( ) || || |\`\ | (_) || |_) )(  ___/
(_) (_) (_)(_)(_) (_)(_)(_) (_)`\___/&apos;</span>(_,__/<span class="hljs-string">&apos;`\____)

$ _
</span></code></pre>
<p>NOTE: If you try to list containers using the docker command, it will not produce any results, because Docker is not running containers:</p>
<pre><code class="lang-bash">$ sudo docker container ls
Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?
</code></pre>
<p>List the containers created via CRI-O container runtime with the following command:</p>
<pre><code class="lang-bash">$ sudo runc list
ID                                                                 PID         STATUS      BUNDLE                                                                                                                 CREATED                          OWNER
1090869caeea44cb179d31b70ba5b6de96f10a8a5f4286536af5dac1c4312030   3661        running     /run/containers/storage/overlay-containers/1090869caeea44cb179d31b70ba5b6de96f10a8a5f4286536af5dac1c4312030/userdata   2019-04-18T20:03:02.199284303Z   root
1e9f8dce6d535b67822e744204098060ff92e574780a1809adbda48ad8605d06   3614        running     /run/containers/storage/overlay-containers/1e9f8dce6d535b67822e744204098060ff92e574780a1809adbda48ad8605d06/userdata   2019-04-18T20:03:02.129881761Z   root
1edcfc78bca52be153cc9f525d9<span class="hljs-built_in">fc</span>64be75ccea478897004a5032f37c6c4c9dc   3812        running     /run/containers/storage/overlay-containers/1edcfc78bca52be153cc9f525d9<span class="hljs-built_in">fc</span>64be75ccea478897004a5032f37c6c4c9dc/userdata   2019-04-18T20:03:02.740669541Z   root
...
</code></pre>
<h3 id="installing-minikube-demo">Installing Minikube (Demo)</h3>
<h2 id="chapter-7-accessing-minikube">Chapter 7. Accessing Minikube</h2>
<h3 id="introduction-and-learning-objectives">Introduction and Learning Objectives</h3>
<!---
In this chapter, we will study different methods of accessing a Kubernetes cluster. There are a variety of external clients or custom scripts that provide cluster access for administration purposes. We will use kubectl as a CLI tool to access the Minikube Kubernetes cluster, the Kubernetes Dashboard as a web-based user interface to interact with the cluster, and the curl command with the right credentials to access the cluster via APIs.
By the end of this chapter, you should be able to:

* Review methods to access any Kubernetes cluster.
* Configure kubectl for Linux, macOS, and Windows.
* Access the Minikube cluster from the Dashboard.
* Access Minikube via APIs.
--->
<p>&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x7814;&#x7A76;&#x8BBF;&#x95EE;Kubernetes&#x96C6;&#x7FA4;&#x7684;&#x4E0D;&#x540C;&#x65B9;&#x6CD5;&#x3002;&#x6709;&#x591A;&#x79CD;&#x5916;&#x90E8;&#x5BA2;&#x6237;&#x673A;&#x6216;&#x81EA;&#x5B9A;&#x4E49;&#x811A;&#x672C;&#x63D0;&#x4F9B;&#x7528;&#x4E8E;&#x7BA1;&#x7406;&#x76EE;&#x7684;&#x7684;&#x7FA4;&#x96C6;&#x8BBF;&#x95EE;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528;kubectl&#x4F5C;&#x4E3A;CLI&#x5DE5;&#x5177;&#x6765;&#x8BBF;&#x95EE;Minikube Kubernetes&#x96C6;&#x7FA4;&#xFF0C;&#x5C06;Kubernetes&#x4EEA;&#x8868;&#x677F;&#x7528;&#x4F5C;&#x4E0E;&#x96C6;&#x7FA4;&#x4EA4;&#x4E92;&#x7684;&#x57FA;&#x4E8E;web&#x7684;&#x7528;&#x6237;&#x754C;&#x9762;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;curl&#x547D;&#x4EE4;&#xFF0C;&#x8BE5;&#x547D;&#x4EE4;&#x5177;&#x6709;&#x901A;&#x8FC7;api&#x8BBF;&#x95EE;&#x96C6;&#x7FA4;&#x7684;&#x6B63;&#x786E;&#x51ED;&#x636E;&#x3002;
&#x5728;&#x672C;&#x7AE0;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x60A8;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#xFF1A;</p>
<ul>
<li>&#x67E5;&#x770B;&#x8BBF;&#x95EE;&#x4EFB;&#x4F55;Kubernetes&#x96C6;&#x7FA4;&#x7684;&#x65B9;&#x6CD5;&#x3002;</li>
<li>&#x4E3A;Linux&#x3001;macOS&#x548C;Windows&#x914D;&#x7F6E;kubectl&#x3002;</li>
<li>&#x4ECE;&#x4EEA;&#x8868;&#x677F;&#x8BBF;&#x95EE;Minikube&#x7FA4;&#x96C6;&#x3002;</li>
<li>&#x901A;&#x8FC7;API&#x8BBF;&#x95EE;Minikube&#x3002;<h3 id="accessing-minikube">Accessing Minikube</h3>
<h4 id="accessing-minikube">Accessing Minikube</h4>
&lt;!---
Any healthy running Kubernetes cluster can be accessed via any one of the following methods:</li>
</ul>
<p>Command Line Interface (CLI) tools and scripts
Web-based User Interface (Web UI) from a web browser
APIs from CLI or programmatically
These methods are applicable to all Kubernetes clusters.
---&gt;
&#x4EFB;&#x4F55;&#x8FD0;&#x884C;&#x6B63;&#x5E38;&#x7684;Kubernetes&#x96C6;&#x7FA4;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x4EFB;&#x4E00;&#x65B9;&#x6CD5;&#x8BBF;&#x95EE;&#xFF1A;</p>
<ul>
<li>&#x547D;&#x4EE4;&#x884C;&#x754C;&#x9762;&#xFF08;CLI&#xFF09;&#x5DE5;&#x5177;&#x548C;&#x811A;&#x672C;</li>
<li>&#x901A;&#x8FC7;Web&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x57FA;&#x4E8E;Web&#x7684;&#x7528;&#x6237;&#x754C;&#x9762;&#xFF08;Web UI&#xFF09;</li>
<li>&#x901A;&#x8FC7;CLI&#x6216;&#x4EE5;&#x7F16;&#x7A0B;&#x65B9;&#x5F0F;&#x7684;api
&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x9002;&#x7528;&#x4E8E;&#x6240;&#x6709;&#x7684;Kubernetes&#x96C6;&#x7FA4;&#x3002;<h4 id="accessing-minikube-command-line-interface-cli">Accessing Minikube: Command Line Interface (CLI)</h4>
&lt;!---
kubectl is the Kubernetes Command Line Interface (CLI) client to manage cluster resources and applications. It can be used standalone, or part of scripts and automation tools. Once all required credentials and cluster access points have been configured for kubectl it can be used remotely from anywhere to access a cluster.</li>
</ul>
<p>In later chapters, we will be using kubectl to deploy applications, manage and configure Kubernetes resources.
---&gt;
kubectl&#x662F;&#x7528;&#x4E8E;&#x7BA1;&#x7406;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x548C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;Kubernetes&#x547D;&#x4EE4;&#x884C;&#x754C;&#x9762;&#xFF08;CLI&#xFF09;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x4F7F;&#x7528;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x811A;&#x672C;&#x548C;&#x81EA;&#x52A8;&#x5316;&#x5DE5;&#x5177;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x4F7F;&#x7528;&#x3002;&#x4E00;&#x65E6;&#x4E3A;kubectl&#x914D;&#x7F6E;&#x4E86;&#x6240;&#x6709;&#x5FC5;&#x9700;&#x7684;&#x8EAB;&#x4EFD;&#x51ED;&#x636E;&#x548C;&#x96C6;&#x7FA4;&#x8BBF;&#x95EE;&#x70B9;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4ECE;&#x4EFB;&#x4F55;&#x5730;&#x65B9;&#x8FDC;&#x7A0B;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x8BBF;&#x95EE;&#x96C6;&#x7FA4;&#x3002;
&#x5728;&#x540E;&#x9762;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528;kubectl&#x6765;&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3001;&#x7BA1;&#x7406;&#x548C;&#x914D;&#x7F6E;Kubernetes&#x8D44;&#x6E90;&#x3002;</p>
<h4 id="accessing-minikube-web-based-user-interface-web-ui">Accessing Minikube: Web-based User Interface (Web UI)</h4>
<!---
The Kubernetes Dashboard provides a Web-Based User Interface (Web UI) to interact with a Kubernetes cluster to manage resources and containerized applications. In one of the later chapters, we will be using it to deploy a containerized application.
--->
<p>Kubernetes&#x4EEA;&#x8868;&#x677F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;Web&#x7684;&#x7528;&#x6237;&#x754C;&#x9762;(Web UI)&#xFF0C;&#x53EF;&#x4EE5;&#x4E0E;Kubernetes&#x96C6;&#x7FA4;&#x4EA4;&#x4E92;&#x6765;&#x7BA1;&#x7406;&#x8D44;&#x6E90;&#x548C;&#x5BB9;&#x5668;&#x5316;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x5728;&#x540E;&#x9762;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x90E8;&#x7F72;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x5316;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;;</p>
<h4 id="accessing-minikube-apis">Accessing Minikube: APIs</h4>
<!---
As we know, Kubernetes has the API server, and operators/users connect to it from the external world to interact with the cluster. Using both CLI and Web UI, we can connect to the API server running on the master node to perform different operations. We can directly connect to the API server using its API endpoints and send commands to it, as long as we can access the master node and have the right credentials.

Below, we can see a part of the HTTP API space of Kubernetes:

API Server Space

HTTP API Space of Kubernetes



HTTP API space of Kubernetes can be divided into three independent groups:

Core Group (/api/v1)
This group includes objects such as Pods, Services, nodes, namespaces, configmaps, secrets, etc.
Named Group
This group includes objects in /apis/$NAME/$VERSION format. These different API versions imply different levels of stability and support:
Alpha level - it may be dropped at any point in time, without notice. For example, /apis/batch/v2alpha1.
Beta level - it is well-tested, but the semantics of objects may change in incompatible ways in a subsequent beta or stable release. For example, /apis/certificates.k8s.io/v1beta1.
Stable level - appears in released software for many subsequent versions. For example, /apis/networking.k8s.io/v1.
System-wide
This group consists of system-wide API endpoints, like /healthz, /logs, /metrics, /ui, etc.
We can either connect to an API server directly via calling the respective API endpoints or via the CLI/Web UI.

Next, we will see how we can access the Minikube environment we set up in the previous chapter.

--->
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;Kubernetes&#x6709;API&#x670D;&#x52A1;&#x5668;&#xFF0C;operator/&#x7528;&#x6237;&#x4ECE;&#x5916;&#x90E8;&#x4E16;&#x754C;&#x8FDE;&#x63A5;&#x5230;&#x5B83;&#xFF0C;&#x4E0E;&#x96C6;&#x7FA4;&#x4EA4;&#x4E92;&#x3002;&#x4F7F;&#x7528;CLI&#x548C;Web UI&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FDE;&#x63A5;&#x5230;Master Node&#x4E0A;&#x8FD0;&#x884C;&#x7684;API Server&#x6765;&#x6267;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;API&#x7AEF;&#x70B9;&#x76F4;&#x63A5;&#x8FDE;&#x63A5;&#x5230;API&#x670D;&#x52A1;&#x5668;&#x5E76;&#x5411;&#x5176;&#x53D1;&#x9001;&#x547D;&#x4EE4;&#xFF0C;&#x53EA;&#x8981;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x8BBF;&#x95EE;&#x4E3B;&#x8282;&#x70B9;&#x5E76;&#x62E5;&#x6709;&#x6B63;&#x786E;&#x7684;&#x51ED;&#x636E;&#x3002;
&#x4E0B;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;Kubernetes&#x7684;HTTP API&#x7A7A;&#x95F4;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF1A;
<img src="assets/cka-80a25845.png" alt="">
HTTP API Space of Kubernetes</p>
<p>Kubernetes&#x7684;HTTP API&#x7A7A;&#x95F4;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4E09;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x7EC4;&#xFF1A;</p>
<ul>
<li>&#x6838;&#x5FC3;&#x7EC4;&#xFF08;/api/v1&#xFF09;
&#x8BE5;&#x7EC4;&#x5305;&#x62EC;&#x8BF8;&#x5982;Pods&#x3001;services&#x3001;nodes&#x3001;namespaces&#x3001;configmaps&#x3001;secrets&#x7B49;&#x5BF9;&#x8C61;&#x3002;</li>
<li>&#x547D;&#x540D;&#x7EC4;
&#x6B64;&#x7EC4;&#x5305;&#x62EC;/api/$NAME/$VERSION&#x683C;&#x5F0F;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x8FD9;&#x4E9B;&#x4E0D;&#x540C;&#x7684;API&#x7248;&#x672C;&#x610F;&#x5473;&#x7740;&#x4E0D;&#x540C;&#x7684;&#x7A33;&#x5B9A;&#x6027;&#x548C;&#x652F;&#x6301;&#x7EA7;&#x522B;&#xFF1A;
Alpha level&#x6C34;&#x5E73;-&#x5B83;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x65F6;&#x95F4;&#x70B9;&#x4E0B;&#x964D;&#xFF0C;&#x6CA1;&#x6709;&#x901A;&#x77E5;&#x3002;&#x4F8B;&#x5982;&#xFF0C;/apis/batch/v2alpha1&#x3002;
Beta level-&#x5B83;&#x7ECF;&#x8FC7;&#x4E86;&#x5F88;&#x597D;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x968F;&#x540E;&#x7684;Beta&#x6216;&#x7A33;&#x5B9A;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x5BF9;&#x8C61;&#x7684;&#x8BED;&#x4E49;&#x53EF;&#x80FD;&#x4F1A;&#x4EE5;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#x65B9;&#x5F0F;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x3002;&#x4F8B;&#x5982;&#xFF0C;/apis/certificates.k8s.io/v1beta1&#x3002;
Stable level-&#x51FA;&#x73B0;&#x5728;&#x8BB8;&#x591A;&#x540E;&#x7EED;&#x7248;&#x672C;&#x7684;&#x53D1;&#x5E03;&#x8F6F;&#x4EF6;&#x4E2D;&#x3002;&#x4F8B;&#x5982;&#xFF0C;/apis/networking.k8s.io/v1&#x3002;</li>
<li>&#x7CFB;&#x7EDF;&#x8303;&#x56F4;
&#x8FD9;&#x4E2A;&#x7EC4;&#x7531;&#x7CFB;&#x7EDF;&#x8303;&#x56F4;&#x7684;API&#x7AEF;&#x70B9;&#x7EC4;&#x6210;&#xFF0C;&#x5982;/healthz&#x3001;/logs&#x3001;/metrics&#x3001;/ui&#x7B49;&#x3002;</li>
</ul>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;API&#x7AEF;&#x70B9;&#x6216;&#x901A;&#x8FC7;CLI/Web UI&#x76F4;&#x63A5;&#x8FDE;&#x63A5;&#x5230;API&#x670D;&#x52A1;&#x5668;&#x3002;
&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x770B;&#x5230;&#x5982;&#x4F55;&#x8BBF;&#x95EE;&#x6211;&#x4EEC;&#x5728;&#x4E0A;&#x4E00;&#x7AE0;&#x4E2D;&#x8BBE;&#x7F6E;&#x7684;Minikube&#x73AF;&#x5883;&#x3002;</p>
<h4 id="kubectl">kubectl</h4>
<!---
kubectl is generally installed before installing Minikube, but we can also install it after. Once installed, kubectl receives its configuration automatically for Minikube Kubernetes cluster access. However, in other Kubernetes cluster setups, we may need to configure the cluster access points and certificates required by kubectl to access the cluster.

There are different methods that can be used to install kubectl, which are mentioned in the Kubernetes documentation. For best results, it is recommended to keep kubectl at the same version with the Kubernetes run by Minikube - at the time the course was written the latest stable release was v1.14.1. Next, we will look at a few steps to install it on Linux, macOS, and Windows systems.
--->
<p>kubectl&#x901A;&#x5E38;&#x5728;&#x5B89;&#x88C5;Minikube&#x4E4B;&#x524D;&#x5B89;&#x88C5;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x5B89;&#x88C5;&#x4E4B;&#x540E;&#x5B89;&#x88C5;&#x3002;&#x5B89;&#x88C5;&#x540E;&#xFF0C;kubectl&#x4F1A;&#x81EA;&#x52A8;&#x63A5;&#x6536;&#x5176;&#x914D;&#x7F6E;&#xFF0C;&#x4EE5;&#x4FBF;Minikube Kubernetes&#x96C6;&#x7FA4;&#x8BBF;&#x95EE;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x5176;&#x4ED6;Kubernetes&#x96C6;&#x7FA4;&#x8BBE;&#x7F6E;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x914D;&#x7F6E;kubectl&#x8BBF;&#x95EE;&#x96C6;&#x7FA4;&#x6240;&#x9700;&#x7684;&#x96C6;&#x7FA4;&#x8BBF;&#x95EE;&#x70B9;&#x548C;&#x8BC1;&#x4E66;&#x3002;
Kubernetes&#x6587;&#x6863;&#x4E2D;&#x63D0;&#x5230;&#x4E86;&#x5B89;&#x88C5;kubectl&#x7684;&#x4E0D;&#x540C;&#x65B9;&#x6CD5;&#x3002;&#x4E3A;&#x4E86;&#x83B7;&#x5F97;&#x6700;&#x4F73;&#x6548;&#x679C;&#xFF0C;&#x5EFA;&#x8BAE;&#x5C06;kubectl&#x4E0E;Minikube&#x8FD0;&#x884C;&#x7684;Kubernetes&#x4FDD;&#x6301;&#x5728;&#x540C;&#x4E00;&#x7248;&#x672C;&#x4E0A;&#x2014;&#x2014;&#x5728;&#x7F16;&#x5199;&#x8BFE;&#x7A0B;&#x65F6;&#xFF0C;&#x6700;&#x65B0;&#x7684;&#x7A33;&#x5B9A;&#x7248;&#x672C;&#x662F;v1.14.1&#x3002;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x770B;&#x51E0;&#x4E2A;&#x6B65;&#x9AA4;&#x6765;&#x5728;Linux&#x3001;macOS&#x548C;Windows&#x7CFB;&#x7EDF;&#x4E0A;&#x5B89;&#x88C5;&#x5B83;&#x3002;</p>
<h4 id="installing-kubectl-on-linux">Installing kubectl on Linux</h4>
<!---
To install kubectl on Linux, follow the instruction below:

Download the latest stable kubectl binary, make it executable and move it to the PATH:
```bash
$ curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/
```
NOTE: To download and setup a specific version of kubectl (such as v1.14.1), issue the following command:
```bash
$ curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.14.1/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/
```
--->
<h4 id="installing-kubectl-on-macos">Installing kubectl on macOS</h4>
<!---
There are two ways to install kubectl on macOS: manually and using the Homebrew package manager. Next, we will provide instructions for both methods.

To manually install kubectl, download the latest stable kubectl binary, make it executable and move it to the PATH with the following command:

$ curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/darwin/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/

NOTE: To download and setup a specific version of kubectl (such as v1.14.1), issue the following command:

$ curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.14.1/bin/darwin/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/

To install kubectl with Homebrew package manager, issue the following command:

$ brew install kubernetes-cli
--->
<h4 id="installing-kubectl-on-windows">Installing kubectl on Windows</h4>
<!---
To install kubectl, we can download the binary directly or use curl from the CLI. Once downloaded the binary needs to be added to the PATH.

Direct download link for v1.14.1 binary (just click below):

https://storage.googleapis.com/kubernetes-release/release/v1.14.1/bin/windows/amd64/kubectl.exe

NOTE: Obtain the latest kubectl stable release version number from the link below, and if needed edit the download link for the binary from above:

https://storage.googleapis.com/kubernetes-release/release/stable.txt

Use the curl command (if installed) from the CLI:

$ curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.14.1/bin/windows/amd64/kubectl.exe

Once downloaded, move the kubectl binary to the PATH.
--->
<h4 id="kubectl-configuration-file">kubectl Configuration File</h4>
<!---
To access the Kubernetes cluster, the kubectl client needs the master node endpoint and appropriate credentials to be able to interact with the API server running on the master node. While starting Minikube, the startup process creates, by default, a configuration file, config, inside the.kube directory (often referred to as the dot-kube-config file), which resides in the user's home directory. The configuration file has all the connection details required by kubectl. By default, the kubectl binary parses this file to find the master node's connection endpoint, along with credentials. To look at the connection details, we can either see the content of the ~/.kube/config file (on Linux) or run the following command:

$ kubectl config view
apiVersion: v1
clusters:
- cluster:
    certificate-authority: /home/student/.minikube/ca.crt
    server: https://192.168.99.100:8443
  name: minikube
contexts:
- context:
    cluster: minikube
    user: minikube
  name: minikube
current-context: minikube
kind: Config
preferences: {}
users:
- name: minikube
  user:
    client-certificate: /home/student/.minikube/client.crt
    client-key: /home/student/.minikube/client.key

Once kubectl is installed, we can get information about the Minikube cluster with the kubectl cluster-info command:

$ kubectl cluster-info
Kubernetes master is running at https://192.168.99.100:8443
KubeDNS is running at https://192.168.99.100:8443//api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.

You can find more details about the kubectl command line options here.

Although for the Kubernetes cluster installed by Minikube the ~/.kube/config file gets created automatically, this is not the case for Kubernetes clusters installed by other tools. In other cases, the config file has to be created manually and sometimes re-configured to suit various networking and client/server setups.
--->
<p>&#x8981;&#x8BBF;&#x95EE;Kubernetes&#x96C6;&#x7FA4;&#xFF0C;kubectl&#x5BA2;&#x6237;&#x673A;&#x9700;&#x8981;&#x4E3B;&#x8282;&#x70B9;&#x7AEF;&#x70B9;&#x548C;&#x9002;&#x5F53;&#x7684;&#x51ED;&#x636E;&#x624D;&#x80FD;&#x4E0E;&#x4E3B;&#x8282;&#x70B9;&#x4E0A;&#x8FD0;&#x884C;&#x7684;API&#x670D;&#x52A1;&#x5668;&#x4EA4;&#x4E92;&#x3002;&#x542F;&#x52A8;Minikube&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x542F;&#x52A8;&#x8FDB;&#x7A0B;&#x4F1A;&#x5728;.kube&#x76EE;&#x5F55;&#xFF08;&#x901A;&#x5E38;&#x79F0;&#x4E3A;dot-kube&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF09;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;config&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x4F4D;&#x4E8E;&#x7528;&#x6237;&#x7684;&#x4E3B;&#x76EE;&#x5F55;&#x4E2D;&#x3002;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5305;&#x542B;kubectl&#x6240;&#x9700;&#x7684;&#x6240;&#x6709;&#x8FDE;&#x63A5;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;kubectl&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x5C06;&#x5206;&#x6790;&#x6B64;&#x6587;&#x4EF6;&#x4EE5;&#x67E5;&#x627E;&#x4E3B;&#x8282;&#x70B9;&#x7684;&#x8FDE;&#x63A5;&#x7AEF;&#x70B9;&#x4EE5;&#x53CA;&#x51ED;&#x636E;&#x3002;&#x8981;&#x67E5;&#x770B;&#x8FDE;&#x63A5;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x67E5;&#x770B;~/.kube/config&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#xFF08;&#x5728;Linux&#x4E0A;&#xFF09;&#x6216;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code class="lang-bash"><span class="hljs-variable">$kubectl</span> config view
apiVersion: v1
clusters:
- cluster:
   certificate-authority: /home/student/.minikube/ca.crt
   server: https://192.168.99.100:8443
 name: minikube
contexts:
- context:
   cluster: minikube
   user: minikube
 name: minikube
current-context: minikube
kind: Config
preferences: {}
users:
- name: minikube
 user:
   client-certificate: /home/student/.minikube/client.crt
   client-key: /home/student/.minikube/client.key
</code></pre>
<p>&#x5B89;&#x88C5;kubectl&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;kubectl cluster info&#x547D;&#x4EE4;&#x83B7;&#x53D6;&#x6709;&#x5173;Minikube&#x96C6;&#x7FA4;&#x7684;&#x4FE1;&#x606F;&#xFF1A;</p>
<pre><code class="lang-bash">$ kubectl cluster-info
Kubernetes master is running at https://192.168.99.100:8443
KubeDNS is running at https://192.168.99.100:8443//api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use <span class="hljs-string">&apos;kubectl cluster-info dump&apos;</span>.
</code></pre>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x5728;<a href="https://kubernetes.io/docs/reference/kubectl/overview/" target="_blank">&#x8FD9;&#x91CC;</a>&#x627E;&#x5230;&#x6709;&#x5173;kubectl&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;&#x7684;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x3002;
&#x5C3D;&#x7BA1;&#x5BF9;&#x4E8E;Minikube&#x5B89;&#x88C5;&#x7684;Kubernetes&#x96C6;&#x7FA4;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x521B;&#x5EFA;~/.kube/config&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x5B89;&#x88C5;&#x7684;Kubernetes&#x96C6;&#x7FA4;&#xFF0C;&#x60C5;&#x51B5;&#x5E76;&#x975E;&#x5982;&#x6B64;&#x3002;&#x5728;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5FC5;&#x987B;&#x624B;&#x52A8;&#x521B;&#x5EFA;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x6709;&#x65F6;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x4EE5;&#x9002;&#x5E94;&#x5404;&#x79CD;&#x7F51;&#x7EDC;&#x548C;&#x5BA2;&#x6237;&#x673A;/&#x670D;&#x52A1;&#x5668;&#x8BBE;&#x7F6E;&#x3002;</p>
<h4 id="installing-kubectl-cli-client-demo">Installing kubectl CLI Client (Demo)</h4>
<h4 id="kubernetes-dashboard">Kubernetes Dashboard</h4>
<!---
As mentioned earlier, the Kubernetes Dashboard provides a web-based user interface for Kubernetes cluster management. To access the dashboard from Minikube, we can use the minikube dashboard command, which opens a new tab on our web browser, displaying the Kubernetes Dashboard:

$ minikube dashboard

Kubernetes dashboard

Kubernetes Dashboard

NOTE: In case the browser is not opening another tab and does not display the Dashboard as expected, verify the output in your terminal as it may display a link for the Dashboard (together with some Error messages). Copy and paste that link in a new tab of your browser. Depending on your terminal's features you may be able to just click or right-click the link to open directly in the browser. The link may look similar to:

http://127.0.0.1:37751/api/v1/namespaces/kube-system/services/http:kubernetes-dashboard:/proxy/

Chances are that the only difference is the PORT number, which above is 37751. Your port number may be different.

After a logout/login or a reboot of your workstation the normal behavior should be expected (where the minikube dashboard command directly opens a new tab in your browser displaying the Dashboard).
--->
<p>&#x5982;&#x524D;&#x6240;&#x8FF0;&#xFF0C;Kubernetes&#x4EEA;&#x8868;&#x677F;&#x4E3A;Kubernetes&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;web&#x7684;&#x7528;&#x6237;&#x754C;&#x9762;&#x3002;&#x8981;&#x4ECE;Minikube&#x8BBF;&#x95EE;&#x4EEA;&#x8868;&#x677F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Minikube dashboard&#x547D;&#x4EE4;&#xFF0C;&#x8BE5;&#x547D;&#x4EE4;&#x5728;web&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x65B0;&#x9009;&#x9879;&#x5361;&#xFF0C;&#x663E;&#x793A;Kubernetes&#x4EEA;&#x8868;&#x677F;&#xFF1A;</p>
<pre><code class="lang-bash">$ minikube dashboard
</code></pre>
<p><img src="assets/cka-3dd76b7e.png" alt="">
&#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x679C;&#x6D4F;&#x89C8;&#x5668;&#x6CA1;&#x6709;&#x6253;&#x5F00;&#x53E6;&#x4E00;&#x4E2A;&#x9009;&#x9879;&#x5361;&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x6309;&#x9884;&#x671F;&#x663E;&#x793A;&#x4EEA;&#x8868;&#x677F;&#xFF0C;&#x8BF7;&#x9A8C;&#x8BC1;&#x7EC8;&#x7AEF;&#x4E2D;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EF;&#x80FD;&#x4F1A;&#x663E;&#x793A;&#x4EEA;&#x8868;&#x677F;&#x7684;&#x94FE;&#x63A5;&#xFF08;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#xFF09;&#x3002;&#x5C06;&#x8BE5;&#x94FE;&#x63A5;&#x590D;&#x5236;&#x5E76;&#x7C98;&#x8D34;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x65B0;&#x9009;&#x9879;&#x5361;&#x4E2D;&#x3002;&#x6839;&#x636E;&#x7EC8;&#x7AEF;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5355;&#x51FB;&#x6216;&#x53F3;&#x952E;&#x5355;&#x51FB;&#x94FE;&#x63A5;&#x76F4;&#x63A5;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x6253;&#x5F00;&#x3002;&#x94FE;&#x63A5;&#x53EF;&#x80FD;&#x7C7B;&#x4F3C;&#x4E8E;&#xFF1A;
<a href="http://127.0.0.1:37751/api/v1/namespaces/kube-system/services/http:kubernetes-dashboard:/proxy/" target="_blank">http://127.0.0.1:37751/api/v1/namespaces/kube-system/services/http:kubernetes-dashboard:/proxy/</a>
&#x53EF;&#x80FD;&#x552F;&#x4E00;&#x7684;&#x533A;&#x522B;&#x662F;&#x7AEF;&#x53E3;&#x53F7;&#xFF0C;&#x4E0A;&#x9762;&#x662F;37751&#x3002;&#x60A8;&#x7684;&#x7AEF;&#x53E3;&#x53F7;&#x53EF;&#x80FD;&#x4E0D;&#x540C;&#x3002;
&#x6CE8;&#x9500;/&#x767B;&#x5F55;&#x6216;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x7CFB;&#x7EDF;&#x540E;&#xFF0C;&#x5E94;&#x8BE5;&#x5C31;&#x6B63;&#x5E38;&#x4E86;&#xFF08;minikube dashboard&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x6253;&#x5F00;&#x663E;&#x793A;&#x4EEA;&#x8868;&#x677F;&#x7684;&#x65B0;&#x9009;&#x9879;&#x5361;&#xFF09;&#x3002;</p>
<h4 id="the-kubectl-proxy-command">The &apos;kubectl proxy&apos; Command</h4>
<!---
Issuing the kubectl proxy command, kubectl authenticates with the API server on the master node and makes the Dashboard available on a slightly different URL than the one earlier, this time through the proxy port 8001.

First, we issue the kubectl proxy command:

$ kubectl proxy
Starting to serve on 127.0.0.1:8001

It locks the terminal for as long as the proxy is running. With the proxy running we can access the Dashboard over the new URL (just click on it below - it should work on your workstation). Once we stop the proxy (with CTRL + C) the Dashboard is no longer accessible.

http://127.0.0.1:8001/api/v1/namespaces/kube-system/services/kubernetes-dashboard:/proxy/#!/overview?namespace=default

Accessing the Kubernetes dashboard

Kubernetes Dashboard over the proxy
--->
<p>&#x53D1;&#x51FA;kubectl proxy&#x547D;&#x4EE4;&#x540E;&#xFF0C;kubectl&#x5728;&#x4E3B;&#x8282;&#x70B9;&#x4E0A;&#x4F7F;&#x7528;API&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5E76;&#x4F7F;&#x4EEA;&#x8868;&#x677F;&#x5728;&#x7A0D;&#x6709;&#x4E0D;&#x540C;&#x7684;URL&#x4E0A;&#x53EF;&#x7528;&#xFF0C;&#x8FD9;&#x6B21;&#x662F;&#x901A;&#x8FC7;&#x4EE3;&#x7406;&#x7AEF;&#x53E3;8001&#x3002;
&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x51FA;kubectl proxy&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code class="lang-bash">$ kubectl proxy
Starting to serve on 127.0.0.1:8001
</code></pre>
<p>&#x53EA;&#x8981;&#x4EE3;&#x7406;&#x8FD0;&#x884C;&#xFF0C;&#x5B83;&#x5C31;&#x4F1A;&#x9501;&#x5B9A;&#x7EC8;&#x7AEF;&#x3002;&#x8FD0;&#x884C;&#x4EE3;&#x7406;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x65B0;&#x7684;URL&#x8BBF;&#x95EE;&#x4EEA;&#x8868;&#x677F;&#xFF08;&#x53EA;&#x9700;&#x5355;&#x51FB;&#x4E0B;&#x9762;&#x7684;&#x5B83;-&#x5B83;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x5728;&#x60A8;&#x7684;&#x5DE5;&#x4F5C;&#x7AD9;&#x4E0A;&#x5DE5;&#x4F5C;&#xFF09;&#x3002;&#x4E00;&#x65E6;&#x505C;&#x6B62;&#x4EE3;&#x7406;&#xFF08;&#x4F7F;&#x7528;CTRL+C&#xFF09;&#xFF0C;&#x4EEA;&#x8868;&#x677F;&#x5C31;&#x4E0D;&#x518D;&#x53EF;&#x8BBF;&#x95EE;&#x3002;
<a href="http://127.0.0.1:8001/api/v1/namespaces/kube-system/services/kubernetes-dashboard:/proxy/#!/overview?namespace=default" target="_blank">http://127.0.0.1:8001/api/v1/namespaces/kube-system/services/kubernetes-dashboard:/proxy/#!/overview?namespace=default</a>
<img src="assets/cka-581be4bb.png" alt="">
Kubernetes Dashboard over the proxy</p>
<h4 id="apis---with-kubectl-proxy">APIs - with &apos;kubectl proxy&apos;</h4>
<!---
When kubectl proxy is running, we can send requests to the API over the localhost on the proxy port 8001 (from another terminal, since the proxy locks the first terminal):

$ curl http://localhost:8001/
{
 "paths": [
   "/api",
   "/api/v1",
   "/apis",
   "/apis/apps",
   ......
   ......
   "/logs",
   "/metrics",
   "/openapi/v2",
   "/version"
 ]
}

With the above curl request, we requested all the API endpoints from the API server. Clicking on the link above (in the curl command), it will open the same listing output in a browser tab.

We can explore every single path combination with curl or in a browser, such as:

http://localhost:8001/api/v1

http://localhost:8001/apis/apps/v1

http://localhost:8001/healthz

http://localhost:8001/metrics
--->
<p>&#x5F53;kubectl&#x4EE3;&#x7406;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE3;&#x7406;&#x7AEF;&#x53E3;8001&#x4E0A;&#x7684;&#x672C;&#x5730;&#x4E3B;&#x673A;&#x5411;API&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF08;&#x4ECE;&#x53E6;&#x4E00;&#x4E2A;&#x7EC8;&#x7AEF;&#xFF0C;&#x56E0;&#x4E3A;proxy&#x9501;&#x5B9A;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A;&#x7EC8;&#x7AEF;&#xFF09;&#xFF1A;</p>
<pre><code class="lang-bash">$ curl http://localhost:8001/
{
 <span class="hljs-string">&quot;paths&quot;</span>: [
   <span class="hljs-string">&quot;/api&quot;</span>,
   <span class="hljs-string">&quot;/api/v1&quot;</span>,
   <span class="hljs-string">&quot;/apis&quot;</span>,
   <span class="hljs-string">&quot;/apis/apps&quot;</span>,
   ......
   ......
   <span class="hljs-string">&quot;/logs&quot;</span>,
   <span class="hljs-string">&quot;/metrics&quot;</span>,
   <span class="hljs-string">&quot;/openapi/v2&quot;</span>,
   <span class="hljs-string">&quot;/version&quot;</span>
 ]
}
</code></pre>
<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;curl&#x8BF7;&#x6C42;&#xFF0C;&#x6211;&#x4EEC;&#x4ECE;API&#x670D;&#x52A1;&#x5668;&#x8BF7;&#x6C42;&#x4E86;&#x6240;&#x6709;API&#x7AEF;&#x70B9;&#x3002;&#x5355;&#x51FB;&#x4E0A;&#x9762;&#x7684;&#x94FE;&#x63A5;&#xFF08;&#x5728;curl&#x547D;&#x4EE4;&#x4E2D;&#xFF09;&#xFF0C;&#x5B83;&#x5C06;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x9009;&#x9879;&#x5361;&#x4E2D;&#x6253;&#x5F00;&#x76F8;&#x540C;&#x7684;&#x5217;&#x8868;&#x8F93;&#x51FA;&#x3002;
&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;curl&#x6216;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x63A2;&#x7D22;&#x6BCF;&#x4E2A;&#x8DEF;&#x5F84;&#x7EC4;&#x5408;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;
<a href="http://localhost:8001/api/v1" target="_blank">http://localhost:8001/api/v1</a>
<a href="http://localhost:8001/apis/apps/v1" target="_blank">http://localhost:8001/apis/apps/v1</a>
<a href="http://localhost:8001/healthz" target="_blank">http://localhost:8001/healthz</a>
<a href="http://localhost:8001/metrics" target="_blank">http://localhost:8001/metrics</a></p>
<h4 id="apis---without-kubectl-proxy">APIs - without &apos;kubectl proxy&apos;</h4>
<!---
When not using the kubectl proxy, we need to authenticate to the API server when sending API requests. We can authenticate by providing a Bearer Token when issuing a curl, or by providing a set of keys and certificates.

A Bearer Token is an access token which is generated by the authentication server (the API server on the master node) and given back to the client. Using that token, the client can connect back to the Kubernetes API server without providing further authentication details, and then, access resources.

Get the token:

$ TOKEN=$(kubectl describe secret -n kube-system $(kubectl get secrets -n kube-system | grep default | cut -f1 -d ' ') | grep -E '^token' | cut -f2 -d':' | tr -d '\t' | tr -d " ")

Get the API server endpoint:

$ APISERVER=$(kubectl config view | grep https | cut -f 2- -d ":" | tr -d " ")

Confirm that the APISERVER stored the same IP as the Kubernetes master IP by issuing the following 2 commands and comparing their outputs:

$ echo $APISERVER
https://192.168.99.100:8443

$ kubectl cluster-info
Kubernetes master is running at https://192.168.99.100:8443 ...

Access the API server using the curl command, as shown below:

$ curl $APISERVER --header "Authorization: Bearer $TOKEN" --insecure
{
 "paths": [
   "/api",
   "/api/v1",
   "/apis",
   "/apis/apps",
   ......
   ......
   "/logs",
   "/metrics",
   "/openapi/v2",
   "/version"
 ]
}

Instead of the access token, we can extract the client certificate, client key, and certificate authority data from the .kube/config file. Once extracted, they are encoded and then passed with a curl command for authentication. The new curl command looks similar to:

$ curl $APISERVER --cert encoded-cert --key encoded-key --cacert encoded-ca
--->
<p>&#x5F53;&#x4E0D;&#x4F7F;&#x7528;kubectl proxy&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x53D1;&#x9001;API&#x8BF7;&#x6C42;&#x65F6;&#x5411;API&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x53D1;&#x51FA;curl&#x65F6;&#x63D0;&#x4F9B;&#x4E0D;&#x8BB0;&#x540D;&#x4EE4;&#x724C;&#xFF0C;&#x6216;&#x8005;&#x63D0;&#x4F9B;&#x4E00;&#x7EC4;&#x5BC6;&#x94A5;&#x548C;&#x8BC1;&#x4E66;&#x6765;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;
&#x4E0D;&#x8BB0;&#x540D;&#x4EE4;&#x724C;&#x662F;&#x7531;&#x8BA4;&#x8BC1;&#x670D;&#x52A1;&#x5668;&#xFF08;&#x4E3B;&#x8282;&#x70B9;&#x4E0A;&#x7684;API&#x670D;&#x52A1;&#x5668;&#xFF09;&#x751F;&#x6210;&#x5E76;&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;&#x4F7F;&#x7528;&#x8BE5;&#x4EE4;&#x724C;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x8FDE;&#x63A5;&#x56DE;Kubernetes API&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x63D0;&#x4F9B;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x7136;&#x540E;&#x8BBF;&#x95EE;&#x8D44;&#x6E90;&#x3002;
&#x83B7;&#x53D6;&#x4EE4;&#x724C;&#xFF1A;</p>
<pre><code class="lang-bash">$ TOKEN=$(kubectl describe secret -n kube-system $(kubectl get secrets -n kube-system | grep default | cut <span class="hljs-_">-f</span>1 <span class="hljs-_">-d</span> <span class="hljs-string">&apos; &apos;</span>) | grep -E <span class="hljs-string">&apos;^token&apos;</span> | cut <span class="hljs-_">-f</span>2 <span class="hljs-_">-d</span><span class="hljs-string">&apos;:&apos;</span> | tr <span class="hljs-_">-d</span> <span class="hljs-string">&apos;\t&apos;</span> | tr <span class="hljs-_">-d</span> <span class="hljs-string">&quot; &quot;</span>)
</code></pre>
<p>&#x83B7;&#x53D6;API&#x670D;&#x52A1;&#x5668;&#x7EC8;&#x7ED3;&#x70B9;&#xFF1A;</p>
<pre><code class="lang-bash">$ APISERVER=$(kubectl config view | grep https | cut <span class="hljs-_">-f</span> 2- <span class="hljs-_">-d</span> <span class="hljs-string">&quot;:&quot;</span> | tr <span class="hljs-_">-d</span> <span class="hljs-string">&quot; &quot;</span>)
</code></pre>
<p>APISERVER&#x5B58;&#x50A8;&#x7684;IP&#x4E0E;Kubernetes&#x4E3B;IP&#x76F8;&#x540C;. &#x901A;&#x8FC7;&#x4EE5;&#x4E0B;2&#x4E2A;&#x547D;&#x4EE4;&#x5E76;&#x6BD4;&#x8F83;&#x5B83;&#x4EEC;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x786E;&#x8BA4;&#x662F;&#x5426;&#x76F8;&#x540C;&#xFF1A;</p>
<pre><code>$ echo $APISERVER
https://192.168.99.100:8443
$ kubectl cluster-info
Kubernetes master is running at https://192.168.99.100:8443 ...
</code></pre><p>&#x4F7F;&#x7528;curl&#x547D;&#x4EE4;&#x8BBF;&#x95EE;API&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code>$ curl $APISERVER --header &quot;Authorization: Bearer $TOKEN&quot; --insecure
{
 &quot;paths&quot;: [
   &quot;/api&quot;,
   &quot;/api/v1&quot;,
   &quot;/apis&quot;,
   &quot;/apis/apps&quot;,
   ......
   ......
   &quot;/logs&quot;,
   &quot;/metrics&quot;,
   &quot;/openapi/v2&quot;,
   &quot;/version&quot;
 ]
}
</code></pre><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;.kube/config&#x6587;&#x4EF6;&#x4E2D;&#x63D0;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x8BC1;&#x4E66;&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x548C;&#x8BC1;&#x4E66;&#x9881;&#x53D1;&#x673A;&#x6784;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;&#x63D0;&#x53D6;&#x540E;&#xFF0C;&#x5BF9;&#x5B83;&#x4EEC;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;curl&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;&#x65B0;&#x7684;curl&#x547D;&#x4EE4;&#x7C7B;&#x4F3C;&#x4E8E;&#xFF1A;</p>
<pre><code>$ curl $APISERVER --cert encoded-cert --key encoded-key --cacert encoded-ca
</code></pre><h4 id="accessing-the-cluster-with-dashboard-and-query-apis-with-cli-demo">Accessing the Cluster with Dashboard and Query APIs with CLI (Demo)</h4>
<p>&#x89C6;&#x9891;&#x89E3;&#x8BF4;;</p>
<h2 id="chapter-8-kubernetes-building-blocks">Chapter 8. Kubernetes Building Blocks</h2>
<h3 id="introduction-and-learning-objectives">Introduction and Learning Objectives</h3>
<!---
In this chapter, we will explore the Kubernetes object model and discuss some of its fundamental building blocks, such as Pods, ReplicaSets, Deployments, Namespaces, etc. We will also discuss the essential role Labels and Selectors play in a microservices driven architecture as they group decoupled objects together.
--->
<p>&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x63A2;&#x8BA8;Kubernetes&#x5BF9;&#x8C61;&#x6A21;&#x578B;&#xFF0C;&#x5E76;&#x8BA8;&#x8BBA;&#x5B83;&#x7684;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x6784;&#x5EFA;&#x5757;&#xFF0C;&#x5982;Pods&#x3001;ReplicaSets&#x3001;Deployments&#x3001;Namespaces&#x7B49;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x5C06;&#x8BA8;&#x8BBA;Labels&#x548C;Selectors&#x5728;&#x5FAE;&#x670D;&#x52A1;&#x9A71;&#x52A8;&#x7684;&#x4F53;&#x7CFB;&#x7ED3;&#x6784;&#x4E2D;&#x626E;&#x6F14;&#x7684;&#x91CD;&#x8981;&#x89D2;&#x8272;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5C06;&#x5206;&#x79BB;&#x7684;&#x5BF9;&#x8C61;&#x7EC4;&#x5408;&#x5728;&#x4E00;&#x8D77;&#x3002;</p>
<h3 id="kubernetes-building-blocks">Kubernetes Building Blocks</h3>
<h4 id="kubernetes-object-model">Kubernetes Object Model</h4>
<!---
Kubernetes has a very rich object model, representing different persistent entities in the Kubernetes cluster. Those entities describe:

What containerized applications we are running and on which node
Application resource consumption
Different policies attached to applications, like restart/upgrade policies, fault tolerance, etc.
With each object, we declare our intent or the desired state under the spec section. The Kubernetes system manages the status section for objects, where it records the actual state of the object. At any given point in time, the Kubernetes Control Plane tries to match the object's actual state to the object's desired state.

Examples of Kubernetes objects are Pods, ReplicaSets, Deployments, Namespaces, etc. We will explore them next.

When creating an object, the object's configuration data section from below the spec field has to be submitted to the Kubernetes API server. The spec section describes the desired state, along with some basic information, such as the object's name. The API request to create an object must have the spec section, as well as other details. Although the API server accepts object definition files in a JSON format, most often we provide such files in a YAML format which is converted by kubectl in a JSON payload and sent to the API server.

Below is an example of a Deployment object's configuration in YAML format:

apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.15.11
        ports:
        - containerPort: 80

The apiVersion field is the first required field, and it specifies the API endpoint on the API server which we want to connect to; it must match an existing version for the object type defined. The second required field is kind, specifying the object type - in our case it is Deployment, but it can be Pod, Replicaset, Namespace, Service, etc. The third required field metadata, holds the object's basic information, such as name, labels, namespace, etc. Our example shows two spec fields (spec and spec.template.spec). The fourth required field spec marks the beginning of the block defining the desired state of the Deployment object. In our example, we want to make sure that 3 Pods are running at any given time. The Pods are created using the Pods Template defined in spec.template. A nested object, such as the Pod being part of a Deployment, retains its metadata and spec and lose the apiVersion and kind - both being replaced by template. In spec.template.spec, we define the desired state of the Pod. Our Pod creates a single container running the nginx:1.15.11 image from Docker Hub.

Once the Deployment object is created, the Kubernetes system attaches the status field to the object; we will explore it later.

Next, we will take a closer look at some of the Kubernetes objects, along with other building blocks.
--->
<p>Kubernetes&#x6709;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x4E30;&#x5BCC;&#x7684;&#x5BF9;&#x8C61;&#x6A21;&#x578B;&#xFF0C;&#x8868;&#x793A;Kubernetes&#x96C6;&#x7FA4;&#x4E2D;&#x4E0D;&#x540C;&#x7684;&#x6301;&#x4E45;&#x5B9E;&#x4F53;&#x3002;&#x8FD9;&#x4E9B;&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#xFF1A;</p>
<ul>
<li>&#x6211;&#x4EEC;&#x5728;&#x54EA;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x8FD0;&#x884C;&#x54EA;&#x4E9B;&#x5BB9;&#x5668;&#x5316;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</li>
<li>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8D44;&#x6E90;&#x6D88;&#x8017;&#x60C5;&#x51B5;</li>
<li>&#x9644;&#x52A0;&#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4E0D;&#x540C;&#x7B56;&#x7565;&#xFF0C;&#x5982;&#x91CD;&#x65B0;&#x542F;&#x52A8;/&#x5347;&#x7EA7;&#x7B56;&#x7565;&#x3001;&#x5BB9;&#x9519;&#x7B49;&#x3002;
&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x6211;&#x4EEC;&#x5728;spec&#x90E8;&#x5206;&#x58F0;&#x660E;&#x6211;&#x4EEC;&#x7684;&#x610F;&#x56FE;&#x6216;&#x671F;&#x671B;&#x7684;&#x72B6;&#x6001;&#x3002;Kubernetes&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x5BF9;&#x8C61;&#x7684;status&#x90E8;&#x5206;&#xFF0C;&#x5176;&#x4E2D;&#x8BB0;&#x5F55;&#x4E86;&#x5BF9;&#x8C61;&#x7684;&#x5B9E;&#x9645;&#x72B6;&#x6001;&#x3002;&#x5728;&#x4EFB;&#x4F55;&#x7ED9;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x70B9;&#x4E0A;&#xFF0C;Kubernetes&#x63A7;&#x5236;&#x5E73;&#x53F0;&#x90FD;&#x4F1A;&#x5C1D;&#x8BD5;&#x5C06;&#x5BF9;&#x8C61;&#x7684;&#x5B9E;&#x9645;&#x72B6;&#x6001;&#x4E0E;&#x5BF9;&#x8C61;&#x7684;&#x671F;&#x671B;&#x72B6;&#x6001;&#x76F8;&#x5339;&#x914D;&#x3002;</li>
</ul>
<p>Kubernetes&#x5BF9;&#x8C61;&#x6709;Pods&#x3001;ReplicaSets&#x3001;Deployments&#x3001;Namespaces&#x7B49;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x4E0B;&#x4E00;&#x6B65;&#x5BF9;&#x5B83;&#x4EEC;&#x8FDB;&#x884C;&#x63A2;&#x8BA8;&#x3002;</p>
<p>&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x5FC5;&#x987B;&#x5C06;spec&#x5B57;&#x6BB5;&#x4E0B;&#x9762;&#x5BF9;&#x8C61;&#x7684;&#x914D;&#x7F6E;&#x6570;&#x636E;&#x90E8;&#x5206;&#x63D0;&#x4EA4;&#x7ED9;Kubernetes API Server&#x3002;spec&#x90E8;&#x5206;&#x63CF;&#x8FF0;&#x4E86;&#x76EE;&#x6807;&#x72B6;&#x6001;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x5BF9;&#x8C61;&#x7684;&#x540D;&#x79F0;&#x3002;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x7684;API&#x8BF7;&#x6C42;&#x5FC5;&#x987B;&#x5305;&#x542B;spec&#x90E8;&#x5206;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x3002;&#x5C3D;&#x7BA1;API&#x670D;&#x52A1;&#x5668;&#x63A5;&#x53D7;JSON&#x683C;&#x5F0F;&#x7684;&#x5BF9;&#x8C61;&#x5B9A;&#x4E49;&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x4EE5;YAML&#x683C;&#x5F0F;&#x63D0;&#x4F9B;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#xFF0C;kubectl&#x5C06;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x8F6C;&#x6210;JSON&#x5E76;&#x5C06;&#x5176;&#x53D1;&#x9001;&#x5230;API&#x670D;&#x52A1;&#x5668;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F;YAML&#x683C;&#x5F0F;&#x7684;&#x90E8;&#x7F72;&#x5BF9;&#x8C61;&#x914D;&#x7F6E;&#x793A;&#x4F8B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> nginx-deployment
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> nginx
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> nginx
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> nginx
<span class="hljs-attr">        image:</span> nginx:<span class="hljs-number">1.15</span><span class="hljs-number">.11</span>
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">80</span>
</code></pre>
<p>apiVersion&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#x5FC5;&#x586B;&#x5B57;&#x6BB5;&#xFF0C;&#x5B83;&#x6307;&#x5B9A;API&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x8FDE;&#x63A5;&#x5230;&#x7684;API&#x7AEF;&#x70B9;&#xFF0C;&#x5B83;&#x5FC5;&#x987B;&#x4E0E;&#x5DF2;&#x5B9A;&#x4E49;&#x7684;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x7684;&#x73B0;&#x6709;&#x7248;&#x672C;&#x5339;&#x914D;&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x5FC5;&#x9700;&#x5B57;&#x6BB5;&#x662F;kind&#xFF0C;&#x6307;&#x5B9A;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x2014;&#x2014;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#x662F;Deployment&#xFF0C;&#x4F46;&#x5B83;&#x53EF;&#x4EE5;&#x662F;Pod&#x3001;Replicaset&#x3001;Namespace&#x3001;Service&#x7B49;&#x3002;&#x7B2C;&#x4E09;&#x4E2A;&#x5FC5;&#x9700;&#x5B57;&#x6BB5;metadata&#x4FDD;&#x5B58;&#x5BF9;&#x8C61;&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#xFF0C;&#x5982;name, labels, namespace&#x7B49;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x793A;&#x4F8B;&#x663E;&#x793A;&#x4E86;&#x4E24;&#x4E2A;spec&#x5B57;&#x6BB5;&#xFF08;spec&#x548C;spec.template.spec&#xFF09;&#x3002;&#x7B2C;&#x56DB;&#x4E2A;&#x5FC5;&#x9700;&#x7684;&#x5B57;&#x6BB5;spec&#x6807;&#x8BB0;&#x5B9A;&#x4E49;&#x90E8;&#x7F72;&#x5BF9;&#x8C61;&#x6240;&#x9700;&#x72B6;&#x6001;&#x7684;&#x5757;&#x7684;&#x5F00;&#x59CB;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5728;&#x4EFB;&#x4F55;&#x7ED9;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x786E;&#x4FDD;&#x8FD0;&#x884C;3&#x4E2A;pod&#x3002;Pods&#x662F;&#x4F7F;&#x7528;spec.Template&#x4E2D;&#x5B9A;&#x4E49;&#x7684;Pods&#x6A21;&#x677F;&#x521B;&#x5EFA;&#x7684;&#x3002;&#x5D4C;&#x5957;&#x7684;&#x5BF9;&#x8C61;&#xFF08;&#x5982;&#x4F5C;&#x4E3A;&#x90E8;&#x7F72;&#x4E00;&#x90E8;&#x5206;&#x7684;Pod&#xFF09;&#x5C06;&#x4FDD;&#x7559;&#x5176;metadata&#x548C;spec&#xFF0C;&#x4F46;&#x53BB;&#x6389;apiVersion&#x548C;kind&#x2014;&#x2014;&#x4E24;&#x8005;&#x90FD;&#x5C06;&#x88AB;template&#x66FF;&#x6362;&#x3002;&#x5728;spec.template.spec&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;Pod&#x7684;&#x671F;&#x671B;&#x72B6;&#x6001;&#x3002;&#x6211;&#x4EEC;&#x7684;Pod&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;&#x6765;&#x81EA;Docker Hub&#x7684;nginx:1.15.11&#x955C;&#x50CF;&#x7684;&#x5BB9;&#x5668;&#x3002;
&#x4E00;&#x65E6;&#x521B;&#x5EFA;&#x4E86;&#x90E8;&#x7F72;&#x5BF9;&#x8C61;&#xFF0C;Kubernetes&#x7CFB;&#x7EDF;&#x5C31;&#x4F1A;&#x5C06;status&#x5B57;&#x6BB5;&#x9644;&#x52A0;&#x5230;&#x8BE5;&#x5BF9;&#x8C61;&#xFF1B;&#x6211;&#x4EEC;&#x7A0D;&#x540E;&#x5C06;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x7814;&#x7A76;&#x3002;
&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x66F4;&#x6DF1;&#x5165;&#x5730;&#x7814;&#x7A76;&#x4E00;&#x4E9B;Kubernetes&#x5BF9;&#x8C61;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x7EC4;&#x6210;&#x90E8;&#x5206;&#x3002;</p>
<h4 id="pods">Pods</h4>
<!---
A Pod is the smallest and simplest Kubernetes object. It is the unit of deployment in Kubernetes, which represents a single instance of the application. A Pod is a logical collection of one or more containers, which:

Are scheduled together on the same host with the Pod
Share the same network namespace
Have access to mount the same external storage (volumes).


A pod is a collection of one or more containers

Pods



Pods are ephemeral in nature, and they do not have the capability to self-heal by themselves. That is the reason they are used with controllers which handle Pods' replication, fault tolerance, self-healing, etc. Examples of controllers are Deployments, ReplicaSets, ReplicationControllers, etc. We attach a nested Pod's specification to a controller object using the Pod Template, as we have seen in the previous section.

Below is an example of a Pod object's configuration in YAML format:

apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
  labels:
    app: nginx
spec:
  containers:
  - name: nginx
    image: nginx:1.15.11
    ports:
    - containerPort: 80

The apiVersion field is must specify v1 for the Pod object definition. The second required field is kind specifying the Pod object type. The third required field metadata, holds the object's name and label. The fourth required field spec marks the beginning of the block defining the desired state of the Pod object - also named the PodSpec. Our Pod creates a single container running the nginx:1.15.11 image from Docker Hub.
--->
<p>Pod&#x662F;&#x6700;&#x5C0F;&#x6700;&#x7B80;&#x5355;&#x7684;Kubernetes&#x5BF9;&#x8C61;&#x3002;&#x5B83;&#x662F;Kubernetes&#x4E2D;&#x7684;&#x90E8;&#x7F72;&#x5355;&#x5143;&#xFF0C;&#x8868;&#x793A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5355;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;Pod&#x662F;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x903B;&#x8F91;&#x96C6;&#x5408;&#xFF0C;&#x5BB9;&#x5668;&#x6709;&#x5982;&#x4E0B;&#x7279;&#x70B9;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x4E2A;/&#x591A;&#x4E2A;Container&#x4E0E;Pod&#x7F16;&#x6392;&#x5728;&#x540C;&#x4E00;&#x4E3B;&#x673A;&#x4E0A;</li>
<li>&#x5171;&#x4EAB;&#x76F8;&#x540C;&#x7684;&#x7F51;&#x7EDC;&#x547D;&#x540D;&#x7A7A;&#x95F4;</li>
<li>&#x8BBF;&#x95EE;&#x76F8;&#x540C;&#x7684;&#x5916;&#x90E8;&#x5B58;&#x50A8;&#xFF08;&#x5377;&#xFF09;&#x3002;
<img src="assets/cka-782e5474.png" alt="">
Pods&#x662F;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x96C6;&#x5408;</li>
</ul>
<p>&#x4E8B;&#x5B9E;&#x4E0A;Pod&#x662F;&#x77ED;&#x6682;&#x7684;&#xFF0C;&#x5B83;&#x4EEC;&#x6CA1;&#x6709;&#x81EA;&#x6211;&#x6062;&#x590D;&#x80FD;&#x529B;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5B83;&#x4EEC;&#x9700;&#x8981;&#x4E0E;&#x5904;&#x7406;Pod&#x7684;&#x590D;&#x5236;&#x3001;&#x5BB9;&#x9519;&#x3001;&#x6062;&#x590D;&#x7B49;&#x7684;&#x63A7;&#x5236;&#x5668;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x3002;&#x63A7;&#x5236;&#x5668;&#x6709;Deployments, ReplicaSets, ReplicationControllers&#x7B49;&#x3002;&#x6211;&#x4EEC;&#x4F7F;&#x7528;Pod&#x6A21;&#x677F;&#x5C06;&#x5D4C;&#x5957;Pod&#x7684;spec&#x9644;&#x52A0;&#x5230;&#x63A7;&#x5236;&#x5668;&#x5BF9;&#x8C61;&#xFF0C;&#x5982;&#x524D;&#x4E00;&#x8282;&#x6240;&#x793A;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F;YAML&#x683C;&#x5F0F;&#x7684;Pod&#x5BF9;&#x8C61;&#x914D;&#x7F6E;&#x793A;&#x4F8B;&#xFF1A;</p>
<pre><code class="lang-YAML"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> nginx-pod
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> nginx
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx:<span class="hljs-number">1.15</span><span class="hljs-number">.11</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - containerPort:</span> <span class="hljs-number">80</span>
</code></pre>
<p>apiVersion&#x5B57;&#x6BB5;&#x4E3A;Pod&#x5BF9;&#x8C61;&#x5B9A;&#x4E49;&#x6307;&#x5B9A;&quot;v1&quot;&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x5FC5;&#x9700;&#x5B57;&#x6BB5;&#x662F;&#x6307;&#x5B9A;Pod&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x7684;kind&#x3002;&#x7B2C;&#x4E09;&#x4E2A;&#x5FC5;&#x9700;&#x7684;&#x5B57;&#x6BB5;&#x5143;&#x6570;&#x636E;&#x5305;&#x542B;&#x5BF9;&#x8C61;&#x7684;&#x540D;&#x79F0;&#x548C;&#x6807;&#x7B7E;&#x3002;&#x7B2C;&#x56DB;&#x4E2A;&#x5FC5;&#x9700;&#x7684;&#x5B57;&#x6BB5;spec&#x5B9A;&#x4E49;Pod&#x5BF9;&#x8C61;&#x6240;&#x9700;&#x72B6;&#x6001;&#xFF0C;&#x4E5F;&#x79F0;&#x4E3A;Pod spec&#x3002;&#x6211;&#x4EEC;&#x7684;Pod&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;&#x6765;&#x81EA;Docker Hub&#x7684;nginx:1.15.11 &#x955C;&#x50CF;&#x7684;&#x5BB9;&#x5668;&#x3002;</p>
<h4 id="labels">Labels</h4>
<!---
Labels are key-value pairs attached to Kubernetes objects (e.g. Pods, ReplicaSets). Labels are used to organize and select a subset of objects, based on the requirements in place. Many objects can have the same Label(s). Labels do not provide uniqueness to objects. Controllers use Labels to logically group together decoupled objects, rather than using objects' names or IDs.



Labels



In the image above, we have used two Label keys: app and env. Based on our requirements, we have given different values to our four Pods. The Label env=dev logically selects and groups the top two Pods, while the Lable app=frontend logically selects and groups the left two Pods. We can select one of the four Pods - bottom left, by selecting two Labels: app=frontend and env=qa.
--->
<p>Label&#x662F;&#x9644;&#x52A0;&#x5230;Kubernetes&#x5BF9;&#x8C61;&#xFF08;&#x4F8B;&#x5982;Pods&#x3001;ReplicaSets&#xFF09;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x3002;&#x6807;&#x7B7E;&#x7528;&#x4E8E;&#x6839;&#x636E;&#x73B0;&#x6709;&#x9700;&#x6C42;&#x7EC4;&#x7EC7;&#x548C;&#x9009;&#x62E9;&#x5BF9;&#x8C61;&#x7684;&#x5B50;&#x96C6;&#x3002;&#x8BB8;&#x591A;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x5177;&#x6709;&#x76F8;&#x540C;&#x7684;&#x6807;&#x7B7E;&#x3002;&#x6807;&#x7B7E;&#x4E0D;&#x80FD;&#x4E3A;&#x5BF9;&#x8C61;&#x63D0;&#x4F9B;&#x552F;&#x4E00;&#x6027;&#x3002;&#x63A7;&#x5236;&#x5668;&#x4F7F;&#x7528;&#x6807;&#x7B7E;&#x5C06;&#x5206;&#x79BB;&#x7684;&#x5BF9;&#x8C61;&#x903B;&#x8F91;&#x5730;&#x7EC4;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;&#x5BF9;&#x8C61;&#x7684;&#x540D;&#x79F0;&#x6216;id&#x3002;
<img src="assets/cka-7a5d207a.png" alt="">
&#x5728;&#x4E0A;&#x56FE;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;&#x4E24;&#x4E2A;Label&#x7684;Key&#xFF1A;app&#x548C;env&#x3002;&#x6839;&#x636E;&#x6211;&#x4EEC;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x6211;&#x4EEC;&#x7ED9;&#x4E86;&#x56DB;&#x4E2A;&#x540A;&#x8231;&#x4E0D;&#x540C;&#x7684;&#x4EF7;&#x503C;&#x3002;Label env=dev&#x5728;&#x903B;&#x8F91;&#x4E0A;&#x9009;&#x62E9;&#x5E76;&#x5206;&#x7EC4;&#x524D;&#x4E24;&#x4E2A;pod&#xFF0C;&#x800C;Lable app=frontend&#x5728;&#x903B;&#x8F91;&#x4E0A;&#x9009;&#x62E9;&#x5E76;&#x5206;&#x7EC4;&#x5DE6;&#x4E24;&#x4E2A;pod&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x5DE6;&#x4E0B;&#x89D2;&#x7684;&#x56DB;&#x4E2A;pod&#x4E2D;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#xFF0C;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x6807;&#x7B7E;&#xFF1A;app=frontend&#x548C;env=qa&#x3002;</p>
<h4 id="label-selectors">Label Selectors</h4>
<!---
Controllers use Label Selectors to select a subset of objects. Kubernetes supports two types of Selectors:

Equality-Based Selectors
Equality-Based Selectors allow filtering of objects based on Label keys and values. Matching is achieved using the =, == (equals, used interchangeably), or != (not equals) operators. For example, with env==dev or env=dev we are selecting the objects where the env Label key is set to value dev.
Set-Based Selectors
Set-Based Selectors allow filtering of objects based on a set of values. We can use in, notin operators for Label values, and exist/does not exist operator for Label keys. For example, with env in (dev,qa) we are selecting objects where the env Label is set to either dev or qa; with !app we select objects with no Label key app.

--->
<p>Controllers&#x4F7F;&#x7528;&#x6807;&#x7B7E;&#x9009;&#x62E9;&#x5668;&#x9009;&#x62E9;&#x5BF9;&#x8C61;&#x7684;&#x5B50;&#x96C6;&#x3002;Kubernetes&#x652F;&#x6301;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x9009;&#x62E9;&#x5668;&#xFF1A;</p>
<ul>
<li>&#x57FA;&#x4E8E;&#x7B49;&#x5F0F;&#x7684;&#x9009;&#x62E9;&#x5668;
&#x57FA;&#x4E8E;&#x76F8;&#x7B49;&#x7684;&#x9009;&#x62E9;&#x5668;&#x5141;&#x8BB8;&#x57FA;&#x4E8E;&#x6807;&#x7B7E;&#x952E;&#x548C;&#x503C;&#x7B5B;&#x9009;&#x5BF9;&#x8C61;&#x3002;&#x4F7F;&#x7528;=&#xFF0C;==&#xFF08;&#x7B49;&#x4E8E;&#xFF0C;&#x53EF;&#x66FF;&#x6362;&#x4F7F;&#x7528;&#xFF09;&#x6216;&#xFF01;=&#xFF08;&#x4E0D;&#x7B49;&#x4E8E;&#xFF09;&#x8FD0;&#x7B97;&#x7B26;&#x5B9E;&#x73B0;&#x5339;&#x914D;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5BF9;&#x4E8E;env==dev&#x6216;env=dev&#xFF0C;&#x6211;&#x4EEC;&#x9009;&#x62E9;env Label&#x952E;&#x8BBE;&#x7F6E;&#x4E3A;value dev&#x7684;&#x5BF9;&#x8C61;&#x3002;</li>
<li>&#x57FA;&#x4E8E;&#x96C6;&#x5408;&#x7684;&#x9009;&#x62E9;&#x5668;
&#x57FA;&#x4E8E;&#x96C6;&#x5408;&#x7684;&#x9009;&#x62E9;&#x5668;&#x5141;&#x8BB8;&#x57FA;&#x4E8E;&#x4E00;&#x7EC4;&#x503C;&#x7B5B;&#x9009;&#x5BF9;&#x8C61;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;In&#xFF0C;NOTIN&#x64CD;&#x4F5C;&#x7B26;&#x4E2D;&#x7B5B;&#x9009;&#x6807;&#x7B7E;Value&#xFF0C;&#x4EE5;&#x53CA;&#x7528;exist/not exist&#x64CD;&#x4F5C;&#x7B26;&#x7B5B;&#x9009;&#x6807;&#x7B7E;&#x7684;Key&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4F7F;&#x7528;env in&#xFF08;dev&#xFF0C;qa&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x9009;&#x62E9;env&#x6807;&#x7B7E;&#x8BBE;&#x7F6E;&#x4E3A;dev&#x6216;qa&#x7684;&#x5BF9;&#x8C61;; !app&#x9009;&#x62E9;&#x6CA1;&#x6709;&#x6807;&#x7B7E;app&#x7684;&#x5BF9;&#x8C61;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;
<img src="assets/cka-343d876c.png" alt=""><h4 id="replicationcontrollers">ReplicationControllers</h4>
&lt;!----
Although no longer a recommended method, a ReplicationController is a controller that ensures a specified number of replicas of a Pod is running at any given time. If there are more Pods than the desired count, a replication controller would terminate the extra Pods, and, if there are fewer Pods, then the replication controller would create more Pods to match the desired count. Generally, we don&apos;t deploy a Pod independently, as it would not be able to re-start itself if terminated in error. The recommended method is to use some type of replication controllers to create and manage Pods.</li>
</ul>
<p>The default controller is a Deployment which configures a ReplicaSet to manage Pods&apos; lifecycle.
---&gt;
&#x867D;&#x7136;&#x4E0D;&#x518D;&#x63A8;&#x8350;&#xFF0C;&#x4F46;ReplicationController&#x662F;&#x4E00;&#x79CD;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x786E;&#x4FDD;&#x5728;&#x4EFB;&#x4F55;&#x7ED9;&#x5B9A;&#x65F6;&#x95F4;&#x8FD0;&#x884C;&#x6307;&#x5B9A;&#x6570;&#x91CF;&#x7684;Pod&#x526F;&#x672C;&#x3002;&#x5982;&#x679C;pod&#x591A;&#x4E8E;&#x6240;&#x9700;&#x6570;&#x91CF;&#xFF0C;&#x5219;ReplicationController&#x5C06;&#x7EC8;&#x6B62;&#x989D;&#x5916;&#x7684;pod&#xFF1B;&#x5982;&#x679C;pod&#x8F83;&#x5C11;&#xFF0C;&#x5219;&#x590D;&#x5236;&#x63A7;&#x5236;&#x5668;&#x5C06;&#x521B;&#x5EFA;&#x66F4;&#x591A;&#x7684;pod&#x4EE5;&#x5339;&#x914D;&#x6240;&#x9700;&#x6570;&#x91CF;&#x3002;&#x901A;&#x5E38;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x4F1A;&#x72EC;&#x7ACB;&#x90E8;&#x7F72;Pod&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x56E0;&#x4E3A;&#x9519;&#x8BEF;&#x7EC8;&#x6B62;&#xFF0C;&#x5B83;&#x5C06;&#x65E0;&#x6CD5;&#x81EA;&#x5DF1;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x3002;&#x63A8;&#x8350;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;&#x67D0;&#x79CD;&#x7C7B;&#x578B;&#x7684;ReplicationController&#x6765;&#x521B;&#x5EFA;&#x548C;&#x7BA1;&#x7406;pod&#x3002;
&#x9ED8;&#x8BA4;&#x63A7;&#x5236;&#x5668;&#x662F;&#x4E00;&#x4E2A;Deployment &#xFF0C;&#x5B83;&#x5C06;&#x914D;&#x7F6E;ReplicaSet &#x4E3A;&#x7BA1;&#x7406;Pods&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x3002;</p>
<h4 id="replicasets-i">ReplicaSets I</h4>
<!---
A ReplicaSet is the next-generation ReplicationController. ReplicaSets support both equality- and set-based selectors, whereas ReplicationControllers only support equality-based Selectors. Currently, this is the only difference.

With the help of the ReplicaSet, we can scale the number of Pods running a specific container application image. Scaling can be accomplished manually or through the use of an autoscaler.

Next, you can see a graphical representation of a ReplicaSet, where we have set the replica count to 3 for a Pod.
--->
<p>ReplicaSet&#x662F;&#x4E0B;&#x4E00;&#x4EE3;&#x590D;&#x5236;&#x63A7;&#x5236;&#x5668;&#x3002;replicationset&#x652F;&#x6301;&#x57FA;&#x4E8E;&#x7B49;&#x5F0F;&#x548C;&#x96C6;&#x5408;&#x7684;&#x9009;&#x62E9;&#x5668;&#xFF0C;&#x800C;replicationcontroller&#x53EA;&#x652F;&#x6301;&#x57FA;&#x4E8E;&#x7B49;&#x5F0F;&#x7684;&#x9009;&#x62E9;&#x5668;&#x3002;&#x76EE;&#x524D;&#xFF0C;&#x8FD9;&#x662F;&#x552F;&#x4E00;&#x7684;&#x533A;&#x522B;&#x3002;
&#x5728;ReplicaSet&#x7684;&#x5E2E;&#x52A9;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6269;&#x5C55;&#x8FD0;&#x884C;&#x7279;&#x5B9A;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6620;&#x50CF;&#x7684;pod&#x7684;&#x6570;&#x91CF;&#x3002;&#x7F29;&#x653E;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x5B8C;&#x6210;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;autoscaler&#x5B8C;&#x6210;&#x3002;
&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E00;&#x4E2A;replicaSet&#x7684;&#x56FE;&#x5F62;&#x8868;&#x793A;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;Pod&#x7684;replicas count&#x8BBE;&#x7F6E;&#x4E3A;3&#x3002;
<img src="assets/cka-33233531.png" alt=""></p>
<h4 id="replicasets-ii">ReplicaSets II</h4>
<!---
Now, let's continue with the same example and assume that one of the Pods is forced to terminate (due to insufficient resources, timeout, etc.), and the current state is no longer matching the desired state.
--->
<p>&#x73B0;&#x5728;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x540C;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#xFF0C;&#x5047;&#x8BBE;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;pod&#x88AB;&#x5F3A;&#x5236;&#x7EC8;&#x6B62;&#xFF08;&#x7531;&#x4E8E;&#x8D44;&#x6E90;&#x4E0D;&#x8DB3;&#x3001;&#x8D85;&#x65F6;&#x7B49;&#xFF09;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x4E0D;&#x518D;&#x4E0E;&#x6240;&#x9700;&#x72B6;&#x6001;&#x5339;&#x914D;&#x3002;
<img src="assets/cka-ee396fcd.png" alt=""></p>
<h4 id="replicasets-iii">ReplicaSets III</h4>
<!---
The ReplicaSet will detect that the current state is no longer matching the desired state. The ReplicaSet will create an additional Pod, thus ensuring that the current state matches the desired state.
ReplicaSets can be used independently as Pod controllers but they only offer a limited set of features. A set of complementary features are provided by Deployments, the recommended controllers for the orchestration of Pods. Deployments manage the creation, deletion, and updates of Pods. A Deployment automatically creates a ReplicaSet, which then creates a Pod. There is no need to manage ReplicaSets and Pods separately, the Deployment will manage them on our behalf.

We will take a closer look at Deployments next.
--->
<p>ReplicaSet&#x5C06;&#x68C0;&#x6D4B;&#x5230;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x4E0D;&#x518D;&#x4E0E;&#x6240;&#x9700;&#x72B6;&#x6001;&#x5339;&#x914D;&#x3002;ReplicaSet&#x5C06;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;Pod&#xFF0C;&#x4ECE;&#x800C;&#x786E;&#x4FDD;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x4E0E;&#x6240;&#x9700;&#x72B6;&#x6001;&#x5339;&#x914D;&#x3002;
<img src="assets/cka-fa727c97.png" alt="">
ReplicaSet&#x53EF;&#x4EE5;&#x72EC;&#x7ACB;&#x7528;&#x4F5C;Pod&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x53EA;&#x63D0;&#x4F9B;&#x6709;&#x9650;&#x7684;&#x4E00;&#x7EC4;&#x529F;&#x80FD;&#x3002;Deployment&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7EC4;&#x8865;&#x5145;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x662F;pod&#x7F16;&#x6392;&#x7684;&#x63A8;&#x8350;&#x63A7;&#x5236;&#x5668;&#x3002;Deployment&#x7BA1;&#x7406;pod&#x7684;&#x521B;&#x5EFA;&#x3001;&#x5220;&#x9664;&#x548C;&#x66F4;&#x65B0;&#x3002;Deployment&#x4F1A;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;ReplicaSet&#xFF0C;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Pod&#x3002;&#x4E0D;&#x9700;&#x8981;&#x5355;&#x72EC;&#x7BA1;&#x7406;ReplicaSet&#x548C;pod&#xFF0C;Deployment&#x5C06;&#x4EE3;&#x8868;&#x6211;&#x4EEC;&#x7BA1;&#x7406;&#x5B83;&#x4EEC;&#x3002;
&#x4E0B;&#x4E00;&#x6B65;&#x6211;&#x4EEC;&#x5C06;&#x66F4;&#x4ED4;&#x7EC6;&#x5730;&#x7814;&#x7A76;Deployment&#x3002;</p>
<h4 id="deployments-i">Deployments I</h4>
<!---
Deployment objects provide declarative updates to Pods and ReplicaSets. The DeploymentController is part of the master node's controller manager, and it ensures that the current state always matches the desired state. It allows for seamless application updates and downgrades through rollouts and rollbacks, and it directly manages its ReplicaSets for application scaling.

In the following example, a new Deployment creates ReplicaSet A which then creates 3 Pods, with each Pod Template configured to run one nginx:1.7.9 container image. In this case, the ReplicaSet A is associated with nginx:1.7.9 representing a state of the Deployment. This particular state is recorded as Revision 1.


-->
<p>Deployment&#x5BF9;&#x8C61;&#x4E3A;pod&#x548C;ReplicaSet&#x63D0;&#x4F9B;&#x58F0;&#x660E;&#x6027;&#x66F4;&#x65B0;&#x3002;DeploymentController&#x662F;master node&#x7684;&#x63A7;&#x5236;&#x5668;&#x7BA1;&#x7406;&#x5668;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5B83;&#x786E;&#x4FDD;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x59CB;&#x7EC8;&#x4E0E;&#x6240;&#x9700;&#x72B6;&#x6001;&#x5339;&#x914D;&#x3002;&#x5B83;&#x5141;&#x8BB8;&#x901A;&#x8FC7;rollouts&#x548C;rollbacks&#x65E0;&#x7F1D;&#x5730;&#x66F4;&#x65B0;&#x548C;&#x964D;&#x7EA7;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5E76;&#x76F4;&#x63A5;&#x7BA1;&#x7406;&#x5176;ReplicaSet&#x4EE5;&#x8FDB;&#x884C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6269;&#x5C55;&#x3002;
&#x5728;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x4E00;&#x4E2A;&#x65B0;&#x7684;Deployment&#x521B;&#x5EFA;&#x4E86;ReplicaSet A&#xFF0C;&#x7136;&#x540E;&#x5B83;&#x521B;&#x5EFA;&#x4E86;3&#x4E2A;Pod&#xFF0C;&#x6BCF;&#x4E2A;Pod&#x6A21;&#x677F;&#x914D;&#x7F6E;&#x4E3A;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;nginx:1.7.9&#x5BB9;&#x5668;&#x6620;&#x50CF;&#x3002;&#x5728;&#x672C;&#x4F8B;&#x4E2D;&#xFF0C;ReplicaSetA&#x4E0E;nginx:1.7.9&#x76F8;&#x5173;&#x8054;&#xFF0C;nginx:1.7.9&#x8868;&#x793A;&#x90E8;&#x7F72;&#x7684;&#x72B6;&#x6001;&#x3002;&#x6B64;&#x7279;&#x5B9A;&#x72B6;&#x6001;&#x8BB0;&#x5F55;&#x4E3A;&#x4FEE;&#x8BA2;&#x7248;1&#x3002;
<img src="assets/cka-fcd35cb8.png" alt=""></p>
<h4 id="deployments-ii">Deployments II</h4>
<!---
Now, in the Deployment, we change the Pods' Template and we update the container image from nginx:1.7.9 to nginx:1.9.1. The Deployment triggers a new ReplicaSet B for the new container image versioned 1.9.1 and this association represents a new recorded state of the Deployment, Revision 2. The seamless transition between the two ReplicaSets, from ReplicaSet A with 3 Pods versioned 1.7.9 to the new ReplicaSet B with 3 new Pods versioned 1.9.1, or from Revision 1 to Revision 2, is a Deployment rolling update.

A rolling update is triggered when we update the Pods Template for a deployment. Operations like scaling or labeling the deployment do not trigger a rolling update, thus do not change the Revision number.

Once the rolling update has completed, the Deployment will show both ReplicaSets A and B, where A is scaled to 0 (zero) Pods, and B is scaled to 3 Pods. This is how the Deployment records its prior state configuration settings, as Revisions.
--->
<p>&#x73B0;&#x5728;&#xFF0C;&#x5728;Deployment&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x66F4;&#x6539;&#x4E86;Pods&#x7684;Template&#xFF0C;&#x5E76;&#x5C06;&#x5BB9;&#x5668;&#x6620;&#x50CF;&#x4ECE;nginx:1.7.9&#x66F4;&#x65B0;&#x4E3A;nginx:1.9.1&#x3002;&#x90E8;&#x7F72;&#x4E3A;1.9.1&#x7248;&#x672C;&#x7684;&#x65B0;&#x5BB9;&#x5668;&#x6620;&#x50CF;&#x89E6;&#x53D1;&#x65B0;&#x7684;ReplicaSet B&#xFF0C;&#x6B64;&#x5173;&#x8054;&#x8868;&#x793A;&#x90E8;&#x7F72;&#x7684;&#x65B0;&#x8BB0;&#x5F55;&#x72B6;&#x6001;&#xFF0C;&#x7248;&#x672C;2&#x3002;&#x8FD9;&#x4E24;&#x4E2A;ReplicaSet&#x4E4B;&#x95F4;&#x7684;&#x65E0;&#x7F1D;&#x8F6C;&#x6362;&#x662F;Deployment&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#xFF0C;&#x4ECE;&#x5E26;&#x6709;3&#x4E2A;Pods&#x7248;&#x672C;1.7.9&#x7684;ReplicaSet A&#x5230;&#x5E26;&#x6709;3&#x4E2A;Pods&#x7248;&#x672C;1.9.1&#x7684;&#x65B0;ReplicaSet B&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x4ECE;&#x4FEE;&#x8BA2;&#x7248;1&#x5230;&#x4FEE;&#x8BA2;&#x7248;2&#x3002;
&#x5F53;&#x6211;&#x4EEC;&#x4E3A;Deployment&#x66F4;&#x65B0;Pods Template&#x65F6;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x3002;scaling&#x6216;labeling&#x7B49;&#x64CD;&#x4F5C;&#x4E0D;&#x4F1A;&#x89E6;&#x53D1;&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x4F1A;&#x66F4;&#x6539;&#x4FEE;&#x8BA2;&#x53F7;&#x3002;
&#x4E00;&#x65E6;&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x5B8C;&#x6210;&#xFF0C;Deployment&#x5C06;&#x540C;&#x65F6;&#x663E;&#x793A;ReplicaSets A&#x548C;B&#xFF0C;&#x5176;&#x4E2D;A&#x88AB;&#x7F29;&#x653E;&#x4E3A;0 pod&#xFF0C;B&#x88AB;&#x7F29;&#x653E;&#x4E3A;3 pod&#x3002;&#x8FD9;&#x5C31;&#x662F;Deployment&#x5982;&#x4F55;&#x5C06;&#x5176;&#x5148;&#x524D;&#x7684;&#x72B6;&#x6001;&#x914D;&#x7F6E;&#x8BBE;&#x7F6E;&#x8BB0;&#x5F55;&#x4E3A;&#x4FEE;&#x8BA2;&#x7248;&#x7684;&#x65B9;&#x5F0F;&#x3002;
<img src="assets/cka-ea164a48.png" alt=""></p>
<h4 id="deployments-iii">Deployments III</h4>
<!---
Once ReplicaSet B and its 3 Pods versioned 1.9.1 are ready, the Deployment starts actively managing them. However, the Deployment keeps its prior configuration states saved as Revisions which play a key factor in the rollback capability of the Deployment - returning to a prior known configuration state. In our example, if the performance of the new nginx:1.9.1 is not satisfactory, the Deployment can be rolled back to a prior Revision, in this case from Revision 2 back to Revision 1 running nginx:1.7.9.
--->
<p>&#x4E00;&#x65E6;ReplicaSet B&#x53CA;&#x5176;&#x7248;&#x672C;&#x4E3A;1.9.1&#x7684;3&#x4E2A;Pods&#x51C6;&#x5907;&#x5C31;&#x7EEA;&#xFF0C;Deployments&#x5C31;&#x5F00;&#x59CB;&#x79EF;&#x6781;&#x5730;&#x7BA1;&#x7406;&#x5B83;&#x4EEC;&#x3002;&#x4F46;&#x662F;&#xFF0C;Deployment&#x5C06;&#x5176;&#x5148;&#x524D;&#x7684;&#x914D;&#x7F6E;&#x72B6;&#x6001;&#x4FDD;&#x5B58;&#x4E3A;&#x5386;&#x53F2;&#x4FEE;&#x8BA2;&#x7248;&#xFF0C;&#x4FEE;&#x8BA2;&#x7248;&#x5728;Deployment&#x7684;&#x56DE;&#x6EDA;&#x529F;&#x80FD;&#x4E2D;&#x8D77;&#x7740;&#x5173;&#x952E;&#x4F5C;&#x7528;&#x2014;&#x8FD4;&#x56DE;&#x5230;&#x5148;&#x524D;&#x5DF2;&#x77E5;&#x7684;&#x914D;&#x7F6E;&#x72B6;&#x6001;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x65B0;nginx:1.9.1&#x7684;&#x6027;&#x80FD;&#x4E0D;&#x4EE4;&#x4EBA;&#x6EE1;&#x610F;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5C06;&#x90E8;&#x7F72;&#x56DE;&#x6EDA;&#x5230;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x5728;&#x672C;&#x4F8B;&#x4E2D;&#xFF0C;&#x4ECE;&#x7248;&#x672C;2&#x56DE;&#x6EDA;&#x5230;&#x8FD0;&#x884C;nginx:1.7.9&#x7684;&#x7248;&#x672C;1&#x3002;
<img src="assets/cka-31a8512d.png" alt=""></p>
<h4 id="namespaces">Namespaces</h4>
<!---
If multiple users and teams use the same Kubernetes cluster we can partition the cluster into virtual sub-clusters using Namespaces. The names of the resources/objects created inside a Namespace are unique, but not across Namespaces in the cluster.

To list all the Namespaces, we can run the following command:

$ kubectl get namespaces
NAME              STATUS       AGE
default           Active       11h
kube-node-lease   Active       11h
kube-public       Active       11h
kube-system       Active       11h

Generally, Kubernetes creates four default Namespaces: kube-system, kube-public, kube-node-lease, and default. The kube-system Namespace contains the objects created by the Kubernetes system, mostly the control plane agents. The default Namespace contains the objects and resources created by administrators and developers. By default, we connect to the default Namespace. kube-public is a special Namespace, which is unsecured and readable by anyone, used for special purposes such as exposing public (non-sensitive) information about the cluster. The newest Namespace is kube-node-lease which holds node lease objects used for node heartbeat data. Good practice, however, is to create more Namespaces to virtualize the cluster for users and developer teams.

With Resource Quotas, we can divide the cluster resources within Namespaces. We will briefly cover resource quotas in one of the future chapters.
--->
<p>&#x5982;&#x679C;&#x591A;&#x4E2A;&#x7528;&#x6237;&#x548C;&#x56E2;&#x961F;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x4E2A;Kubernetes&#x96C6;&#x7FA4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x5C06;&#x96C6;&#x7FA4;&#x5212;&#x5206;&#x4E3A;&#x865A;&#x62DF;&#x5B50;&#x96C6;&#x7FA4;&#x3002;&#x5728;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x8D44;&#x6E90;/&#x5BF9;&#x8C61;&#x7684;&#x540D;&#x79F0;&#x662F;&#x552F;&#x4E00;&#x7684;&#xFF0C;&#x4F46;&#x5728;&#x7FA4;&#x96C6;&#x4E2D;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x4E0D;&#x662F;&#x552F;&#x4E00;&#x7684;&#x3002;
&#x8981;&#x5217;&#x51FA;&#x6240;&#x6709;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code class="lang-bash">$ kubectl get namespaces
NAME              STATUS       AGE
default           Active       11h
kube-node-lease   Active       11h
kube-public       Active       11h
kube-system       Active       11h
</code></pre>
<p>&#x901A;&#x5E38;&#xFF0C;Kubernetes&#x521B;&#x5EFA;&#x56DB;&#x4E2A;&#x9ED8;&#x8BA4;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#xFF1A;kube system&#x3001;kube public&#x3001;kube node lease&#x548C;default&#x3002;kube system&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x5305;&#x542B;&#x7531;Kubernetes&#x7CFB;&#x7EDF;&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x63A7;&#x5236;&#x5E73;&#x9762;&#x4EE3;&#x7406;&#x3002;default&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5305;&#x542B;&#x7BA1;&#x7406;&#x5458;&#x548C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;&#x548C;&#x8D44;&#x6E90;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x8FDE;&#x63A5;&#x5230;default&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3002;kube public&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#xFF0C;&#x4EFB;&#x4F55;&#x4EBA;&#x90FD;&#x53EF;&#x4EE5;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x548C;&#x53EF;&#x8BFB;&#xFF0C;&#x7528;&#x4E8E;&#x7279;&#x6B8A;&#x76EE;&#x7684;&#xFF0C;&#x4F8B;&#x5982;&#x516C;&#x5F00;&#x96C6;&#x7FA4;&#x7684;&#x516C;&#x5171;&#xFF08;&#x975E;&#x654F;&#x611F;&#xFF09;&#x4FE1;&#x606F;&#x3002;&#x6700;&#x65B0;&#x7684;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x662F;kube node lease&#xFF0C;&#x5B83;&#x4FDD;&#x5B58;&#x7528;&#x4E8E;&#x8282;&#x70B9;&#x5FC3;&#x8DF3;&#x6570;&#x636E;&#x7684;&#x8282;&#x70B9;&#x79DF;&#x7EA6;&#x5BF9;&#x8C61;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x597D;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x521B;&#x5EFA;&#x66F4;&#x591A;&#x7684;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x6765;&#x4E3A;&#x7528;&#x6237;&#x548C;&#x5F00;&#x53D1;&#x56E2;&#x961F;&#x865A;&#x62DF;&#x5316;&#x96C6;&#x7FA4;&#x3002;
&#x901A;&#x8FC7;Resource Quotas&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x5185;&#x5212;&#x5206;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x672A;&#x6765;&#x7684;&#x4E00;&#x7AE0;&#x4E2D;&#x7B80;&#x8981;&#x4ECB;&#x7ECD;Resource Quotas&#x3002;</p>
<h4 id="deployment-rolling-update-and-rollback-demo">Deployment Rolling Update and Rollback (Demo)</h4>
<h2 id="chapter-9-authentication-authorization-admission-control">Chapter 9. Authentication, Authorization, Admission Control</h2>
<h3 id="introduction-and-learning-objectives">Introduction and Learning Objectives</h3>
<!---
Every API request reaching the API server has to go through three different stages before being accepted by the server and acted upon. In this chapter, we will be looking into the Authentication, Authorization and Admission Control stages of Kubernetes API requests.
By the end of this chapter, you should be able to:

* Discuss the authentication, authorization, and access control stages of the
* Kubernetes API access.
* Understand the different kinds of Kubernetes users.
* Explore the different modules for authentication and authorization.
--->
<p>&#x6BCF;&#x4E2A;&#x5230;&#x8FBE;API&#x670D;&#x52A1;&#x5668;&#x7684;API&#x8BF7;&#x6C42;&#x90FD;&#x5FC5;&#x987B;&#x7ECF;&#x8FC7;&#x4E09;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x9636;&#x6BB5;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x4F1A;&#x88AB;&#x670D;&#x52A1;&#x5668;&#x63A5;&#x53D7;&#x5E76;&#x6267;&#x884C;&#x3002;&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x7814;&#x7A76;Kubernetes API&#x8BF7;&#x6C42;&#x7684;&#x8BA4;&#x8BC1;&#x3001;&#x6388;&#x6743;&#x548C;&#x5141;&#x8BB8;&#x63A7;&#x5236;&#x9636;&#x6BB5;.
&#x672C;&#x7AE0;&#x7ED3;&#x675F;&#x4E4B;&#x524D;&#xFF0C;&#x60A8;&#x5E94;&#x8BE5;&#x80FD;&#x591F;:</p>
<ul>
<li>&#x8BA8;&#x8BBA;Kubernetes API&#x8BBF;&#x95EE;&#x7684;&#x8BA4;&#x8BC1;&#x3001;&#x6388;&#x6743;&#x548C;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x9636;&#x6BB5;&#x3002;</li>
<li>&#x4E86;&#x89E3;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;Kubernetes&#x7528;&#x6237;&#x3002;</li>
<li>&#x63A2;&#x7D22;&#x7528;&#x4E8E;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x548C;&#x6388;&#x6743;&#x7684;&#x4E0D;&#x540C;&#x6A21;&#x5757;</li>
</ul>
<h3 id="authentication-authorization-and-admission-control">Authentication, Authorization, and Admission Control</h3>
<h4 id="authentication-authorization-and-admission-control---overview">Authentication, Authorization, and Admission Control - Overview</h4>
<!---To access and manage any Kubernetes resource or object in the cluster, we need to access a specific API endpoint on the API server. Each access request goes through the following three stages:

Authentication
Logs in a user.
Authorization
Authorizes the API requests added by the logged-in user.
Admission Control
Software modules that can modify or reject the requests based on some additional checks, like a pre-set Quota.
The following image depicts the above stages:--->
<p>&#x8981;&#x8BBF;&#x95EE;&#x548C;&#x7BA1;&#x7406;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;Kubernetes&#x8D44;&#x6E90;&#x6216;&#x5BF9;&#x8C61;&#xFF0C;&#x9700;&#x8981;&#x8BBF;&#x95EE;API&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x7279;&#x5B9A;API&#x7AEF;&#x70B9;&#x3002;&#x6BCF;&#x4E2A;&#x8BBF;&#x95EE;&#x8BF7;&#x6C42;&#x90FD;&#x7ECF;&#x8FC7;&#x4EE5;&#x4E0B;&#x4E09;&#x4E2A;&#x9636;&#x6BB5;:</p>
<ul>
<li>&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;
&#x7528;&#x6237;&#x767B;&#x5F55;&#x3002;</li>
<li>&#x6388;&#x6743;
&#x6388;&#x6743;&#x767B;&#x5F55;&#x7528;&#x6237;&#x6DFB;&#x52A0;&#x7684;API&#x8BF7;&#x6C42;&#x3002;</li>
<li>&#x5141;&#x8BB8;&#x63A7;&#x5236;
&#x8F6F;&#x4EF6;&#x6A21;&#x5757;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x68C0;&#x67E5;(&#x5982;&#x9884;&#x5148;&#x8BBE;&#x7F6E;&#x7684;&#x914D;&#x989D;)&#x4FEE;&#x6539;&#x6216;&#x62D2;&#x7EDD;&#x8BF7;&#x6C42;&#x3002;
&#x4E0B;&#x56FE;&#x63CF;&#x8FF0;&#x4E86;&#x4E0A;&#x8FF0;&#x9636;&#x6BB5;:
<img src="assets/cka-c5eb35e6.png" alt="">
Accessing the API<h4 id="authentication-i">Authentication I</h4>
&lt;!---
Kubernetes does not have an object called user, nor does it store usernames or other related details in its object store. However, even without that, Kubernetes can use usernames for access control and request logging, which we will explore in this chapter.</li>
</ul>
<p>Kubernetes has two kinds of users:</p>
<p>Normal Users
They are managed outside of the Kubernetes cluster via independent services like User/Client Certificates, a file listing usernames/passwords, Google accounts, etc.
Service Accounts
With Service Account users, in-cluster processes communicate with the API server to perform different operations. Most of the Service Account users are created automatically via the API server, but they can also be created manually. The Service Account users are tied to a given Namespace and mount the respective credentials to communicate with the API server as Secrets.
If properly configured, Kubernetes can also support anonymous requests, along with requests from Normal Users and Service Accounts. User impersonation is also supported for a user to be able to act as another user, a useful feature for administrators when troubleshooting authorization policies.
---&gt;
Kubernetes&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;user&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x5728;&#x5B83;&#x7684;&#x5BF9;&#x8C61;&#x5B58;&#x50A8;&#x4E2D;&#x5B58;&#x50A8;&#x7528;&#x6237;&#x540D;&#x6216;&#x5176;&#x4ED6;&#x76F8;&#x5173;&#x7EC6;&#x8282;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5373;&#x4F7F;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#xFF0C;Kubernetes&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x540D;&#x8FDB;&#x884C;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x548C;&#x8BF7;&#x6C42;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x672C;&#x7AE0;&#x5BF9;&#x6B64;&#x8FDB;&#x884C;&#x63A2;&#x8BA8;;
Kubernetes&#x6709;&#x4E24;&#x79CD;&#x7528;&#x6237;:</p>
<ul>
<li>&#x666E;&#x901A;&#x7528;&#x6237;
&#x5B83;&#x4EEC;&#x5728;Kubernetes&#x96C6;&#x7FA4;&#x4E4B;&#x5916;&#x901A;&#x8FC7;&#x72EC;&#x7ACB;&#x7684;&#x670D;&#x52A1;&#xFF08;&#x5982;&#x7528;&#x6237;/&#x5BA2;&#x6237;&#x7AEF;&#x8BC1;&#x4E66;&#x3001;&#x5217;&#x51FA;&#x7528;&#x6237;&#x540D;/&#x5BC6;&#x7801;&#x7684;&#x6587;&#x4EF6;&#x3001;Google&#x5E10;&#x6237;&#x7B49;&#xFF09;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x3002;</li>
<li>&#x670D;&#x52A1;&#x5E10;&#x6237;
&#x5BF9;&#x4E8E;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x7528;&#x6237;&#xFF0C;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x4E0E;API&#x670D;&#x52A1;&#x5668;&#x901A;&#x4FE1;&#x4EE5;&#x6267;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x5927;&#x591A;&#x6570;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x7528;&#x6237;&#x662F;&#x901A;&#x8FC7;API&#x670D;&#x52A1;&#x5668;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x4F46;&#x4E5F;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x521B;&#x5EFA;&#x3002;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x7528;&#x6237;&#x7ED1;&#x5B9A;&#x5230;&#x7ED9;&#x5B9A;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x5E76;&#x88C5;&#x8F7D;&#x76F8;&#x5E94;&#x7684;&#x51ED;&#x636E;&#x4EE5;&#x4F5C;&#x4E3A;&#x673A;&#x5BC6;&#x4E0E;API&#x670D;&#x52A1;&#x5668;&#x901A;&#x4FE1;&#x3002;
&#x5982;&#x679C;&#x914D;&#x7F6E;&#x6B63;&#x786E;&#xFF0C;Kubernetes&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x533F;&#x540D;&#x8BF7;&#x6C42;&#xFF0C;&#x4EE5;&#x53CA;&#x6765;&#x81EA;&#x666E;&#x901A;&#x7528;&#x6237;&#x548C;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x8FD8;&#x652F;&#x6301;&#x7528;&#x6237;&#x6A21;&#x62DF;&#xFF0C;&#x4EE5;&#x4FBF;&#x7528;&#x6237;&#x80FD;&#x591F;&#x5145;&#x5F53;&#x53E6;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#xFF0C;&#x8FD9;&#x662F;&#x7BA1;&#x7406;&#x5458;&#x6392;&#x9664;&#x6388;&#x6743;&#x7B56;&#x7565;&#x6545;&#x969C;&#x65F6;&#x7684;&#x4E00;&#x4E2A;&#x6709;&#x7528;&#x529F;&#x80FD;&#x3002;<h4 id="authentication-ii">Authentication II</h4>
&lt;!---
For authentication, Kubernetes uses different authentication modules:</li>
</ul>
<p>Client Certificates
To enable client certificate authentication, we need to reference a file containing one or more certificate authorities by passing the --client-ca-file=SOMEFILE option to the API server. The certificate authorities mentioned in the file would validate the client certificates presented to the API server. A demonstration video covering this topic is also available at the end of this chapter.
Static Token File
We can pass a file containing pre-defined bearer tokens with the --token-auth-file=SOMEFILE option to the API server. Currently, these tokens would last indefinitely, and they cannot be changed without restarting the API server.
Bootstrap Tokens
This feature is currently in beta status and is mostly used for bootstrapping a new Kubernetes cluster.
Static Password File
It is similar to Static Token File. We can pass a file containing basic authentication details with the --basic-auth-file=SOMEFILE option. These credentials would last indefinitely, and passwords cannot be changed without restarting the API server.
Service Account Tokens
This is an automatically enabled authenticator that uses signed bearer tokens to verify the requests. These tokens get attached to Pods using the ServiceAccount Admission Controller, which allows in-cluster processes to talk to the API server.
OpenID Connect Tokens
OpenID Connect helps us connect with OAuth2 providers, such as Azure Active Directory, Salesforce, Google, etc., to offload the authentication to external services.
Webhook Token Authentication
With Webhook-based authentication, verification of bearer tokens can be offloaded to a remote service.
Authenticating Proxy
If we want to program additional authentication logic, we can use an authenticating proxy.
We can enable multiple authenticators, and the first module to successfully authenticate the request short-circuits the evaluation. In order to be successful, you should enable at least two methods: the service account tokens authenticator and one of the user authenticators.
---&gt;
&#x5BF9;&#x4E8E;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;Kubernetes&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6A21;&#x5757;&#xFF1A;</p>
<ul>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x8BC1;&#x4E66;
&#x8981;&#x542F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x8BC1;&#x4E66;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x901A;&#x8FC7;--client-ca-file=SOMEFILE &#x9009;&#x9879;&#x4F20;&#x9012;&#x7ED9;API&#x670D;&#x52A1;&#x5668;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x8BC1;&#x4E66;&#x9881;&#x53D1;&#x673A;&#x6784;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x6587;&#x4EF6;&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x8BC1;&#x4E66;&#x9881;&#x53D1;&#x673A;&#x6784;&#x5C06;&#x9A8C;&#x8BC1;&#x63D0;&#x4F9B;&#x7ED9;API&#x670D;&#x52A1;&#x5668;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8BC1;&#x4E66;&#x3002;&#x672C;&#x7AE0;&#x672B;&#x5C3E;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x6DB5;&#x76D6;&#x6B64;&#x4E3B;&#x9898;&#x7684;&#x6F14;&#x793A;&#x89C6;&#x9891;&#x3002;</li>
<li>&#x9759;&#x6001;&#x4EE4;&#x724C;&#x6587;&#x4EF6;
&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;--token-auth-file=SOMEFILE &#x9009;&#x9879;&#x5C06;&#x9884;&#x5B9A;&#x4E49;&#x7684;&#x4E0D;&#x8BB0;&#x540D;&#x4EE4;&#x724C;&#x7684;&#x6587;&#x4EF6;&#x4F20;&#x9012;&#x7ED9;API&#x670D;&#x52A1;&#x5668;&#x3002;&#x76EE;&#x524D;&#xFF0C;&#x8FD9;&#x4E9B;&#x4EE4;&#x724C;&#x5C06;&#x65E0;&#x9650;&#x671F;&#x5730;&#x6301;&#x7EED;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x91CD;&#x65B0;&#x542F;&#x52A8;API&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5219;&#x65E0;&#x6CD5;&#x66F4;&#x6539;&#x5B83;&#x4EEC;&#x3002;</li>
<li>Bootstrap Tokens
&#x6B64;&#x529F;&#x80FD;&#x5F53;&#x524D;&#x5904;&#x4E8E;beta&#x72B6;&#x6001;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;bootstrapping &#x65B0;&#x7684;Kubernetes&#x96C6;&#x7FA4;&#x3002;</li>
<li>&#x9759;&#x6001;&#x5BC6;&#x7801;&#x6587;&#x4EF6;
&#x5B83;&#x7C7B;&#x4F3C;&#x4E8E;&#x9759;&#x6001;&#x4EE4;&#x724C;&#x6587;&#x4EF6;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;--basic-auth-file=SOMEFILE &#x9009;&#x9879;&#x4F20;&#x9012;&#x5305;&#x542B;&#x57FA;&#x672C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x8FD9;&#x4E9B;&#x51ED;&#x636E;&#x5C06;&#x65E0;&#x9650;&#x671F;&#x5730;&#x6301;&#x7EED;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x91CD;&#x65B0;&#x542F;&#x52A8;API&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5219;&#x65E0;&#x6CD5;&#x66F4;&#x6539;&#x5BC6;&#x7801;&#x3002;</li>
<li>&#x670D;&#x52A1;&#x5E10;&#x6237;&#x4EE4;&#x724C;
&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x52A8;&#x542F;&#x7528;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5668;&#xFF0C;&#x5B83;&#x4F7F;&#x7528;&#x7B7E;&#x540D;&#x7684;&#x4E0D;&#x8BB0;&#x540D;&#x4EE4;&#x724C;&#x6765;&#x9A8C;&#x8BC1;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x4E9B;&#x4EE4;&#x724C;&#x4F7F;&#x7528;ServiceAccount Admission Controller&#x8FDE;&#x63A5;&#x5230;Pods&#xFF0C;&#x8BE5;&#x63A7;&#x5236;&#x5668;&#x5141;&#x8BB8;&#x96C6;&#x7FA4;&#x5185;&#x8FDB;&#x7A0B;&#x4E0E;API&#x670D;&#x52A1;&#x5668;&#x901A;&#x4FE1;&#x3002;</li>
<li>OpenID&#x8FDE;&#x63A5;&#x4EE4;&#x724C;
OpenID Connect&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x4E0E;OAuth2&#x63D0;&#x4F9B;&#x5546;&#xFF08;&#x5982;Azure Active Directory&#x3001;Salesforce&#x3001;Google&#x7B49;&#xFF09;&#x8FDE;&#x63A5;&#xFF0C;&#x5C06;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x653E;&#x5230;&#x5916;&#x90E8;&#x670D;&#x52A1;&#x53BB;&#x5B8C;&#x6210;&#x3002;</li>
<li>Webhook&#x4EE4;&#x724C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;
&#x4F7F;&#x7528;&#x57FA;&#x4E8E;Webhook&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x4E0D;&#x8BB0;&#x540D;&#x4EE4;&#x724C;&#x7684;&#x9A8C;&#x8BC1;&#x53EF;&#x4EE5;&#x653E;&#x5230;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x53BB;&#x5B8C;&#x6210;&#x3002;</li>
<li>&#x8BA4;&#x8BC1;&#x4EE3;&#x7406;
&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x7F16;&#x7A0B;&#x5B9E;&#x73B0;&#x989D;&#x5916;&#x7684;&#x8BA4;&#x8BC1;&#x903B;&#x8F91;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BA4;&#x8BC1;&#x4EE3;&#x7406;&#x3002;</li>
</ul>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x542F;&#x7528;&#x591A;&#x4E2A;&#x8BA4;&#x8BC1;&#x5668;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x6210;&#x529F;&#x8BA4;&#x8BC1;&#x8BF7;&#x6C42;&#x7684;&#x6A21;&#x5757;&#x5B8C;&#x6210;&#x8BA4;&#x8BC1;&#x8BC4;&#x4F30;(&#x540E;&#x7EED;&#x6A21;&#x5757;&#x5C31;&#x4E0D;&#x7528;&#x518D;&#x9A8C;&#x8BC1;)&#x3002;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x8BA4;&#x8BC1;&#x6210;&#x529F;&#xFF0C;&#x60A8;&#x5E94;&#x8BE5;&#x81F3;&#x5C11;&#x542F;&#x7528;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#xFF1A;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x4EE4;&#x724C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5668;&#x548C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5668;&#x3002;</p>
<h4 id="authorization-i">Authorization I</h4>
<!---
After a successful authentication, users can send the API requests to perform different operations. Then, those API requests get authorized by Kubernetes using various authorization modules.

Some of the API request attributes that are reviewed by Kubernetes include user, group, extra, Resource or Namespace, to name a few. Next, these attributes are evaluated against policies. If the evaluation is successful, then the request will be allowed, otherwise it will get denied. Similar to the Authentication step, Authorization has multiple modules/authorizers. More than one module can be configured for one Kubernetes cluster, and each module is checked in sequence. If any authorizer approves or denies a request, then that decision is returned immediately.

Next, we will discuss the authorizers that are supported by Kubernetes.
--->
<p>&#x8BA4;&#x8BC1;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x53D1;&#x9001;API&#x8BF7;&#x6C42;&#x6765;&#x6267;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x8FD9;&#x4E9B;API&#x8BF7;&#x6C42;&#x7531;Kubernetes&#x4F7F;&#x7528;&#x5404;&#x79CD;&#x6388;&#x6743;&#x6A21;&#x5757;&#x8FDB;&#x884C;&#x6388;&#x6743;&#x3002;
Kubernetes&#x68C0;&#x67E5;&#x7684;&#x4E00;&#x4E9B;API&#x8BF7;&#x6C42;&#x5C5E;&#x6027;&#x5305;&#x62EC;user&#x3001;group&#x3001;extra&#x3001;Resource&#x6216;Namespace&#x7B49;&#x7B49;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6839;&#x636E;&#x7B56;&#x7565;&#x8BC4;&#x4F30;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x3002;&#x5982;&#x679C;&#x8BC4;&#x4F30;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x5141;&#x8BB8;&#x8BF7;&#x6C42;&#xFF0C;&#x5426;&#x5219;&#x5C06;&#x88AB;&#x62D2;&#x7EDD;&#x3002;&#x4E0E;&#x8BA4;&#x8BC1;&#x6B65;&#x9AA4;&#x7C7B;&#x4F3C;&#xFF0C;&#x6388;&#x6743;&#x5177;&#x6709;&#x591A;&#x4E2A;&#x6A21;&#x5757;/&#x6388;&#x6743;&#x5668;&#x3002;&#x53EF;&#x4EE5;&#x4E3A;&#x4E00;&#x4E2A;Kubernetes&#x96C6;&#x7FA4;&#x914D;&#x7F6E;&#x591A;&#x4E2A;&#x6A21;&#x5757;&#xFF0C;&#x6BCF;&#x4E2A;&#x6A21;&#x5757;&#x90FD;&#x662F;&#x6309;&#x987A;&#x5E8F;&#x7B7E;&#x5165;&#x7684;&#x3002;&#x5982;&#x679C;&#x4EFB;&#x4F55;&#x6388;&#x6743;&#x4EBA;&#x6279;&#x51C6;&#x6216;&#x62D2;&#x7EDD;&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x8BE5;&#x7ED3;&#x679C;&#x3002;
&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x8BA8;&#x8BBA;&#x7531;Kubernetes&#x652F;&#x6301;&#x7684;&#x6388;&#x6743;&#x5668;&#x3002;</p>
<h4 id="authorization-ii">Authorization II</h4>
<!----
Authorization modules (Part 1):

Node Authorizer
Node authorization is a special-purpose authorization mode which specifically authorizes API requests made by kubelets. It authorizes the kubelet's read operations for services, endpoints, nodes, etc., and writes operations for nodes, pods, events, etc. For more details, please review the Kubernetes documentation.
Attribute-Based Access Control (ABAC) Authorizer
With the ABAC authorizer, Kubernetes grants access to API requests, which combine policies with attributes. In the following example, user student can only read Pods in the Namespace lfs158.

{
  "apiVersion": "abac.authorization.kubernetes.io/v1beta1",
  "kind": "Policy",
  "spec": {
    "user": "student",
    "namespace": "lfs158",
    "resource": "pods",
    "readonly": true
  }
}

To enable the ABAC authorizer, we would need to start the API server with the --authorization-mode=ABAC option. We would also need to specify the authorization policy with --authorization-policy-file=PolicyFile.json. For more details, please review the Kubernetes documentation.
Webhook Authorizer
With the Webhook authorizer, Kubernetes can offer authorization decisions to some third-party services, which would return true for successful authorization, and false for failure. In order to enable the Webhook authorizer, we need to start the API server with the --authorization-webhook-config-file=SOME_FILENAME option, where SOME_FILENAME is the configuration of the remote authorization service. For more details, please see the Kubernetes documentation.
--->
<p>&#x6388;&#x6743;&#x6A21;&#x5757;&#xFF08;&#x7B2C;1&#x90E8;&#x5206;&#xFF09;&#xFF1A;</p>
<ul>
<li>&#x8282;&#x70B9;&#x6388;&#x6743;&#x4EBA;
&#x8282;&#x70B9;&#x6388;&#x6743;&#x662F;&#x5BF9;kubelets&#x63D0;&#x51FA;&#x7684;API&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x4E13;&#x95E8;&#x6388;&#x6743;&#x7684;&#x4E00;&#x79CD;&#x4E13;&#x7528;&#x6388;&#x6743;&#x65B9;&#x5F0F;&#x3002;&#x5B83;&#x6388;&#x6743;kubelet&#x5BF9;&#x670D;&#x52A1;&#x3001;&#x7AEF;&#x70B9;&#x3001;&#x8282;&#x70B9;&#x7B49;&#x7684;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x6388;&#x6743;&#x8282;&#x70B9;&#x3001;pod&#x3001;&#x4E8B;&#x4EF6;&#x7B49;&#x7684;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#x3002;&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;Kubernetes&#x6587;&#x6863;:<a href="https://kubernetes.io/docs/reference/access-authn-authz/node/&#x3002;" target="_blank">https://kubernetes.io/docs/reference/access-authn-authz/node/&#x3002;</a></li>
<li>&#x57FA;&#x4E8E;&#x5C5E;&#x6027;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#xFF08;ABAC&#xFF09;&#x6388;&#x6743;&#x7A0B;&#x5E8F;
&#x901A;&#x8FC7;ABAC&#x6388;&#x6743;&#x7A0B;&#x5E8F;&#xFF0C;Kubernetes&#x6388;&#x4E88;&#x5BF9;API&#x8BF7;&#x6C42;&#x7684;&#x8BBF;&#x95EE;&#x6743;&#xFF0C;API&#x8BF7;&#x6C42;&#x5C06;&#x7B56;&#x7565;&#x4E0E;&#x5C5E;&#x6027;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x3002;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x7528;&#x6237;student&#x53EA;&#x80FD;&#x8BFB;&#x53D6;&#x540D;&#x79F0;&#x7A7A;&#x95F4;lfs158&#x4E2D;&#x7684;pod&#x3002;<pre><code class="lang-json">{
<span class="hljs-string">&quot;apiVersion&quot;</span>: <span class="hljs-string">&quot;abac.authorization.kubernetes.io/v1beta1&quot;</span>,
<span class="hljs-string">&quot;kind&quot;</span>: <span class="hljs-string">&quot;Policy&quot;</span>,
<span class="hljs-string">&quot;spec&quot;</span>: {
  <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;student&quot;</span>,
  <span class="hljs-string">&quot;namespace&quot;</span>: <span class="hljs-string">&quot;lfs158&quot;</span>,
  <span class="hljs-string">&quot;resource&quot;</span>: <span class="hljs-string">&quot;pods&quot;</span>,
  <span class="hljs-string">&quot;readonly&quot;</span>: <span class="hljs-literal">true</span>
}
}
</code></pre>
&#x8981;&#x542F;&#x7528;ABAC&#x6388;&#x6743;&#x7A0B;&#x5E8F;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528; --authorization-mode=ABAC&#x9009;&#x9879;&#x542F;&#x52A8;API&#x670D;&#x52A1;&#x5668;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x4F7F;&#x7528;--authorization-policy-file=PolicyFile.json&#x6307;&#x5B9A;&#x6388;&#x6743;&#x7B56;&#x7565;&#x3002;&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x67E5;&#x770B;Kubernetes&#x6587;&#x6863;:<a href="https://kubernetes.io/docs/reference/access-authn-authz/abac/&#x3002;" target="_blank">https://kubernetes.io/docs/reference/access-authn-authz/abac/&#x3002;</a></li>
<li>Webhook&#x6388;&#x6743;&#x4EBA;
&#x901A;&#x8FC7;Webhook&#x6388;&#x6743;&#x7A0B;&#x5E8F;&#xFF0C;Kubernetes&#x53EF;&#x4EE5;&#x5411;&#x67D0;&#x4E9B;&#x7B2C;&#x4E09;&#x65B9;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x6388;&#x6743;&#x51B3;&#x7B56;&#xFF0C;&#x5982;&#x679C;&#x6388;&#x6743;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;true&#xFF0C;&#x5982;&#x679C;&#x6388;&#x6743;&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;false&#x3002;&#x4E3A;&#x4E86;&#x542F;&#x7528;Webhook&#x6388;&#x6743;&#x7A0B;&#x5E8F;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528; --authorization-webhook-config-file=SOME_FILENAME &#x9009;&#x9879;&#x542F;&#x52A8;API&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5176;&#x4E2D;SOME_FILENAME&#x662F;&#x8FDC;&#x7A0B;&#x6388;&#x6743;&#x670D;&#x52A1;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;Kubernetes&#x6587;&#x6863;:<a href="https://kubernetes.io/docs/reference/access-authn-authz/webhook/&#x3002;" target="_blank">https://kubernetes.io/docs/reference/access-authn-authz/webhook/&#x3002;</a><h4 id="authorization-iii">Authorization III</h4>
&lt;!---
Authorization modules (Part 2):</li>
</ul>
<p>Role-Based Access Control (RBAC) Authorizer
In general, with RBAC we can regulate the access to resources based on the roles of individual users. In Kubernetes, we can have different roles that can be attached to subjects like users, service accounts, etc. While creating the roles, we restrict resource access by specific operations, such as create, get, update, patch, etc. These operations are referred to as verbs.</p>
<p>In RBAC, we can create two kinds of roles:</p>
<p>Role
With Role, we can grant access to resources within a specific Namespace.</p>
<p>ClusterRole
The ClusterRole can be used to grant the same permissions as Role does, but its scope is cluster-wide.</p>
<p>In this course, we will focus on the first kind, Role. Below you will find an example:</p>
<p>kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: lfs158
  name: pod-reader
rules:</p>
<ul>
<li>apiGroups: [&quot;&quot;] # &quot;&quot; indicates the core API group
resources: [&quot;pods&quot;]
verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</li>
</ul>
<p>As you can see, it creates a pod-reader role, which has access only to read the Pods of lfs158 Namespace. Once the role is created, we can bind users with RoleBinding.</p>
<p>There are two kinds of RoleBindings:</p>
<p>RoleBinding
It allows us to bind users to the same namespace as a Role. We could also refer a ClusterRole in RoleBinding, which would grant permissions to Namespace resources defined in the ClusterRole within the RoleBinding&#x2019;s Namespace.</p>
<p>ClusterRoleBinding
It allows us to grant access to resources at a cluster-level and to all Namespaces.</p>
<p>In this course, we will focus on the first kind, RoleBinding. Below, you will find an example:</p>
<p>kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: pod-read-access
  namespace: lfs158
subjects:</p>
<ul>
<li>kind: User
name: student
apiGroup: rbac.authorization.k8s.io
roleRef:
kind: Role
name: pod-reader
apiGroup: rbac.authorization.k8s.io</li>
</ul>
<p>As you can see, it gives access to the student user to read the Pods of lfs158 Namespace.</p>
<p>To enable the RBAC authorizer, we would need to start the API server with the --authorization-mode=RBAC option. With the RBAC authorizer, we dynamically configure policies. For more details, please review the Kubernetes documentation.
---&gt;
&#x6388;&#x6743;&#x6A21;&#x5757;&#xFF08;&#x7B2C;2&#x90E8;&#x5206;&#xFF09;&#xFF1A;
&#x57FA;&#x4E8E;&#x89D2;&#x8272;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#xFF08;RBAC&#xFF09;&#x6388;&#x6743;&#x7A0B;&#x5E8F;
&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x4F7F;&#x7528;RBAC&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5355;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#x6765;&#x8C03;&#x8282;&#x5BF9;&#x8D44;&#x6E90;&#x7684;&#x8BBF;&#x95EE;&#x3002;&#x5728;Kubernetes&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x4E0D;&#x540C;&#x7684;&#x89D2;&#x8272;&#x9644;&#x52A0;&#x5230;&#x7528;&#x6237;&#x3001;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x7B49;&#x4E3B;&#x9898;&#x4E0A;&#x3002;&#x5728;&#x521B;&#x5EFA;&#x89D2;&#x8272;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x7279;&#x5B9A;&#x7684;&#x64CD;&#x4F5C;&#xFF08;&#x5982;create&#x3001;get&#x3001;update&#x3001;patch&#x7B49;&#xFF09;&#x9650;&#x5236;&#x8D44;&#x6E90;&#x8BBF;&#x95EE;&#x3002;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x79F0;&#x4E3A;verbs&#x3002;
&#x5728;RBAC&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E24;&#x79CD;&#x89D2;&#x8272;&#xFF1A;</p>
<ul>
<li>Role
&#x4F7F;&#x7528;Role&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6388;&#x4E88;&#x5BF9;&#x7279;&#x5B9A;Namespace&#x4E2D;&#x8D44;&#x6E90;&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x3002;</li>
<li>ClusterRole
ClusterRole&#x53EF;&#x7528;&#x4E8E;&#x6388;&#x4E88;&#x4E0E;Role&#x76F8;&#x540C;&#x7684;&#x6743;&#x9650;&#xFF0C;&#x4F46;&#x5176;&#x4F5C;&#x7528;&#x57DF;&#x662F;cluster&#x8303;&#x56F4;&#x7684;&#x3002;
&#x5728;&#x672C;&#x8BFE;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x96C6;&#x4E2D;&#x8BA8;&#x8BBA;&#x7B2C;&#x4E00;&#x7C7B;&#x89D2;&#x8272;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;
````yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
namespace: lfs158
name: pod-reader
rules:</li>
<li>apiGroups: [&quot;&quot;] # &quot;&quot; indicates the core API group
resources: [&quot;pods&quot;]
verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]
````
&#x5982;&#x60A8;&#x6240;&#x89C1;&#xFF0C;&#x5B83;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;pod-reader&#x89D2;&#x8272;&#xFF0C;&#x8BE5;&#x89D2;&#x8272;&#x53EA;&#x80FD;&#x8BFB;&#x53D6;lfs158&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x7684;pod&#x3002;&#x521B;&#x5EFA;&#x89D2;&#x8272;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x7528;&#x6237;&#x4E0E;RoleBinding&#x7ED1;&#x5B9A;&#x3002;
&#x6709;&#x4E24;&#x79CD;RoleBinding&#xFF1A;</li>
<li>RoleBinding
&#x5B83;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x5C06;&#x7528;&#x6237;&#x7ED1;&#x5B9A;&#x5230;&#x4E0E;Role&#x76F8;&#x540C;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5728;RoleBinding&#x4E2D;&#x5F15;&#x7528;ClusterRole&#xFF0C;&#x5B83;&#x5C06;&#x6388;&#x4E88;&#x5BF9;RoleBinding&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;ClusterRole&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x8D44;&#x6E90;&#x7684;&#x6743;&#x9650;&#x3002;</li>
<li>ClusterRoleBinding
&#x5B83;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x6388;&#x4E88;&#x5BF9;cluster&#x7EA7;&#x8D44;&#x6E90;&#x548C;&#x6240;&#x6709;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x3002;
&#x5728;&#x672C;&#x8BFE;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x96C6;&#x4E2D;&#x8BA8;&#x8BBA;&#x7B2C;&#x4E00;&#x79CD;&#xFF0C;RoleBinding&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;
```YAML
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
name: pod-read-access
namespace: lfs158
subjects:</li>
<li>kind: User
name: student
apiGroup: rbac.authorization.k8s.io
roleRef:
kind: Role
name: pod-reader
apiGroup: rbac.authorization.k8s.io
```
&#x5982;&#x60A8;&#x6240;&#x89C1;&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x5B66;&#x751F;&#x7528;&#x6237;&#x8BFB;&#x53D6;lfs158&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x7684;Pods&#x3002;
&#x8981;&#x542F;&#x7528;RBAC&#x6388;&#x6743;&#x7A0B;&#x5E8F;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;--authorization-mode=RBAC&#x9009;&#x9879;&#x542F;&#x52A8;API&#x670D;&#x52A1;&#x5668;&#x3002;&#x901A;&#x8FC7;RBAC&#x6388;&#x6743;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x914D;&#x7F6E;&#x7B56;&#x7565;&#x3002;&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x67E5;&#x770B;<a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank">Kubernetes&#x6587;&#x6863;</a>&#x3002;<h4 id="admission-control">Admission Control</h4>
&lt;!---
Admission control is used to specify granular access control policies, which include allowing privileged containers, checking on resource quota, etc. We force these policies using different admission controllers, like ResourceQuota, DefaultStorageClass, AlwaysPullImages, etc. They come into effect only after API requests are authenticated and authorized.</li>
</ul>
<p>To use admission controls, we must start the Kubernetes API server with the --enable-admission-plugins, which takes a comma-delimited, ordered list of controller names:</p>
<p>--enable-admission-plugins=NamespaceLifecycle,ResourceQuota,PodSecurityPolicy,DefaultStorageClass</p>
<p>Kubernetes has some admission controllers enabled by default. For more details, please review the Kubernetes documentation.
---&gt;
&#x8BB8;&#x53EF;&#x63A7;&#x5236;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x7C92;&#x5EA6;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x7B56;&#x7565;&#xFF0C;&#x5305;&#x62EC;&#x7ED9;&#x5BB9;&#x5668;&#x6388;&#x4E88;&#x7279;&#x5B9A;&#x6743;&#x9650;&#x3001;&#x68C0;&#x67E5;&#x8D44;&#x6E90;&#x914D;&#x989D;&#x7B49;&#x3002;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x8BB8;&#x53EF;&#x63A7;&#x5236;&#x5668;&#x5F3A;&#x5236;&#x8FD9;&#x4E9B;&#x7B56;&#x7565;&#xFF0C;&#x5982;ResourceQuota&#x3001;DefaultStorageClass&#x3001;AlwaysPllimages&#xFF0C;&#x7B49;&#x7B49;&#x3002;&#x5B83;&#x4EEC;&#x53EA;&#x6709;&#x5728;API&#x8BF7;&#x6C42;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x548C;&#x6388;&#x6743;&#x540E;&#x624D;&#x751F;&#x6548;&#x3002;
&#x8981;&#x4F7F;&#x7528;&#x8BB8;&#x53EF;&#x63A7;&#x5236;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x4F7F;&#x7528;--enable-accedition-plugins&#x542F;&#x52A8;Kubernetes API&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8BE5;&#x63D2;&#x4EF6;&#x91C7;&#x7528;&#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x3001;&#x6709;&#x5E8F;&#x7684;&#x63A7;&#x5236;&#x5668;&#x540D;&#x79F0;&#x5217;&#x8868;&#xFF1A;</p>
<pre><code class="lang-bash">--enable-admission-plugins=NamespaceLifecycle,ResourceQuota,PodSecurityPolicy,DefaultStorageClass
</code></pre>
<p>Kubernetes&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x542F;&#x7528;&#x4E86;&#x4E00;&#x4E9B;&#x8BB8;&#x53EF;&#x63A7;&#x5236;&#x5668;&#x3002;&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x67E5;&#x770B;<a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/" target="_blank">Kubernetes&#x6587;&#x6863;</a>&#x3002;</p>
<h4 id="authentication-and-authorization-exercise-guide">Authentication and Authorization Exercise Guide</h4>
<!---
This exercise guide assumes the following environment, which by default uses the certificate and key from /var/lib/minikube/certs/, and RBAC mode for authorization:

Minikube v1.0.1
Kubernetes v1.14.1
Docker 18.06.3-ce
This exercise guide may be used together with the video demonstration following on the next page and it has been updated for the environment mentioned above, while the video presents an older Minikube distribution with Kubernetes v1.9.

Start Minikube:

$ minikube start

View the content of the kubectl client's configuration file, observing the only context minikube and the only user minikube, created by default:

$ kubectl config view

apiVersion: v1
clusters:
- cluster:
    certificate-authority: /home/student/.minikube/ca.crt
    server: https://192.168.99.100:8443
  name: minikube
contexts:
- context:
    cluster: minikube
    user: minikube
  name: minikube
current-context: minikube
kind: Config
preferences: {}
users:
- name: minikube
  user:
    client-certificate: /home/student/.minikube/client.crt
    client-key: /home/student/.minikube/client.key

Create lfs158 namespace:

$ kubectl create namespace lfs158

namespace/lfs158 created

Create rbac directory and cd into it:

$ mkdir rbac

$ cd rbac/

Create a private key for the student user with openssl tool, then create a certificate signing request for the student user with openssl tool:

~/rbac$ openssl genrsa -out student.key 2048

Generating RSA private key, 2048 bit long modulus (2 primes)
.................................................+++++
.........................+++++
e is 65537 (0x010001)

~/rbac$ openssl req -new -key student.key -out student.csr -subj "/CN=student/O=learner"

Create a YAML configuration file for a certificate signing request object, and save it with a blank value for the request field:

~/rbac$ vim signing-request.yaml

apiVersion: certificates.k8s.io/v1beta1
kind: CertificateSigningRequest
metadata:
  name: student-csr
spec:
  groups:
  - system:authenticated
  request: <assign encoded value from next cat command>
  usages:
  - digital signature
  - key encipherment
  - client auth

View the certificate, encode it in base64, and assign it to the request field in the signing-request.yaml file:

~/rbac$ cat student.csr | base64 | tr -d '\n'

LS0tLS1CRUd...1QtLS0tLQo=

~/rbac$ vim signing-request.yaml

apiVersion: certificates.k8s.io/v1beta1
kind: CertificateSigningRequest
metadata:
  name: student-csr
spec:
  groups:
  - system:authenticated
  request: LS0tLS1CRUd...1QtLS0tLQo=
  usages:
  - digital signature
  - key encipherment
  - client auth

Create the certificate signing request object, then list the certificate signing request objects. It shows a pending state:

~/rbac$ kubectl create -f signing-request.yaml

certificatesigningrequest.certificates.k8s.io/student-csr created

~/rbac$ kubectl get csr

NAME          AGE   REQUESTOR       CONDITION
student-csr   27s   minikube-user   Pending

Approve the certificate signing request object, then list the certificate signing request objects again. It shows both approved and issued states:

~/rbac$ kubectl certificate approve student-csr

certificatesigningrequest.certificates.k8s.io/student-csr approved

~/rbac$ kubectl get csr

NAME          AGE   REQUESTOR       CONDITION
student-csr   77s   minikube-user   Approved,Issued

Extract the approved certificate from the certificate signing request, decode it with base64 and save it as a certificate file. Then view the certificate in the newly created certificate file:

~/rbac$ kubectl get csr student-csr -o jsonpath='{.status.certificate}' | base64 --decode > student.crt

~/rbac$ cat student.crt

-----BEGIN CERTIFICATE-----
MIIDGzCCA...
...
...NOZRRZBVunTjK7A==
-----END CERTIFICATE-----

Configure the student user's credentials by assigning the key and certificate:

~/rbac$ kubectl config set-credentials student --client-certificate=student.crt --client-key=student.key

User "student" set.

Create a new context entry in the kubectl client's configuration file for the student user, associated with the lfs158 namespace in the minikube cluster:

~/rbac$ kubectl config set-context student-context --cluster=minikube --namespace=lfs158 --user=student

Context "student-context" created.

View the contents of the kubectl client's configuration file again, observing the new context entry student-context, and the new user entry student:

~/rbac$ kubectl config view

apiVersion: v1
clusters:
- cluster:
    certificate-authority: /home/student/.minikube/ca.crt
    server: https://192.168.99.100:8443
  name: minikube
contexts:
- context:
    cluster: minikube
    user: minikube
  name: minikube
- context:
    cluster: minikube
    namespace: lfs158
    user: student
  name: student-context
current-context: minikube
kind: Config
preferences: {}
users:
- name: minikube
  user:
    client-certificate: /home/student/.minikube/client.crt
    client-key: /home/student/.minikube/client.key
- name: student
  user:
    client-certificate: /home/student/rbac/student.crt
    client-key: /home/student/rbac/student.key

While in the default minikube context, create a new deployment in the lfs158 namespace:

~/rbac$ kubectl -n lfs158 create deployment nginx --image=nginx:alpine

deployment.apps/nginx created

From the new context student-context try to list pods. The attempt fails because the student user has no permissions configured for the student-context:

~/rbac$ kubectl --context=student-context get pods

Error from server (Forbidden): pods is forbidden: User "student" cannot list resource "pods" in API group "" in the namespace "lfs158"

The following steps will assign a limited set of permissions to the student user in the student-context.

Create a YAML configuration file for a pod-reader role object, which allows only get, watch, list actions in the lfs158 namespace against pod objects. Then create the role object and list it from the default minikube context, but from the lfs158 namespace:

~/rbac$ vim role.yaml

apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pod-reader
  namespace: lfs158
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "watch", "list"]

~/rbac$ kubectl create -f role.yaml

role.rbac.authorization.k8s.io/pod-reader created

~/rbac$ kubectl -n lfs158 get roles

NAME         AGE
pod-reader   57s

Create a YAML configuration file for a rolebinding object, which assigns the permissions of the pod-reader role to the student user. Then create the rolebinding object and list it from the default minikube context, but from the lfs158 namespace:

~/rbac$ vim rolebinding.yaml

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: pod-read-access
  namespace: lfs158
subjects:
- kind: User
  name: student
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io

~/rbac$ kubectl create -f rolebinding.yaml

rolebinding.rbac.authorization.k8s.io/pod-read-access created

~/rbac$ kubectl -n lfs158 get rolebindings

NAME              AGE
pod-read-access   23s

Now that we have assigned permissions to the student user, we can successfully list pods from the new context student-context.

~/rbac$ kubectl --context=student-context get pods

NAME                    READY   STATUS    RESTARTS   AGE
nginx-77595c695-f2xmd   1/1     Running   0          7m41s
--->
<p>&#x672C;&#x7EC3;&#x4E60;&#x6307;&#x5357;&#x5047;&#x8BBE;&#x4EE5;&#x4E0B;&#x73AF;&#x5883;&#xFF08;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;/var/lib/minikube/certs/&#x4E2D;&#x7684;&#x8BC1;&#x4E66;&#x548C;&#x5BC6;&#x94A5;&#xFF09;&#x548C;RBAC&#x6A21;&#x5F0F;&#x8FDB;&#x884C;&#x6388;&#x6743;&#xFF1A;</p>
<ul>
<li>Minikube 1.0.1&#x7248;</li>
<li>Kubernetes 1.14.1&#x7248;</li>
<li>Docker 18.06.3-ce
&#x672C;&#x7EC3;&#x4E60;&#x6307;&#x5357;&#x53EF;&#x4E0E;&#x4E0B;&#x4E00;&#x9875;&#x7684;&#x89C6;&#x9891;&#x6F14;&#x793A;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x5DF2;&#x9488;&#x5BF9;&#x4E0A;&#x8FF0;&#x73AF;&#x5883;&#x8FDB;&#x884C;&#x4E86;&#x66F4;&#x65B0;&#xFF0C;&#x540C;&#x65F6;&#x89C6;&#x9891;&#x5448;&#x73B0;&#x4E86;Kubernetes v1.9&#x7684;&#x65E7;Minikube&#x53D1;&#x884C;&#x7248;&#x3002;
&#x542F;&#x52A8;Minikube&#xFF1A;<pre><code class="lang-shell">$ minikube start
</code></pre>
&#x67E5;&#x770B;kubectl&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x89C2;&#x5BDF;&#x9ED8;&#x8BA4;&#x521B;&#x5EFA;&#x7684;&#x552F;&#x4E00;&#x4E0A;&#x4E0B;&#x6587;minikube&#x548C;&#x552F;&#x4E00;&#x7528;&#x6237;minikube&#xFF1A;
```shell
$ kubectl config view</li>
</ul>
<p>apiVersion: v1
clusters:</p>
<ul>
<li>cluster:
  certificate-authority: /home/student/.minikube/ca.crt
  server: <a href="https://192.168.99.100:8443" target="_blank">https://192.168.99.100:8443</a>
name: minikube
contexts:</li>
<li>context:
  cluster: minikube
  user: minikube
name: minikube
current-context: minikube
kind: Config
preferences: {}
users:</li>
<li>name: minikube
user:
  client-certificate: /home/student/.minikube/client.crt
  client-key: /home/student/.minikube/client.key
<code>&#x521B;&#x5EFA;lsf158&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;:</code>shell
$ kubectl create namespace lfs158</li>
</ul>
<p>namespace/lfs158 created</p>
<pre><code>&#x521B;&#x5EFA;rbac&#x76EE;&#x5F55;&#x5E76;&#x8FDB;&#x5165;:
```bash
$ mkdir rbac

$ cd rbac/
</code></pre><p>&#x4F7F;&#x7528;openssl&#x5DE5;&#x5177;&#x4E3A;&#x5B66;&#x751F;&#x7528;&#x6237;&#x521B;&#x5EFA;&#x79C1;&#x94A5;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;openssl&#x5DE5;&#x5177;&#x4E3A;&#x5B66;&#x751F;&#x7528;&#x6237;&#x521B;&#x5EFA;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;:</p>
<pre><code>~/rbac$ openssl genrsa -out student.key 2048

Generating RSA private key, 2048 bit long modulus (2 primes)
.................................................+++++
.........................+++++
e is 65537 (0x010001)

~/rbac$ openssl req -new -key student.key -out student.csr -subj &quot;/CN=student/O=learner&quot;
</code></pre><p>&#x4E3A;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x521B;&#x5EFA;YAML&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x4E3A;&#x8BF7;&#x6C42;&#x5B57;&#x6BB5;&#x7684;&#x7A7A;&#x503C;</p>
<pre><code class="lang-YAML">~/rbac$ vim signing-request.yaml

<span class="hljs-attr">apiVersion:</span> certificates.k8s.io/v1beta1
<span class="hljs-attr">kind:</span> CertificateSigningRequest
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> student-csr
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  groups:</span>
<span class="hljs-attr">  - system:</span>authenticated
<span class="hljs-attr">  request:</span> &lt;assign encoded value from next cat command<span class="hljs-string">&gt;
</span><span class="hljs-attr">  usages:</span>
<span class="hljs-bullet">  -</span> digital signature
<span class="hljs-bullet">  -</span> key encipherment
<span class="hljs-bullet">  -</span> client auth
</code></pre>
<p>&#x67E5;&#x770B;certificate&#xFF0C;&#x5C06;&#x5176;&#x7F16;&#x7801;&#x4E3A;base64&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x8D4B;&#x503C;&#x7ED9; signing-request.yaml&#x6587;&#x4EF6;&#x4E2D;&#x7684;request&#x5B57;&#x6BB5;&#x3002;</p>
<pre><code class="lang-bash">~/rbac$ cat student.csr | base64 | tr <span class="hljs-_">-d</span> <span class="hljs-string">&apos;\n&apos;</span>

LS0tLS1CRUd...1QtLS0tLQo=

~/rbac$ vim signing-request.yaml

apiVersion: certificates.k8s.io/v1beta1
kind: CertificateSigningRequest
metadata:
  name: student-csr
spec:
  groups:
  - system:authenticated
  request: LS0tLS1CRUd...1QtLS0tLQo=
  usages:
  - digital signature
  - key encipherment
  - client auth
</code></pre>
<p>&#x521B;&#x5EFA;certificate signing request&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x5217;&#x51FA;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x3002;&#x5B83;&#x663E;&#x793A;&#x4E00;&#x4E2A;&#x6302;&#x8D77;&#x72B6;&#x6001;:</p>
<pre><code class="lang-bash">~/rbac$ kubectl create <span class="hljs-_">-f</span> signing-request.yaml

certificatesigningrequest.certificates.k8s.io/student-csr created

~/rbac$ kubectl get csr

NAME          AGE   REQUESTOR       CONDITION
student-csr   27s   minikube-user   Pending
</code></pre>
<p>&#x6279;&#x51C6;certificate signing request &#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x6B21;&#x5217;&#x51FA;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x3002;&#x5B83;&#x540C;&#x65F6;&#x663E;&#x793A;&#x4E86;approved &#x548C;issued&#x7684;&#x72B6;&#x6001;:</p>
<pre><code class="lang-bash">~/rbac$ kubectl certificate approve student-csr

certificatesigningrequest.certificates.k8s.io/student-csr approved

~/rbac$ kubectl get csr

NAME          AGE   REQUESTOR       CONDITION
student-csr   77s   minikube-user   Approved,Issued
</code></pre>
<p>&#x4ECE;certificate signing request&#x4E2D;&#x63D0;&#x53D6;&#x5DF2;&#x6279;&#x51C6;&#x7684;certificate &#xFF0C;&#x7528;base64&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x89E3;&#x7801;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x4E3A; certificate file&#x3002;&#x7136;&#x540E;&#x67E5;&#x770B;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x8BC1;&#x4E66;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x8BC1;&#x4E66;:</p>
<pre><code class="lang-bash">~/rbac$ kubectl get csr student-csr -o jsonpath=<span class="hljs-string">&apos;{.status.certificate}&apos;</span> | base64 --decode &gt; student.crt

~/rbac$ cat student.crt

-----BEGIN CERTIFICATE-----
MIIDGzCCA...
...
...NOZRRZBVunTjK7A==
-----END CERTIFICATE-----
</code></pre>
<p>&#x901A;&#x8FC7;&#x5206;&#x914D;&#x5BC6;&#x94A5;&#x548C;&#x8BC1;&#x4E66;&#x6765;&#x914D;&#x7F6E;&#x5B66;&#x751F;&#x7528;&#x6237;&#x7684;&#x51ED;&#x636E;:</p>
<pre><code>~/rbac$ kubectl config set-credentials student --client-certificate=student.crt --client-key=student.key

User &quot;student&quot; set.
</code></pre><p>&#x5728;kubectl&#x5BA2;&#x6237;&#x673A;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x4E3A;&#x5B66;&#x751F;&#x7528;&#x6237;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x6761;&#x76EE;&#xFF0C;&#x8BE5;&#x6761;&#x76EE;&#x4E0E;minikube&#x96C6;&#x7FA4;&#x4E2D;&#x7684;lfs158&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x76F8;&#x5173;&#x8054;</p>
<pre><code>~/rbac$ kubectl config set-context student-context --cluster=minikube --namespace=lfs158 --user=student

Context &quot;student-context&quot; created.
</code></pre><p>&#x518D;&#x6B21;&#x67E5;&#x770B;kubectl&#x5BA2;&#x6237;&#x673A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x89C2;&#x5BDF;&#x65B0;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x6761;&#x76EE;student-context&#x548C;&#x65B0;&#x7684;&#x7528;&#x6237;&#x6761;&#x76EE;student
```~/rbac$ kubectl config view</p>
<p>apiVersion: v1
clusters:</p>
<ul>
<li>cluster:
  certificate-authority: /home/student/.minikube/ca.crt
  server: <a href="https://192.168.99.100:8443" target="_blank">https://192.168.99.100:8443</a>
name: minikube
contexts:</li>
<li>context:
  cluster: minikube
  user: minikube
name: minikube</li>
<li>context:
  cluster: minikube
  namespace: lfs158
  user: student
name: student-context
current-context: minikube
kind: Config
preferences: {}
users:</li>
<li>name: minikube
user:
  client-certificate: /home/student/.minikube/client.crt
  client-key: /home/student/.minikube/client.key</li>
<li>name: student
user:
  client-certificate: /home/student/rbac/student.crt
  client-key: /home/student/rbac/student.key<pre><code>&#x5728;&#x9ED8;&#x8BA4;&#x7684;minikube&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#xFF0C;&#x5728;lfs158&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;deployment :
</code></pre>~/rbac$ kubectl -n lfs158 create deployment nginx --image=nginx:alpine</li>
</ul>
<p>deployment.apps/nginx created</p>
<pre><code>&#x4ECE;&#x65B0;&#x7684;context student-context &#x8BD5;&#x7740;&#x5217;&#x51FA;Pods&#x3002;&#x56E0;&#x4E3A;student &#x7528;&#x6237;&#x6CA1;&#x6709;&#x4E3A; student-context&#x914D;&#x7F6E;&#x6743;&#x9650;&#xFF0C;&#x6240;&#x4EE5;&#x5C1D;&#x8BD5;&#x5931;&#x8D25;:
</code></pre><p>~/rbac$ kubectl --context=student-context get pods</p>
<p>Error from server (Forbidden): pods is forbidden: User &quot;student&quot; cannot list resource &quot;pods&quot; in API group &quot;&quot; in the namespace &quot;lfs158&quot;</p>
<pre><code>&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#x5C06;&#x5728;student-context&#x4E2D;&#x4E3A;student&#x7528;&#x6237;&#x5206;&#x914D;&#x4E00;&#x7EC4;&#x6709;&#x9650;&#x7684;&#x6743;&#x9650;&#x3002;
&#x4E3A;&#x4E00;&#x4E2A;pod-reader role&#x5BF9;&#x8C61;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;YAML&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x53EA;&#x5141;&#x8BB8;&#x5BF9;pod&#x5BF9;&#x8C61;&#x4F7F;&#x7528;lfs158&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;get&#x3001;watch&#x548C;list&#x64CD;&#x4F5C;&#x3002;&#x7136;&#x540E;&#x521B;&#x5EFA;role&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4ECE;&#x9ED8;&#x8BA4;&#x7684;minikube context(&#x4F46;&#x4ECE;lfs158&#x540D;&#x79F0;&#x7A7A;&#x95F4;)&#x5217;&#x51FA;&#x5B83;:
</code></pre><p>~/rbac$ vim role.yaml</p>
<p>apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pod-reader
  namespace: lfs158
rules:</p>
<ul>
<li>apiGroups: [&quot;&quot;]
resources: [&quot;pods&quot;]
verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</li>
</ul>
<p>~/rbac$ kubectl create -f role.yaml</p>
<p>role.rbac.authorization.k8s.io/pod-reader created</p>
<p>~/rbac$ kubectl -n lfs158 get roles</p>
<p>NAME         AGE
pod-reader   57s</p>
<pre><code>&#x4E3A;rolebinding&#x5BF9;&#x8C61;&#x521B;&#x5EFA;YAML&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x5C06;pod-reader&#x89D2;&#x8272;&#x7684;&#x6743;&#x9650;&#x5206;&#x914D;&#x7ED9;student&#x7528;&#x6237;&#x3002;&#x7136;&#x540E;&#x521B;&#x5EFA;rolebinding&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4ECE;&#x9ED8;&#x8BA4;&#x7684;minikube&#x4E0A;&#x4E0B;&#x6587;(&#x4F46;&#x4ECE;lfs158&#x540D;&#x79F0;&#x7A7A;&#x95F4;)&#x5217;&#x51FA;&#x5B83;
</code></pre><p>~/rbac$ vim rolebinding.yaml</p>
<p>apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: pod-read-access
  namespace: lfs158
subjects:</p>
<ul>
<li>kind: User
name: student
apiGroup: rbac.authorization.k8s.io
roleRef:
kind: Role
name: pod-reader
apiGroup: rbac.authorization.k8s.io</li>
</ul>
<p>~/rbac$ kubectl create -f rolebinding.yaml</p>
<p>rolebinding.rbac.authorization.k8s.io/pod-read-access created</p>
<p>~/rbac$ kubectl -n lfs158 get rolebindings</p>
<p>NAME              AGE
pod-read-access   23s</p>
<pre><code>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x4E3A;student&#x7528;&#x6237;&#x5206;&#x914D;&#x4E86;&#x6743;&#x9650;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6210;&#x529F;&#x5730;&#x5217;&#x51FA;&#x6765;&#x81EA;&#x65B0; context student-context&#x7684;pods:
</code></pre><p>~/rbac$ kubectl --context=student-context get pods</p>
<p>NAME                    READY   STATUS    RESTARTS   AGE
nginx-77595c695-f2xmd   1/1     Running   0          7m4</p>
<pre><code>#### Authentication and Authorization (Demo)

&lt;video id=&quot;video&quot; controls=&quot;&quot; preload=&quot;none&quot;&gt;
  &lt;source id=&quot;mp4&quot; src=&quot;assets/LINIKLFS2017-V001100_DTH.mp4&quot; type=&quot;video/mp4&quot;&gt;
&lt;/video&gt;

## Chapter 10. Services
### Introduction and Learning Objectives
#### Introduction
&lt;!--- Although the microservices driven architecture aims to decouple the components of an application, microservices still need agents to logically tie or group them together and to load balance traffic to the ones that are part of such a logical set.

In this chapter, we will learn about Services, used to group Pods to provide common access points from the external world to the containerized applications. We will learn about the kube-proxy daemon, which runs on each worker node to provide access to services. We will also discuss service discovery and service types, which decide the access scope of a service.
---&gt;
&#x5C3D;&#x7BA1;&#x5FAE;&#x670D;&#x52A1;&#x9A71;&#x52A8;&#x7684;&#x4F53;&#x7CFB;&#x7ED3;&#x6784;&#x65E8;&#x5728;&#x5206;&#x79BB;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x4F46;&#x5FAE;&#x670D;&#x52A1;&#x4ECD;&#x7136;&#x9700;&#x8981;&#x4EE3;&#x7406;&#x4EE5;&#x903B;&#x8F91;&#x65B9;&#x5F0F;&#x5C06;&#x5B83;&#x4EEC;&#x7ED1;&#x5B9A;&#x6216;&#x5206;&#x7EC4;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x5E76;&#x5C06;&#x6D41;&#x91CF;&#x8D1F;&#x8F7D;&#x5E73;&#x8861;&#x5230;&#x5C5E;&#x4E8E;&#x8FD9;&#x79CD;&#x903B;&#x8F91;&#x96C6;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;
&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5B66;&#x4E60;Service&#xFF0C;&#x8FD9;&#x4E9B;&#x670D;&#x52A1;&#x7528;&#x4E8E;&#x5C06;pod&#x5206;&#x7EC4;&#xFF0C;&#x4EE5;&#x63D0;&#x4F9B;&#x4ECE;&#x5916;&#x90E8;&#x4E16;&#x754C;&#x5230;&#x5BB9;&#x5668;&#x5316;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x516C;&#x5171;&#x8BBF;&#x95EE;&#x70B9;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x4E86;&#x89E3;kube-proxy&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#xFF0C;&#x5B83;&#x5728;&#x6BCF;&#x4E2A;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x4E0A;&#x8FD0;&#x884C;&#xFF0C;&#x4EE5;&#x63D0;&#x4F9B;&#x5BF9;&#x670D;&#x52A1;&#x7684;&#x8BBF;&#x95EE;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x5C06;&#x8BA8;&#x8BBA;&#x670D;&#x52A1;&#x7684;&#x53D1;&#x73B0;&#x548C;&#x670D;&#x52A1;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x5B83;&#x4EEC;&#x51B3;&#x5B9A;&#x4E86;&#x670D;&#x52A1;&#x7684;&#x8BBF;&#x95EE;&#x8303;&#x56F4;&#x3002;
#### Learning Objectives
&lt;!--- By the end of this chapter, you should be able to:

Discuss the benefits of logically grouping Pods with Services to access an application.
Explain the role of the kube-proxy daemon running on each worker node.
Explore the Service discovery options available in Kubernetes.
Discuss different Service types. ---&gt;
&#x5728;&#x672C;&#x7AE0;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x60A8;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#xFF1A;
* &#x8BA8;&#x8BBA;&#x5C06;pod&#x4EE5;&#x903B;&#x8F91;&#x5206;&#x7EC4;&#x5F62;&#x6210;Service&#x4EE5;&#x8BBF;&#x95EE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x597D;&#x5904;&#x3002;
* &#x89E3;&#x91CA;&#x5728;&#x6BCF;&#x4E2A;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x4E0A;&#x8FD0;&#x884C;&#x7684;kube-proxy&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x89D2;&#x8272;&#x3002;
* &#x63A2;&#x7D22;Kubernetes&#x4E2D;&#x63D0;&#x4F9B;&#x7684;&#x53D1;&#x73B0;&#x670D;&#x52A1;&#x7684;&#x9009;&#x9879;&#x3002;
* &#x8BA8;&#x8BBA;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x7C7B;&#x578B;&#x3002;
### Services
#### Connecting Users to Pods
&lt;!---
To access the application, a user/client needs to connect to the Pods. As Pods are ephemeral in nature, resources like IP addresses allocated to it cannot be static. Pods could be terminated abruptly or be rescheduled based on existing requirements.

Let&apos;s take, for example, a scenario in which a user/client is connected to a Pod using its IP address.



A scenario where a user is connected to a pod via its IP address

A Scenario Where a User Is Connected to a Pod via Its IP Address



Unexpectedly, the Pod to which the user/client is connected is terminated, and a new Pod is created by the controller. The new Pod will have a new IP address, which will not be known automatically to the user/client of the earlier Pod.



A new Pod is created after the old one dies unexpectedly

A New Pod Is Created After the Old One Terminated Unexpectedly



To overcome this situation, Kubernetes provides a higher-level abstraction called Service, which logically groups Pods and defines a policy to access them. This grouping is achieved via Labels and Selectors.
---&gt;
&#x8981;&#x8BBF;&#x95EE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x7528;&#x6237;/&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x8FDE;&#x63A5;&#x5230;Pods&#x3002;&#x7531;&#x4E8E;pod&#x672C;&#x8D28;&#x4E0A;&#x662F;&#x77ED;&#x6682;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5206;&#x914D;&#x7ED9;&#x5B83;&#x7684;&#x8D44;&#x6E90;&#xFF08;&#x5982;IP&#x5730;&#x5740;&#xFF09;&#x4E0D;&#x80FD;&#x662F;&#x9759;&#x6001;&#x7684;&#x3002;Pods&#x53EF;&#x7A81;&#x7136;&#x7EC8;&#x6B62;&#x6216;&#x6839;&#x636E;&#x73B0;&#x6709;&#x8981;&#x6C42;&#x91CD;&#x65B0;&#x5B89;&#x6392;&#x3002;
&#x4F8B;&#x5982;&#xFF0C;&#x5047;&#x8BBE;&#x7528;&#x6237;/&#x5BA2;&#x6237;&#x673A;&#x4F7F;&#x7528;&#x5176;IP&#x5730;&#x5740;&#x8FDE;&#x63A5;&#x5230;Pod&#x3002;
![](assets/cka-70af1004.png)
&#x7528;&#x6237;&#x901A;&#x8FC7;&#x5176;IP&#x5730;&#x5740;&#x8FDE;&#x63A5;&#x5230;pod&#x7684;&#x573A;&#x666F;
&#x610F;&#x5916;&#x5730;&#xFF0C;&#x7528;&#x6237;/&#x5BA2;&#x6237;&#x673A;&#x8FDE;&#x63A5;&#x5230;&#x7684;Pod&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x63A7;&#x5236;&#x5668;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;Pod&#x3002;&#x65B0;&#x7684;Pod&#x5C06;&#x6709;&#x4E00;&#x4E2A;&#x65B0;&#x7684;IP&#x5730;&#x5740;&#xFF0C;&#x5148;&#x524D;Pod&#x7684;&#x7528;&#x6237;/&#x5BA2;&#x6237;&#x673A;&#x6CA1;&#x6CD5;&#x81EA;&#x52A8;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x5730;&#x5740;&#x3002;
![](assets/cka-5376505f.png)
&#x65B0;&#x7684;Pod&#x662F;&#x5728;&#x65E7;&#x7684;Pod&#x610F;&#x5916;&#x7EC8;&#x6B62;&#x540E;&#x521B;&#x5EFA;&#x7684;
&#x4E3A;&#x4E86;&#x514B;&#x670D;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;Kubernetes&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x79F0;&#x4E3A;Service&#x7684;&#x66F4;&#x9AD8;&#x5C42;&#x6B21;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x5B83;&#x5728;&#x903B;&#x8F91;&#x4E0A;&#x5BF9;pod&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#x5E76;&#x5B9A;&#x4E49;&#x8BBF;&#x95EE;&#x5B83;&#x4EEC;&#x7684;&#x7B56;&#x7565;&#x3002;&#x8FD9;&#x4E2A;&#x5206;&#x7EC4;&#x662F;&#x901A;&#x8FC7;**labels**&#x548C;**Selectors**&#x5B9E;&#x73B0;&#x7684;&#x3002;
#### Services
&lt;!---
In the following graphical representation, app is the Label key, frontend and db are Label values for different Pods.



A service representation

Grouping of Pods using Labels and Selectors



Using the selectors app==frontend and app==db, we group Pods into two logical sets: one with 3 Pods, and one with a single Pod.

We assign a name to the logical grouping, referred to as a Service. In our example, we create two Services, frontend-svc, and db-svc, and they have the app==frontend and the app==db Selectors, respectively.



Services

Grouping of Pods using the Service object

Services can expose single Pods, ReplicaSets, Deployments, DaemonSets, and StatefulSets.
----&gt;
&#x5728;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x5F62;&#x8868;&#x793A;&#x4E2D;&#xFF0C;app&#x662F;&#x6807;&#x7B7E;&#x952E;&#xFF0C;frontend&#x548C;db&#x662F;&#x4E0D;&#x540C;pod&#x7684;&#x6807;&#x7B7E;&#x503C;&#x3002;
![](assets/cka-bd04165a.png)
&#x4F7F;&#x7528;**Labels**&#x548C;**Selectors**&#x5BF9;pod&#x8FDB;&#x884C;&#x5206;&#x7EC4;
&#x4F7F;&#x7528;&#x9009;&#x62E9;&#x5668;app==frontend&#x548C;app==db&#xFF0C;&#x6211;&#x4EEC;&#x5C06;Pod&#x5206;&#x7EC4;&#x4E3A;&#x4E24;&#x4E2A;&#x903B;&#x8F91;&#x96C6;&#xFF1A;&#x4E00;&#x4E2A;&#x5305;&#x542B;3&#x4E2A;Pod&#xFF0C;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x5355;&#x4E2A;Pod&#x3002;
&#x6211;&#x4EEC;&#x4E3A;&#x903B;&#x8F91;&#x5206;&#x7EC4;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#xFF0C;&#x79F0;&#x4E3A;Service&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E86;&#x4E24;&#x4E2A;&#x670D;&#x52A1;frontend-svc&#x548C;db-svc&#xFF0C;&#x5B83;&#x4EEC;&#x5206;&#x522B;&#x5177;&#x6709;app==frontend&#x548C;app==db&#x9009;&#x62E9;&#x5668;&#x3002;
![](assets/cka-a0bea670.png)
&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5BF9;&#x8C61;&#x5BF9;pod&#x8FDB;&#x884C;&#x5206;&#x7EC4;
&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x516C;&#x5F00;&#x5355;&#x4E2A;pod&#x3001; ReplicaSets, Deployments, DaemonSets, &#x548C; StatefulSets&#x3002;
#### Service Object Example
&lt;!---
The following is an example of a Service object definition:

kind: Service
apiVersion: v1
metadata:
  name: frontend-svc
spec:
  selector:
    app: frontend
  ports:
  - protocol: TCP
    port: 80
    targetPort: 5000

In this example, we are creating a frontend-svc Service by selecting all the Pods that have the Label key=app set to value=frontend. By default, each Service receives an IP address routable only inside the cluster, known as ClusterIP. In our example, we have 172.17.0.4 and 172.17.0.5 as ClusterIPs assigned to our frontend-svc and db-svc Services, respectively.



A service

Accessing the Pods using Service Object

The user/client now connects to a Service via its ClusterIP, which forwards traffic to one of the Pods attached to it. A Service provides load balancing by default while selecting the Pods for traffic forwarding.

While the Service forwards traffic to Pods, we can select the targetPort on the Pod which receives the traffic. In our example, the frontend-svc Service receives requests from the user/client on port 80 and then forwards these requests to one of the attached Pods on the targetPort 5000. If the targetPort is not defined explicitly, then traffic will be forwarded to Pods on the port on which the Service receives traffic.

A logical set of a Pod&apos;s IP address, along with the targetPort is referred to as a Service endpoint. In our example, the frontend-svc Service has 3 endpoints: 10.0.1.3:5000, 10.0.1.4:5000, and 10.0.1.5:5000. Endpoints are created and managed automatically by the Service, not by the Kubernetes cluster administrator.
---&gt;
&#x4EE5;&#x4E0B;&#x662F;&#x670D;&#x52A1;&#x5BF9;&#x8C61;&#x5B9A;&#x4E49;&#x7684;&#x793A;&#x4F8B;&#xFF1A;
```json
kind: Service
apiVersion: v1
metadata:
  name: frontend-svc
spec:
  selector:
    app: frontend
  ports:
  - protocol: TCP
    port: 80
    targetPort: 5000
</code></pre><p>&#x5728;&#x672C;&#x4F8B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x9009;&#x62E9;&#x6807;&#x7B7E;key=app&#x8BBE;&#x7F6E;&#x4E3A;value=frontend&#x7684;&#x6240;&#x6709;pod&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;frontend-svc&#x670D;&#x52A1;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6BCF;&#x4E2A;Service&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x5185;&#x8DEF;&#x7531;&#x7684;IP&#x5730;&#x5740;&#xFF0C;&#x79F0;&#x4E3A;cluster IP&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;172.17.0.4&#x548C;172.17.0.5&#x5206;&#x522B;&#x4F5C;&#x4E3A;&#x96C6;&#x7FA4;&#x5206;&#x914D; frontend-svc&#x548C;db-svc&#x670D;&#x52A1;&#x3002;
<img src="assets/cka-dbd0cb60.png" alt="">
&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5BF9;&#x8C61;&#x8BBF;&#x95EE;Pods
&#x7528;&#x6237;/&#x5BA2;&#x6237;&#x7AEF;&#x73B0;&#x5728;&#x901A;&#x8FC7;&#x5176;ClusterIP&#x8FDE;&#x63A5;&#x5230;&#x4E00;&#x4E2A;Service&#xFF0C;ClusterIP&#x5C06;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x5230;&#x9644;&#x52A0;&#x5230;&#x5B83;&#x7684;&#x4E00;&#x4E2A;pod&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Service&#x5728;&#x4E3A;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x9009;&#x62E9;Pods&#x65F6;&#x63D0;&#x4F9B;&#x8D1F;&#x8F7D;&#x5E73;&#x8861;&#x3002;
&#x5F53;&#x670D;&#x52A1;&#x5C06;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x5230;Pods&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x63A5;&#x6536;&#x6D41;&#x91CF;&#x7684;Pod&#x4E0A;&#x9009;&#x62E9;&#x76EE;&#x6807;&#x7AEF;&#x53E3;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x524D;&#x7AEF;svc&#x670D;&#x52A1;&#x63A5;&#x6536;&#x6765;&#x81EA;&#x7AEF;&#x53E3;80&#x4E0A;&#x7684;&#x7528;&#x6237;/&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x8FD9;&#x4E9B;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;targetPort 5000&#x4E0A;&#x7684;&#x4E00;&#x4E2A;pod&#x3002;&#x5982;&#x679C;&#x672A;&#x663E;&#x5F0F;&#x5B9A;&#x4E49;targetPort&#xFF0C;&#x5219;&#x6D41;&#x91CF;&#x5C06;&#x8F6C;&#x53D1;&#x5230;Service&#x63A5;&#x6536;&#x6D41;&#x91CF;&#x7684;port&#x7684;Pods&#x3002;
Pod&#x7684;IP&#x5730;&#x5740;&#x548C;&#x76EE;&#x6807;&#x7AEF;&#x53E3;&#x7684;&#x903B;&#x8F91;&#x96C6;&#x79F0;&#x4E3A;&#x670D;&#x52A1;&#x7684;end Point, &#x7AEF;&#x70B9;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;front-svc&#x670D;&#x52A1;&#x6709;3&#x4E2A;&#x7AEF;&#x70B9;&#xFF1A;10.0.1.3:5000&#x3001;10.0.1.4:5000&#x548C;10.0.1.5:5000&#x3002;&#x7AEF;&#x70B9;&#x7531;&#x670D;&#x52A1;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x548C;&#x7BA1;&#x7406;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7531;Kubernetes&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x5458;&#x521B;&#x5EFA;&#x548C;&#x7BA1;&#x7406;&#x3002;</p>
<h4 id="kube-proxy">kube-proxy</h4>
<!---
All worker nodes run a daemon called kube-proxy, which watches the API server on the master node for the addition and removal of Services and endpoints. In the example below, for each new Service, on each node, kube-proxy configures iptables rules to capture the traffic for its ClusterIP and forwards it to one of the Service's endpoints. Therefore any node can receive the external traffic and then route it internally in the cluster based on the iptables rules. When the Service is removed, kube-proxy removes the corresponding iptables rules on all nodes as well.
--->
<p>&#x6240;&#x6709;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x90FD;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;kube-proxy&#x7684;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#xFF0C;&#x8BE5;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x76D1;&#x89C6;&#x4E3B;&#x8282;&#x70B9;&#x4E0A;&#x7684;API Server&#x6DFB;&#x52A0;&#x548C;&#x5220;&#x9664;&#x670D;&#x52A1;&#x548C;&#x7AEF;&#x70B9;&#x3002;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x65B0;&#x670D;&#x52A1;&#xFF0C;&#x5728;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;kube-proxy&#x914D;&#x7F6E;iptables&#x89C4;&#x5219;&#x6765;&#x6355;&#x83B7;&#x5176;ClusterIP&#x7684;&#x6D41;&#x91CF;&#x5E76;&#x5C06;&#x5176;&#x8F6C;&#x53D1;&#x5230;&#x670D;&#x52A1;&#x7684;&#x4E00;&#x4E2A;&#x7AEF;&#x70B9;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4EFB;&#x4F55;&#x8282;&#x70B9;&#x90FD;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x5916;&#x90E8;&#x6D41;&#x91CF;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;iptables&#x89C4;&#x5219;&#x5728;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x8DEF;&#x7531;&#x3002;&#x5F53;&#x670D;&#x52A1;&#x88AB;&#x79FB;&#x9664;&#x65F6;&#xFF0C;kube-proxy&#x4E5F;&#x4F1A;&#x79FB;&#x9664;&#x6240;&#x6709;&#x8282;&#x70B9;&#x4E0A;&#x76F8;&#x5E94;&#x7684;iptables&#x89C4;&#x5219;&#x3002;
<img src="assets/cka-aba942f6.png" alt=""></p>
<h4 id="service-discovery">Service Discovery</h4>
<!---
As Services are the primary mode of communication in Kubernetes, we need a way to discover them at runtime. Kubernetes supports two methods for discovering Services:

Environment Variables
As soon as the Pod starts on any worker node, the kubelet daemon running on that node adds a set of environment variables in the Pod for all active Services. For example, if we have an active Service called redis-master, which exposes port 6379, and its ClusterIP is 172.17.0.6, then, on a newly created Pod, we can see the following environment variables:

REDIS_MASTER_SERVICE_HOST=172.17.0.6
REDIS_MASTER_SERVICE_PORT=6379
REDIS_MASTER_PORT=tcp://172.17.0.6:6379
REDIS_MASTER_PORT_6379_TCP=tcp://172.17.0.6:6379
REDIS_MASTER_PORT_6379_TCP_PROTO=tcp
REDIS_MASTER_PORT_6379_TCP_PORT=6379
REDIS_MASTER_PORT_6379_TCP_ADDR=172.17.0.6

With this solution, we need to be careful while ordering our Services, as the Pods will not have the environment variables set for Services which are created after the Pods are created.
DNS
Kubernetes has an add-on for DNS, which creates a DNS record for each Service and its format is my-svc.my-namespace.svc.cluster.local. Services within the same Namespace find other Services just by their name. If we add a Service redis-master in my-ns Namespace, all Pods in the same Namespace lookup the Service just by its name, redis-master. Pods from other Namespaces lookup the same Service by adding the respective Namespace as a suffix, such as redis-master.my-ns.
This is the most common and highly recommended solution. For example, in the previous section's image, we have seen that an internal DNS is configured, which maps our Services frontend-svc and db-svc to 172.17.0.4 and 172.17.0.5, respectively.
--->
<p>&#x7531;&#x4E8E;&#x670D;&#x52A1;&#x662F;Kubernetes&#x4E2D;&#x7684;&#x4E3B;&#x8981;&#x901A;&#x4FE1;&#x6A21;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x79CD;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x53D1;&#x73B0;&#x5B83;&#x4EEC;&#x7684;&#x65B9;&#x6CD5;&#x3002;Kubernetes&#x652F;&#x6301;&#x4E24;&#x79CD;&#x53D1;&#x73B0;&#x670D;&#x52A1;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ul>
<li>&#x73AF;&#x5883;&#x53D8;&#x91CF;
&#x4E00;&#x65E6;Pod&#x5728;&#x4EFB;&#x4F55;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x4E0A;&#x542F;&#x52A8;&#xFF0C;&#x5728;&#x8BE5;&#x8282;&#x70B9;&#x4E0A;&#x8FD0;&#x884C;&#x7684;kubelet&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x5C31;&#x4F1A;&#x5728;Pod&#x4E2D;&#x4E3A;&#x6240;&#x6709;&#x6D3B;&#x52A8;&#x670D;&#x52A1;&#x6DFB;&#x52A0;&#x4E00;&#x7EC4;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;redis-master&#x7684;&#x6FC0;&#x6D3B;&#x72B6;&#x6001;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5B83;&#x516C;&#x5F00;&#x7AEF;&#x53E3;&#x662F;6379&#xFF0C;&#x5176;ClusterIP&#x4E3A;172.17.0.6&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x5728;&#x65B0;&#x521B;&#x5EFA;&#x7684;Pod&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4EE5;&#x4E0B;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF1A;<pre><code>REDIS_MASTER_SERVICE_&#x4E3B;&#x673A;=172.17.0.6
REDIS_MASTER_&#x670D;&#x52A1;&#x7AEF;&#x53E3;=6379
REDIS_MASTER_PORT=tcp://172.17.0.6:6379
REDIS_MASTER_PORT_6379_TCP=TCP://172.17.0.6:6379
REDIS_MASTER_PORT_6379_TCP_PROTO=TCP
REDIS_MASTER_PORT_6379_TCP_PORT=6379
REDIS_MASTER_&#x7AEF;&#x53E3;_6379_TCP_&#x5730;&#x5740;=172.17.0.6
</code></pre>&#x4F7F;&#x7528;&#x6B64;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x8BA2;&#x9605;Service&#x65F6;&#x9700;&#x8981;&#x5C0F;&#x5FC3;&#xFF0C;&#x56E0;&#x4E3A;Pods&#x4E0D;&#x4F1A;&#x4E3A;&#x521B;&#x5EFA;Pods&#x540E;&#x521B;&#x5EFA;&#x7684;&#x670D;&#x52A1;&#x8BBE;&#x7F6E;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x3002;</li>
<li>&#x57DF;&#x540D;&#x670D;&#x52A1;&#x5668;
Kubernetes&#x6709;&#x4E00;&#x4E2A;DNS&#x63D2;&#x4EF6;&#xFF0C;&#x5B83;&#x4E3A;&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;DNS&#x8BB0;&#x5F55;&#xFF0C;&#x5176;&#x683C;&#x5F0F;&#x4E3A;my-svc.my-namespace.svc.cluster.local&#x3002;&#x540C;&#x4E00;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;&#x670D;&#x52A1;&#x4EC5;&#x6309;&#x540D;&#x79F0;&#x67E5;&#x627E;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5728;my-ns&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x4E2D;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x670D;&#x52A1;redis-master&#xFF0C;&#x90A3;&#x4E48;&#x540C;&#x4E00;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;&#x6240;&#x6709;pod&#x53EA;&#x4F1A;&#x6309;&#x5176;&#x540D;&#x79F0;redis-master&#x67E5;&#x627E;&#x670D;&#x52A1;&#x3002;&#x6765;&#x81EA;&#x5176;&#x4ED6;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;pod&#x901A;&#x8FC7;&#x6DFB;&#x52A0;&#x76F8;&#x5E94;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x540D;&#x79F0;&#x4E3A;&#x540E;&#x7F00;&#xFF08;&#x5982;redis-master.my-ns&#xFF09;&#x6765;&#x67E5;&#x627E;&#x76F8;&#x540C;&#x7684;&#x670D;&#x52A1;&#x3002;
&#x8FD9;&#x662F;&#x6700;&#x5E38;&#x89C1;&#x548C;&#x6700;&#x63A8;&#x8350;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x4E0A;&#x4E00;&#x8282;&#x7684;&#x56FE;&#x7247;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x914D;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A;&#x5185;&#x90E8;DNS&#xFF0C;&#x5B83;&#x5C06;&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;frontend-svc&#x548C;db-svc&#x5206;&#x522B;&#x6620;&#x5C04;&#x5230;172.17.0.4&#x548C;172.17.0.5&#x3002;<h4 id="servicetype">ServiceType</h4>
&lt;!---
While defining a Service, we can also choose its access scope. We can decide whether the Service:</li>
</ul>
<p>Is only accessible within the cluster
Is accessible from within the cluster and the external world
Maps to an entity which resides either inside or outside the cluster.
Access scope is decided by ServiceType, which can be configured when creating the Service.
---&gt;
&#x5728;&#x5B9A;&#x4E49;Service&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x5176;&#x8BBF;&#x95EE;&#x8303;&#x56F4;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x51B3;&#x5B9A;Service&#x662F;&#x5426;&#xFF1A;</p>
<ul>
<li>&#x53EA;&#x80FD;&#x5728;&#x7FA4;&#x96C6;&#x4E2D;&#x8BBF;&#x95EE;</li>
<li>&#x53EF;&#x4ECE;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x548C;&#x5916;&#x90E8;&#x4E16;&#x754C;&#x8BBF;&#x95EE;</li>
<li>&#x6620;&#x5C04;&#x5230;&#x4F4D;&#x4E8E;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x6216;&#x5916;&#x90E8;&#x7684;&#x5B9E;&#x4F53;&#x3002;
&#x8BBF;&#x95EE;&#x8303;&#x56F4;&#x7531;ServiceType&#x51B3;&#x5B9A;&#xFF0C;ServiceType&#x53EF;&#x4EE5;&#x5728;&#x521B;&#x5EFA;Service&#x65F6;&#x914D;&#x7F6E;&#x3002;<h4 id="servicetype-clusterip-and-nodeport">ServiceType: ClusterIP and NodePort</h4>
&lt;!---
ServiceType: ClusterIP and NodePort
Bookmark this page
ClusterIP is the default ServiceType. A Service receives a Virtual IP address, known as its ClusterIP. This Virtual IP address is used for communicating with the Service and is accessible only within the cluster.</li>
</ul>
<p>With the NodePort ServiceType, in addition to a ClusterIP, a high-port, dynamically picked from the default range 30000-32767, is mapped to the respective Service, from all the worker nodes. For example, if the mapped NodePort is 32233 for the service frontend-svc, then, if we connect to any worker node on port 32233, the node would redirect all the traffic to the assigned ClusterIP - 172.17.0.4. If we prefer a specific high-port number instead, then we can assign that high-port number to the NodePort from the default range.</p>
<p>ServiceType - NodePort</p>
<p>NodePort</p>
<p>The NodePort ServiceType is useful when we want to make our Services accessible from the external world. The end-user connects to any worker node on the specified high-port, which proxies the request internally to the ClusterIP of the Service, then the request is forwarded to the applications running inside the cluster. To access multiple applications from the external world, administrators can configure a reverse proxy - an ingress, and define rules that target Services within the cluster.
---&gt;
ClusterIP&#x662F;&#x9ED8;&#x8BA4;&#x7684;ServiceType&#x3002;&#x670D;&#x52A1;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x865A;&#x62DF;IP&#x5730;&#x5740;&#xFF0C;&#x79F0;&#x4E3A;&#x5176;ClusterIP&#x3002;&#x6B64;&#x865A;&#x62DF;IP&#x5730;&#x5740;&#x7528;&#x4E8E;&#x4E0E;&#x670D;&#x52A1;&#x901A;&#x4FE1;&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x80FD;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x8BBF;&#x95EE;&#x3002;
&#x9664;&#x4E86;ClusterIP&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;NodePort ServiceType&#xFF0C;&#x5B83;&#x52A8;&#x6001;&#x5730;&#x4ECE;&#x9ED8;&#x8BA4;&#x8303;&#x56F4;30000-32767&#x4E2D;&#x9009;&#x62E9;&#x7684;high-port, &#x5C06;&#x5176;&#x6620;&#x5C04;&#x5230;&#x6765;&#x81EA;&#x6240;&#x6709;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x7684;&#x76F8;&#x5E94;&#x670D;&#x52A1;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x670D;&#x52A1;frontend-svc&#x7684;&#x6620;&#x5C04;NodePort&#x662F;32233&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8FDE;&#x63A5;&#x5230;&#x4EFB;&#x4F55;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x4E0A;&#x7684;&#x7AEF;&#x53E3;32233&#xFF0C;&#x5219;&#x8BE5;&#x8282;&#x70B9;&#x4F1A;&#x5C06;&#x6240;&#x6709;&#x901A;&#x4FE1;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x5206;&#x914D;&#x7684;ClusterIP - 172.17.0.4&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x66F4;&#x559C;&#x6B22;&#x7279;&#x5B9A;&#x7684;&#x9AD8;&#x7AEF;&#x53E3;&#x53F7;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x7AEF;&#x53E3;&#x7684;&#x9ED8;&#x8BA4;&#x8303;&#x56F4;&#x9009;&#x4E00;&#x4E2A;high-port&#x53F7;&#x6307;&#x6D3E;&#x7ED9;NodePort&#x3002;
<img src="assets/cka-c9307abd.png" alt="">
&#x8282;&#x70B9;&#x7AEF;&#x53E3;
&#x5F53;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x53EF;&#x4EE5;&#x4ECE;&#x5916;&#x90E8;&#x4E16;&#x754C;&#x8BBF;&#x95EE;&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x65F6;&#xFF0C;NodePort ServiceType&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;&#x6700;&#x7EC8;&#x7528;&#x6237;&#x8FDE;&#x63A5;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x4EFB;&#x4F55;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#x7684;high-ports&#x4E0A;&#xFF0C;&#x540E;&#x8005;&#x5728;&#x5185;&#x90E8;&#x5C06;&#x8BF7;&#x6C42;&#x4EE3;&#x7406;&#x5230;&#x670D;&#x52A1;&#x7684;ClusterIP&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;&#x96C6;&#x7FA4;&#x5185;&#x8FD0;&#x884C;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x8981;&#x4ECE;&#x5916;&#x90E8;&#x4E16;&#x754C;&#x8BBF;&#x95EE;&#x591A;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x7BA1;&#x7406;&#x5458;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#xFF0C;&#x5B9A;&#x4E49;&#x9488;&#x5BF9;&#x96C6;&#x7FA4;&#x4E2D;&#x670D;&#x52A1;&#x7684;&#x89C4;&#x5219;&#x548C;&#x5165;&#x53E3;&#x3002;</p>
<h4 id="servicetype-loadbalancer">ServiceType: LoadBalancer</h4>
<!---
With the LoadBalancer ServiceType:

NodePort and ClusterIP are automatically created, and the external load balancer will route to them
The Service is exposed at a static port on each worker node
The Service is exposed externally using the underlying cloud provider's load balancer feature.


ServiceType-LoadBalancer

LoadBalancer



The LoadBalancer ServiceType will only work if the underlying infrastructure supports the automatic creation of Load Balancers and have the respective support in Kubernetes, as is the case with the Google Cloud Platform and AWS. If no such feature is configured, the LoadBalancer IP address field is not populated, and the Service will work the same way as a NodePort type Service. --->
<p>&#x4F7F;&#x7528;LoadBalancer ServiceType&#x7684;&#x8BDD;&#xFF1A;</p>
<ul>
<li>NodePort&#x548C;ClusterIP&#x5C06;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#xFF0C;&#x5916;&#x90E8;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#x5C06;&#x81EA;&#x52A8;&#x8DEF;&#x7531;&#x5230;&#x5B83;&#x4EEC;</li>
<li>&#x5BF9;&#x6BCF;&#x4E2A;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;, &#x670D;&#x52A1;&#x66B4;&#x9732;&#x4E3A;&#x9759;&#x6001;&#x7AEF;&#x53E3;;</li>
<li>&#x8BE5;&#x670D;&#x52A1;&#x5BF9;&#x5916;&#x66B4;&#x9732;&#x65F6;&#x4F7F;&#x7528;&#x5E95;&#x5C42;&#x4E91;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#x529F;&#x80FD;&#x3002;
<img src="assets/cka-cee2adb9.png" alt="">
&#x8D1F;&#x8F7D;&#x5E73;&#x8861;&#x5668;
LoadBalancer ServiceType&#x53EA;&#x6709;&#x5728;&#x5E95;&#x5C42;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x652F;&#x6301;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#x5E76;&#x4E14;&#x5BF9;Kubernetes&#x4E2D;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x652F;&#x6301;&#x63A5;&#x53E3;&#x65F6;&#x624D;&#x80FD;&#x5DE5;&#x4F5C;&#xFF0C;&#x5C31;&#x50CF;Google&#x4E91;&#x5E73;&#x53F0;&#x548C;AWS&#x4E00;&#x6837;&#x3002;&#x5982;&#x679C;&#x672A;&#x914D;&#x7F6E;&#x6B64;&#x7C7B;&#x529F;&#x80FD;&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;&#x586B;&#x5145;LoadBalancer IP address&#x5B57;&#x6BB5;&#xFF0C;&#x5E76;&#x4E14;&#x8BE5;&#x670D;&#x52A1;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x4E0E;NodePort&#x7C7B;&#x578B;&#x7684;&#x670D;&#x52A1;&#x76F8;&#x540C;&#x3002;</li>
</ul>
<h4 id="servicetype-externalip">ServiceType: ExternalIP</h4>
<!---
A Service can be mapped to an ExternalIP address if it can route to one or more of the worker nodes. Traffic that is ingressed into the cluster with the ExternalIP (as destination IP) on the Service port, gets routed to one of the Service endpoints. This type of service requires an external cloud provider such as Google Cloud Platform or AWS.



ServiceType - ExternalIP

ExternalIP



Please note that ExternalIPs are not managed by Kubernetes. The cluster administrator has to configure the routing which maps the ExternalIP address to one of the nodes.--->
<p>&#x5982;&#x679C;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x8DEF;&#x7531;&#x5230;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x6620;&#x5C04;&#x5230;&#x5916;&#x90E8;&#x5730;&#x5740;&#x3002;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x4E0A;&#x7684;ExternalIP&#xFF08;&#x4F5C;&#x4E3A;&#x76EE;&#x6807;IP&#xFF09;&#x8FDB;&#x5165;&#x96C6;&#x7FA4;&#x7684;&#x6D41;&#x91CF;&#x88AB;&#x8DEF;&#x7531;&#x5230;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7AEF;&#x70B9;&#x3002;&#x6B64;&#x7C7B;&#x670D;&#x52A1;&#x9700;&#x8981;&#x5916;&#x90E8;&#x4E91;&#x63D0;&#x4F9B;&#x5546;&#xFF0C;&#x5982;Google&#x4E91;&#x5E73;&#x53F0;&#x6216;AWS&#x3002;
<img src="assets/cka-2ef8cd01.png" alt="">
ExternalIP
&#x8BF7;&#x6CE8;&#x610F;ExternalIP&#x4E0D;&#x662F;&#x7531;Kubernetes&#x7BA1;&#x7406;&#x7684;&#x3002;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x5458;&#x5FC5;&#x987B;&#x914D;&#x7F6E;&#x5C06;&#x5916;&#x90E8;&#x5730;&#x5740;&#x6620;&#x5C04;&#x5230;&#x5176;&#x4E2D;&#x54EA;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x8DEF;&#x7531;&#x3002;</p>
<h4 id="servicetype-externalname">ServiceType: ExternalName</h4>
<!---
ExternalName is a special ServiceType, that has no Selectors and does not define any endpoints. When accessed within the cluster, it returns a CNAME record of an externally configured Service.

The primary use case of this ServiceType is to make externally configured Services like my-database.example.com available to applications inside the cluster. If the externally defined Service resides within the same Namespace, using just the name my-database would make it available to other applications and Services within that same Namespace.
--->
<p>ExternalName&#x662F;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;ServiceType&#xFF0C;&#x5B83;&#x6CA1;&#x6709;<strong>Selectors</strong>&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x5B9A;&#x4E49;&#x4EFB;&#x4F55;endpoints&#x3002;&#x5F53;&#x5728;&#x96C6;&#x7FA4;&#x5185;&#x8BBF;&#x95EE;&#x65F6;&#xFF0C;&#x5B83;&#x8FD4;&#x56DE;&#x5916;&#x90E8;&#x914D;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x7684;CNAME&#x8BB0;&#x5F55;&#x3002;
&#x6B64;&#x670D;&#x52A1;&#x7C7B;&#x578B;&#x7684;&#x4E3B;&#x8981;&#x4F7F;&#x7528;&#x6848;&#x4F8B;&#x662F;&#x4F7F;&#x5916;&#x90E8;&#x914D;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#xFF08;&#x5982;my-database.example.com&#xFF09;&#x53EF;&#x7528;&#x4E8E;&#x7FA4;&#x96C6;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x5982;&#x679C;&#x5916;&#x90E8;&#x5B9A;&#x4E49;&#x7684;&#x670D;&#x52A1;&#x4F4D;&#x4E8E;&#x540C;&#x4E00;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#xFF0C;&#x5219;&#x4EC5;&#x4F7F;&#x7528;my-database&#x7684;&#x540D;&#x79F0;, &#x5C06;&#x4F7F;&#x5176;&#x5BF9;&#x540C;&#x4E00;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#x53EF;&#x7528;&#x3002;</p>
<h2 id="chapter-11-deploying-a-stand-alone-application">Chapter 11. Deploying a Stand-Alone Application</h2>
<h3 id="introduction-and-learning-objectives">Introduction and Learning Objectives</h3>
<h4 id="introduction">Introduction</h4>
<!---
In this chapter, we will learn how to deploy an application using the Dashboard (Kubernetes WebUI) and the Command Line Interface (CLI). We will also expose the application with a NodePort type Service, and access it from the external world
--->
<p>&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5B66;&#x4E60;&#x5982;&#x4F55;&#x4F7F;&#x7528;Dashboard&#xFF08;Kubernetes WebUI&#xFF09;&#x548C;&#x547D;&#x4EE4;&#x884C;&#x754C;&#x9762;&#xFF08;CLI&#xFF09;&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x5C06;&#x4F7F;&#x7528;NodePort&#x7C7B;&#x578B;&#x7684;&#x670D;&#x52A1;&#x66B4;&#x9732;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5E76;&#x4ECE;&#x5916;&#x90E8;&#x4E16;&#x754C;&#x8BBF;&#x95EE;&#x5B83;.</p>
<h4 id="learning-objectives">Learning Objectives</h4>
 <!---

By the end of this chapter, you should be able to:

Deploy an application from the dashboard.
Deploy an application from a YAML file using kubectl.
Expose a service using NodePort.
Access the application from the external world.
--->
<p>&#x5728;&#x672C;&#x7AE0;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x60A8;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#xFF1A;</p>
<ul>
<li>&#x4ECE;Dashboard&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</li>
<li>&#x4F7F;&#x7528;kubectl&#x4ECE;YAML&#x6587;&#x4EF6;&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</li>
<li>&#x4F7F;&#x7528;NodePort&#x516C;&#x5F00;&#x670D;&#x52A1;&#x3002;</li>
<li>&#x4ECE;&#x5916;&#x90E8;&#x4E16;&#x754C;&#x8BBF;&#x95EE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;<h3 id="deploying-a-stand-alone-application">Deploying a Stand-Alone Application</h3>
<h4 id="deploying-an-application-using-the-dashboard-i">Deploying an Application Using the Dashboard I</h4>
&lt;!---
In the next few sections, we will learn how to deploy an nginx webserver using the nginx:alpine Docker image.</li>
</ul>
<p>Start Minikube and verify that it is running
Run this command first:</p>
<p>$ minikube start</p>
<p>Allow several minutes for Minikube to start, then verify Minikube status:</p>
<p>$ minikube status
host: Running
kubelet: Running
apiserver: Running
kubectl: Correctly Configured: pointing to minikube-vm at 192.168.99.100</p>
<p>Start the Minikube Dashboard
To access the Kubernetes Web IU, we need to run the following command:</p>
<p>$ minikube dashboard</p>
<p>Running this command will open up a browser with the Kubernetes Web UI, which we can use to manage containerized applications. By default, the dashboard is connected to the default Namespace. So, all the operations that we will do in this chapter will be performed inside the default Namespace.</p>
<p>Deploying an Application - Accessing the Dashboard</p>
<p>NOTE: In case the browser is not opening another tab and does not display the Dashboard as expected, verify the output in your terminal as it may display a link for the Dashboard (together with some Error messages). Copy and paste that link in a new tab of your browser. Depending on your terminal&apos;s features you may be able to just click or right-click the link to open directly in the browser. The link may look similar to:</p>
<p><a href="http://127.0.0.1:37751/api/v1/namespaces/kube-system/services/http:kubernetes-dashboard:/proxy/" target="_blank">http://127.0.0.1:37751/api/v1/namespaces/kube-system/services/http:kubernetes-dashboard:/proxy/</a></p>
<p>Chances are that the only difference is the PORT number, which above is 37751. Your port number may be different.</p>
<p>After a logout/login or a reboot of your workstation the normal behavior should be expected (where the minikube dashboard command directly opens a new tab in your browser displaying the Dashboard).
---&gt;</p>
<p>&#x5728;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x51E0;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5B66;&#x4E60;&#x5982;&#x4F55;&#x4F7F;&#x7528;nginx:alpine Docker&#x6620;&#x50CF;&#x90E8;&#x7F72;nginx web&#x670D;&#x52A1;&#x5668;&#x3002;
<strong>&#x542F;&#x52A8;Minikube&#x5E76;&#x786E;&#x8BA4;&#x5B83;&#x6B63;&#x5728;&#x8FD0;&#x884C;</strong>
&#x9996;&#x5148;&#x8FD0;&#x884C;&#x6B64;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code class="lang-console">$ minikube start
</code></pre>
<p>&#x5141;&#x8BB8;Minikube&#x542F;&#x52A8;&#x51E0;&#x5206;&#x949F;&#xFF0C;&#x7136;&#x540E;&#x9A8C;&#x8BC1;Minikube&#x72B6;&#x6001;&#xFF1A;</p>
<pre><code class="lang-console">$ minikube status
host: Running
kubelet: Running
apiserver: Running
kubectl: Correctly Configured: pointing to minikube-vm at 192.168.99.100
</code></pre>
<p><strong>&#x542F;&#x52A8;Minikube&#x4EEA;&#x8868;&#x677F;</strong>
&#x8981;&#x8BBF;&#x95EE;Kubernetes Web IU&#xFF0C;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;:</p>
<pre><code class="lang-console">$ minikube dashboard
</code></pre>
<p>&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5C06;&#x6D4F;&#x89C8;&#x5668;&#x6253;&#x5F00;&#x4E00;&#x4E2A;Kubernetes Web UI&#x7684;&#x9875;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x7BA1;&#x7406;&#x5BB9;&#x5668;&#x5316;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4EEA;&#x8868;&#x677F;&#x8FDE;&#x63A5;&#x5230;default&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#x5C06;&#x8981;&#x6267;&#x884C;&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x90FD;&#x5C06;&#x5728;default&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x6267;&#x884C;&#x3002;
<img src="assets/cka-f6b64cd1.png" alt="">
Deploying an Application - Accessing the Dashboard
&#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x679C;&#x6D4F;&#x89C8;&#x5668;&#x6CA1;&#x6709;&#x6253;&#x5F00;&#x53E6;&#x4E00;&#x4E2A;&#x9009;&#x9879;&#x5361;&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x6309;&#x9884;&#x671F;&#x663E;&#x793A;Dashboard&#xFF0C;&#x8BF7;&#x9A8C;&#x8BC1;&#x7EC8;&#x7AEF;&#x4E2D;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EF;&#x80FD;&#x4F1A;&#x663E;&#x793A;Dashboard&#x7684;&#x94FE;&#x63A5;&#xFF08;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#xFF09;&#x3002;&#x5C06;&#x8BE5;&#x94FE;&#x63A5;&#x590D;&#x5236;&#x5E76;&#x7C98;&#x8D34;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x65B0;&#x9009;&#x9879;&#x5361;&#x4E2D;&#x3002;&#x6839;&#x636E;&#x7EC8;&#x7AEF;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5355;&#x51FB;&#x6216;&#x53F3;&#x952E;&#x5355;&#x51FB;&#x94FE;&#x63A5;&#x76F4;&#x63A5;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x6253;&#x5F00;&#x3002;&#x94FE;&#x63A5;&#x53EF;&#x80FD;&#x7C7B;&#x4F3C;&#x4E8E;&#xFF1A;</p>
<p><a href="http://127.0.0.1:37751/api/v1/namespaces/kube-system/services/http:kubernetes-dashboard:/proxy/" target="_blank">http://127.0.0.1:37751/api/v1/namespaces/kube-system/services/http:kubernetes-dashboard:/proxy/</a></p>
<p>&#x53EF;&#x80FD;&#x552F;&#x4E00;&#x7684;&#x533A;&#x522B;&#x662F;&#x7AEF;&#x53E3;&#x53F7;&#xFF0C;&#x4E0A;&#x9762;&#x662F;37751&#x3002;&#x60A8;&#x7684;&#x7AEF;&#x53E3;&#x53F7;&#x53EF;&#x80FD;&#x4E0D;&#x540C;&#x3002;
&#x6CE8;&#x9500;/&#x767B;&#x5F55;&#x6216;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x7535;&#x8111;&#x540E;&#xFF0C;&#x5E94;&#x8BE5;&#x5C31;&#x6B63;&#x5E38;&#x4E86;&#xFF08;minikube dashboard&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x6253;&#x5F00;&#x663E;&#x793A;&#x4EEA;&#x8868;&#x677F;&#x7684;&#x65B0;&#x9009;&#x9879;&#x5361;&#xFF09;&#x3002;</p>
<h4 id="deploying-an-application-using-the-dashboard-ii">Deploying an Application Using the Dashboard II</h4>
<p>Deploy a webserver using the nginx:alpine image
From the dashboard, click on the +CREATE tab at the top right corner of the Dashboard. That will open the create interface as seen below:
<img src="assets/cka-f9186ea7.png" alt="">
Deploy a Containerized Application Web Interface</p>
<p>From that, we can create an application using a valid YAML/JSON configuration data of file, or manually from the CREATE AN APP section. Click on the CREATE AN APP tab and provide the following application details:</p>
<p>The application name is webserver
The Docker image to use is nginx:alpine, where alpine is the image tag
The replica count, or the number of Pods, is 3
No Service, as we will be creating it later.
<img src="assets/cka-f9186ea7.png" alt="">
Deploy a Containerized Application Web Interface
If we click on Show Advanced Options, we can specify options such as Labels, Namespace, Environment Variables, etc. By default, the app Label is set to the application name. In our example k8s-app:webserver Label is set to all objects created by this Deployment: Pods and Services (when exposed).</p>
<p>By clicking on the Deploy button, we trigger the deployment. As expected, the Deployment webserver will create a ReplicaSet (webserver-74d8bd488f), which will eventually create three Pods (webserver-74d8bd488f-xxxxx).</p>
<p><img src="assets/cka-238dfb92.png" alt=""></p>
<p>Deployment Details</p>
<p>NOTE: Add the full URL in the Container Image field docker.io/library/nginx:alpine if any issues are encountered with the simple nginx:alpine image name (or use the k8s.gcr.io/nginx:alpine URL if it works instead).</p>
<h4 id="deploying-an-application-using-the-dashboard-iii">Deploying an Application Using the Dashboard III</h4>
<p>Once we created the webserver Deployment, we can use the resource navigation panel from the left side of the Dashboard to display details of Deployments, ReplicaSets, and Pods in the default Namespace. The resources displayed by the Dashboard match one-to-one resources displayed from the CLI via kubectl.</p>
<p><strong>List the Deployments</strong>
We can list all the Deployments in the default Namespace using the kubectl get deployments command:</p>
<pre><code>$ kubectl get deployments
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
webserver   3/3     3            3           9m
</code></pre><p><strong>List the ReplicaSets</strong>
We can list all the ReplicaSets in the default Namespace using the kubectl get replicasets command:</p>
<pre><code>$ kubectl get replicasets
NAME                   DESIRED   CURRENT   READY   AGE
webserver-74d8bd488f   3         3         3       9m
</code></pre><p><strong>List the Pods</strong>
We can list all the Pods in the default namespace using the kubectl get pods command:</p>
<pre><code>$ kubectl get pods
NAME                          READY   STATUS    RESTARTS   AGE
webserver-74d8bd488f-dwbzz    1/1     Running   0          9m
webserver-74d8bd488f-npkzv    1/1     Running   0          9m
webserver-74d8bd488f-wvmpq    1/1     Running   0          9m
</code></pre><h4 id="exploring-labels-and-selectors-i">Exploring Labels and Selectors I</h4>
<p>Earlier, we have seen that labels and selectors play an important role in grouping a subset of objects on which we can perform operations. Next, we will take a closer look at them.</p>
<p><strong>Look at a Pod&apos;s Details</strong>
We can look at an object&apos;s details using kubectl describe command. In the following example, you can see a Pod&apos;s description:</p>
<pre><code>$ kubectl describe pod webserver-74d8bd488f-dwbzz
Name:           webserver-74d8bd488f-dwbzz
Namespace:      default
Priority:       0
Node:           minikube/10.0.2.15
Start Time:     Wed, 15 May 2019 13:17:33 -0500
Labels:         k8s-app=webserver
                pod-template-hash=74d8bd488f
Annotations:    &lt;none&gt;
Status:         Running
IP:             172.17.0.5
Controlled By:  ReplicaSet/webserver-74d8bd488f
Containers:
  webserver:
    Container ID:   docker://96302d70903fe3b45d5ff3745a706d67d77411c5378f1f293a4bd721896d6420
    Image:          nginx:alpine
    Image ID:       docker-pullable://nginx@sha256:8d5341da24ccbdd195a82f2b57968ef5f95bc27b3c3691ace0c7d0acf5612edd
    Port:           &lt;none&gt;
    State:          Running
      Started:      Wed, 15 May 2019 13:17:33 -0500
    Ready:          True
    Restart Count:  0
...
</code></pre><p>The kubectl describe command displays many more details of a Pod. For now, however, we will focus on the Labels field, where we have a Label set to k8s-app=webserver.</p>
<h4 id="exploring-labels-and-selectors-ii">Exploring Labels and Selectors II</h4>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="rest.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: restful">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"k8s","level":"1.6.2","depth":2,"next":{"title":"数据库","level":"1.7","depth":1,"ref":"","articles":[{"title":"MongoDB","level":"1.7.1","depth":2,"path":"mongodb.md","ref":"mongodb.md","articles":[]},{"title":"sql","level":"1.7.2","depth":2,"path":"sql.md","ref":"sql.md","articles":[]}]},"previous":{"title":"restful","level":"1.6.1","depth":2,"path":"rest.md","ref":"rest.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["mermaid"],"pluginsConfig":{"mermaid":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"cka.md","mtime":"2020-03-02T11:38:22.550Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-01-19T10:24:33.038Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

